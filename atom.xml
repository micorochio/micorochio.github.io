<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Zing</title>
  <subtitle>不忘初心,方得始终</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://micorochio.github.io/"/>
  <updated>2017-10-03T16:21:41.000Z</updated>
  <id>http://micorochio.github.io/</id>
  
  <author>
    <name>zing</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Effective Java 读书笔记-第四章</title>
    <link href="http://micorochio.github.io/2017/08/07/reading-effective-java-03/"/>
    <id>http://micorochio.github.io/2017/08/07/reading-effective-java-03/</id>
    <published>2017-08-07T00:00:41.000Z</published>
    <updated>2017-10-03T16:21:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>第四章讲了类的设计，大部分应该遵守，书中也给出了遵守这些规则的理由, 然后书已经看得差不多了，这样记笔记实在没啥效率，后面就不这么写了。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-89717ee7e4af41a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<a id="more"></a>
<h2 id="0x01-类的成员的可访问性最小化"><a href="#0x01-类的成员的可访问性最小化" class="headerlink" title="0x01 类的成员的可访问性最小化"></a>0x01 类的成员的可访问性最小化</h2><p>可访问性最小化的好处：</p>
<ul>
<li>隐藏了实现，保护了信息</li>
<li>封装，减少了耦合，减轻了维护负担</li>
</ul>
<blockquote>
<ul>
<li>私有的（private） —— 只有在声明该成员的顶层类内部才可以访问这个成员。</li>
<li>包级私有的（package-private） —— 声明该成员的包内部的任何类都可以访问这个成员。从技术上讲，它被称为“缺省（default）访问级别”，如果没有为成员指定访问修饰符，就采用这个访问级别。</li>
<li>受保护的（protected） —— 声明该成员的子类可以访问这个成员（但有一些限制[JLS，6.6.2]），并且，声明该成员的包内部的任何类也可以访问这个成员。</li>
<li>公有的（public） —— 在任何地方都可以访问该成员。</li>
</ul>
</blockquote>
<p>一旦类的属性被公开，则你有责任负责兼容到底。<br>如果一个类中用一个对象实例作为属性，则这个属性一定不能是public的，最好是final的，可以保证线程安全。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">xxx</span></span>&#123;</div><div class="line">  <span class="comment">//潜在安全漏洞</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Thing[] VALUES = &#123; ... &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="0x02-不直接公开属性修改权限，用方法操作属性"><a href="#0x02-不直接公开属性修改权限，用方法操作属性" class="headerlink" title="0x02 不直接公开属性修改权限，用方法操作属性"></a>0x02 不直接公开属性修改权限，用方法操作属性</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">double</span> x;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">double</span> y;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的类无法改变属性的表示方式，也不能对两个属性进行任何附加要求，比如限定上下限。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">double</span> x;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">double</span> y;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Point</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.x = x;</div><div class="line">      <span class="keyword">this</span>.y = y;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getX</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> x; &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getY</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> y; &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setX</span><span class="params">(<span class="keyword">double</span> x)</span> </span>&#123; <span class="keyword">this</span>.x = x; &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setY</span><span class="params">(<span class="keyword">double</span> y)</span> </span>&#123; <span class="keyword">this</span>.y = y; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这段代码很好的封装了内部属性，并提供了操作方法，在方法内部可以对属性操作进行约束。<br>数据是抽象的，应最小化的缩小对外界的影响，所以可变的属性应该私有化，而不是直接暴露。只有不需要改变的属性，才可以暴露，比如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HOURS_PER_DAT    = <span class="number">24</span>;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MINUTES_PER_HOUR = <span class="number">60</span>;</div></pre></td></tr></table></figure></p>
<h2 id="0x03-可变性最小化"><a href="#0x03-可变性最小化" class="headerlink" title="0x03 可变性最小化"></a>0x03 可变性最小化</h2><p><code>String</code>是final的。<code>BigInteger</code>,<code>BigDecimal</code>有很多属性也是final的，这些final的属性让这些类的可变性变小了，为什么要这么设计？</p>
<ul>
<li>不可变的类比可变类更加易于设计、实现和使用。</li>
<li>它们不容易出错，而且不可变对象本质上是线程安全的，它们不要求同步。</li>
<li>不可变对象可以被自由地共享。</li>
<li>不需要进行保护性拷贝。</li>
<li>也可以共享它们的内部信息。</li>
<li>不可变对象为其他对象提供了大量的构建（building blocks）<blockquote>
<p>最后一条解释一下：不可变对象即使被放进集合set、或者map中，（一般设计集合的键-值映射是不希望发生变化的）也不用考虑对象值被修改。</p>
</blockquote>
</li>
</ul>
<p><strong>当然也有缺点：每个值都需要一个新对象</strong><br>因为这有，有些操作，每进行一次操作，都会产生一个新对象，例如String的拼接。<br>所以，许多不可变的类拥有一个或者多个非final的域，它们在第一次被请求执行这些计算的时候，把一些开销昂贵的计算结果缓存在这些域中。如果将来再次请求同样的计算，就直接返回这些缓存的值，从而节约了重新计算所需要的开销。</p>
<p>书中有了5个提议：</p>
<blockquote>
<ol>
<li>不要提供任何会修改对象状态的方法（也成为mutator）。</li>
<li>保证类不会被扩展。</li>
<li>使所有的域都是final的。(其实不用特别严格执行这一条)</li>
<li>使所有的域都成为私有的。</li>
<li>确保对于任何可变组件的互斥访问。</li>
</ol>
</blockquote>
<p>另外对于不可变对象，构造器应该创建完全初始化的对象，并建立起所有的约束关系。</p>
<p>如果类不能被做成是不可变的，仍然应该尽可能地限制它的可变性。</p>
<h2 id="0x04-复合优先继承"><a href="#0x04-复合优先继承" class="headerlink" title="0x04 复合优先继承"></a>0x04 复合优先继承</h2><p>复合优先继承的原因很简单，为了保证对象的安全。为什么这么说？<br>当类有跨包继承的时候，有些域属性按道理是不可以使用的，但是继承后某些方法就有可能会操作到这些属性，如果精心设计了，那倒没什么。就怕粗心了，有些无法预知的安全问题。<br>所以当对象有跨包使用并且需要扩展的时候，可以选择将对象放进一个新类作为域属性。这样处理会比继承好一点。</p>
<p>学术一点就是：跨包继承打破了封装性。</p>
<p>当然这不是绝对的，有些类天生应该被继承，这是设计上决定的。<br>书中有代码介绍了为什么会破坏封装性<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Broken - Inappropriate use of inheritance!</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InstrumentedHashSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">HashSet</span>&lt;<span class="title">E</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">// The number of attempted element insertions</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> addCount = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InstrumentedHashSet</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InstrumentedHashSet</span><span class="params">(<span class="keyword">int</span> initCap, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(initCap, loadFactor);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</div><div class="line">        addCount++;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.add(e);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</div><div class="line">        addCount += c.size();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.addAll(c);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAddCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> addCount;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个类看起来非常合理，但是它不能正常工作。假设我们创建了一个实例，并利用addAll方法添加了三个元素：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">InstrumentedHashSet&lt;String&gt; s =</div><div class="line">    <span class="keyword">new</span> InstrumentedHashSet&lt;String&gt;();</div><div class="line">s.addAll(Arrays.asList(<span class="string">"Snap"</span>, <span class="string">"Crackle"</span>, <span class="string">"Pop"</span>));</div></pre></td></tr></table></figure></p>
<p>实际上继承后，一个<code>super.addAll()</code>导致了getAddCount方法拿出的结果不是预期的，上面的代码应该返回3，但是返回的确实6.<br>因为HashSet的addAll方法已经计数了。</p>
<p>综上，复合优先于继承，<br>你只需要</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InstrumentedHashSet</span>&lt;<span class="title">E</span>&gt;</span>&#123;</div><div class="line">  <span class="keyword">private</span> HashSet&lt;E&gt; innerHashSet;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>就可以拥有HashSet的一切。</p>
<p>但是！ 复合后很难使用回调模型！使用回调模型的时候，注意规避。</p>
<blockquote>
<p>简而言之，继承的功能非常强大，但是也存在诸多问题，因为它违背了封装原则。只有当子类和超类之间确实存在子类型关系是，使用继承才是恰当的。即便如此，如果子类和超类处在不同的包中，并且超类并不是为了继承而设计的，那么就成将会导致脆弱性（fragility）。为了避免这种脆弱性，可以用复合和转发机制来代替继承，尤其是当存在适当的接口可以实现包装类的时候。包装类不仅比子类更加健壮，而且功能也更加强大。</p>
</blockquote>
<h2 id="0x05-要么为继承而设计，要么禁止继承"><a href="#0x05-要么为继承而设计，要么禁止继承" class="headerlink" title="0x05 要么为继承而设计，要么禁止继承"></a>0x05 要么为继承而设计，要么禁止继承</h2><p>上一条已经说过，继承不是最佳的代码复用方式。所以当你设计一个类，并且希望这个类可以被继承的时候，一定要做好准备工作，设计好方法，提供详实的文档，保证继承者的使用。让使用者能规避一些安全问题，或者设计的时候直规避。<br>书上举了两个例子：</p>
<ul>
<li><p><code>java.util.AbstractCollection</code>的规范:</p>
<blockquote>
<p>public boolean remove(Object o)<br><br>Removes a single instance of the specified element from this colletion, if it is present(optional operation). More formally, removes an element e such that (o==null ? e==nul : o.equals()), if the collection contains one or more such elements. Returns true if the collection contained the specified element (or equivalently, if the collection changed as a result of the call).<br><br>This implementation iterates over the collecting looking for the specified element. If it finds the elements, it removes the element from the collection using the iterators’s remove method. Note that this implementation throws an UnsupportedOperationException if the iterator returned by this collection’s iterator method does not implement the remove method.<br><br>（如果这个集合中存在指定的元素，就从中删除该指定元素中的单个实例（这是项可选的操作）。更一般地，如果集合中包含一个或者多个这样的元素e，就从中删除这种元素，以便(o==null ? e==nul : o.equals())。如果集合中包含指定的元素就返回true（如果调用最终改变了集合，也一样）。<br><br>该实现遍历整个集合来查找指定的元素。如果它找到该元素，将会利用迭代器的remove方法将之从集合中删除。注意，如果由该集合的iterator方法返回的迭代器没有实现remove方法，该实现就会抛出UnsupportedOperationException。）</p>
</blockquote>
</li>
<li><p><code>java.util.AbstractList</code>中的<code>removeRange</code>方法：</p>
<blockquote>
<p>protected void removeRange(int fromIndex, int toIndex)<br><br>Removes from this list all of the elements whose index is between fromIndex, inclusive, and toIndex, exclusive. Shifts any elements to the left (reduces their index). This call shortens the ArrayList by (toIndex - ‘fromIndex’) elements. (If toIndex==fromIndex, this operation has no effect.)<br>This method is called by the clear operation on this list and its sublists. Overriding this method to take advantage of the internals of the list implementation can substantially imporve the performance of the clear operation on this list and its sublists.<br><br>This implementation get a list iterator positioned before fromIndex and repeatedly calls ListIterator.next follows by ListIterator.remove, until the entire range has been removed. Note: If ListIterator.remove requires linear time, this implementation requires quadratic time.<br>Parameters:<br><br><br>fromIndex index of first element to be removed.<br><br>toIndex index after last element to be removed.<br><br><br>（从列表中删除所有索引处于fromIndex（含）和toIndex（不含）之间的元素。将所有符合条件的元素移到左边（减小索引）。这一调用将从ArrayList中删除（toIndex - fromIndex）之间的元素。（如果toIndex == fromIndex，这项操作就无效。）<br><br>这个方法是通过clear操作在这个列表及其自列表中调用的。覆盖这个方法来利用列表实现的内部信息，可以充分地改善这个列表及其子列表中的clear操作的性能。<br><br>这项实现获得了一个处在fromIndex之前的列表迭代器，并一次地重复调用ListIterator.remove和ListIterator.next，直到整个范围都被移除为止。<br>注意：如果ListIterator.remove需要线性的时间，该实现就需要平方级的时间。<br><br>参数：<br><br><br>fromIndex 要移除的第一个元素的索引<br><br>toIndex 要移除的最后一个元素之后的索引）<br></p>
</blockquote>
</li>
</ul>
<p>后面讲述了如何设计保护域属性，对不能继承的类要用final修饰来禁止子类化。</p>
<h2 id="0x06-接口和抽象类优先使用接口"><a href="#0x06-接口和抽象类优先使用接口" class="headerlink" title="0x06 接口和抽象类优先使用接口"></a>0x06 接口和抽象类优先使用接口</h2><p>对的，标题即方法。</p>
<p>你会问为什么？</p>
<ul>
<li>子类可以实现多个接口，却不能实现多个抽象类。</li>
<li>实现多个接口意味着类是混合类，更加适合代码复用</li>
<li>接口可以让程序员设计出非层次结构的类</li>
</ul>
<blockquote>
<p>层次结构：就是金字塔结构</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-f77f4dd18ff0fad7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片来自网络，侵删！"></p>
<p>这样设计，顶部就是父类，一层一层往下就是子类，如果使用抽象类，则就是金字塔结构的层次模型。如果使用接口，那就是树模型，一个类可以实现多个接口，实现接口的功能。</p>
<p>书中有些例子，这里不说明了。</p>
<h2 id="0x07-接口只定义类型"><a href="#0x07-接口只定义类型" class="headerlink" title="0x07 接口只定义类型"></a>0x07 接口只定义类型</h2><p>你一定见过下面的代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zing.nio_study;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.math.BigDecimal;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DemoInterface</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> BigDecimal PI = BigDecimal.valueOf(<span class="number">3.1415926</span>);</div><div class="line">    publi <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> DELETED = <span class="number">1</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NORMAL = <span class="number">2</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>这是对接口的不良使用</strong></p>
</blockquote>
<p>接口按照JAVA的初衷来说，是不涉及代码逻辑细节的，这些常量是纯粹的实现细节。这样的API暴露了设计细节。而且一旦以后某些属性不使用了，子类依旧需要实现该接口，维护代价也会上升。如果是存粹的常量值接口，你还不如用枚举。</p>
<p>这里应该使用枚举类型<code>enum</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> state&#123;</div><div class="line">        DELETED,</div><div class="line">        NORMAL,</div><div class="line">        ABNORMAL</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>如果担心枚举需要扩展，可以让枚举实现一个空接口。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ADEMO</span></span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="keyword">enum</span> demo1 implements ADEMO&#123;</div><div class="line">    A,</div><div class="line">    B,</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">enum</span> demo2 implements ADEMO&#123;</div><div class="line">    C,</div><div class="line">    D,</div><div class="line">    E</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样调用处可以随时扩展新的枚举：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomthingByDemo</span><span class="params">(ADEMO A)</span></span>&#123;</div><div class="line">    <span class="comment">// TODO </span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><em>以上是枚举扩展部分是个人观点，实际中请慎用，应该尽量把类设计的完善一点，有问题可以留言。</em></p>
<h2 id="0x08-类层次优于标签类"><a href="#0x08-类层次优于标签类" class="headerlink" title="0x08 类层次优于标签类"></a>0x08 类层次优于标签类</h2><p>标签类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Tagged class - vastly inferior to a class hierarchy</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Figure</span> </span>&#123;</div><div class="line">    <span class="keyword">enum</span> Shape &#123; RECTANGLE, CIRCLE&#125;;</div><div class="line"></div><div class="line">    <span class="comment">// Tag field - the shape of this figure</span></div><div class="line">    <span class="keyword">final</span> Shape shape;</div><div class="line"></div><div class="line">    <span class="comment">// These fields are used only if shape is RECTANGLE</span></div><div class="line">    <span class="keyword">double</span> length;</div><div class="line">    <span class="keyword">double</span> width;</div><div class="line"></div><div class="line">    <span class="comment">// This field is used only if shape is CIRCLE</span></div><div class="line">    <span class="keyword">double</span> radius;</div><div class="line"></div><div class="line">    <span class="comment">// Constructor for circle</span></div><div class="line">    Figure(<span class="keyword">double</span> radius) &#123;</div><div class="line">        shape = Shape.CIRCLE;</div><div class="line">        <span class="keyword">this</span>.radius = radius;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Constructor for rectangle</span></div><div class="line">    Figure(<span class="keyword">double</span> length, <span class="keyword">double</span> width) &#123;</div><div class="line">        shape = Shape.RECTANGLE;</div><div class="line">        <span class="keyword">this</span>.length = length;</div><div class="line">        <span class="keyword">this</span>.width = width;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">area</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (shape) &#123;</div><div class="line">          <span class="keyword">case</span> RECTANGLE:</div><div class="line">            <span class="keyword">return</span> length * width;</div><div class="line">          <span class="keyword">case</span> CIRCLE:</div><div class="line">            <span class="keyword">return</span> Math.PI * (radius * radius);</div><div class="line">          <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上面一段代码，大致的意思是一个类，里面有两个标签对象，圆和矩形。<br>看起来还好，但是标签一多分支代码就越复杂，难以维护；而且还有很多模板代码… 写这种代码的大部分是刨坑小能手，交接给别人后，别人在一堆分支结构中摸不着头脑，然后问候你家人也是常有的事情。</p>
<p>这时候可以设计成层次类。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Class hierarchy replacement for a tagged class</span></div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Figure</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">double</span> <span class="title">area</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Figure</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">double</span> radius;</div><div class="line"></div><div class="line">    Circle(<span class="keyword">double</span> radius) &#123; <span class="keyword">this</span>.radius = radius; &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">area</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> Math.PI * (radius * radius); &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Figure</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">double</span> length; </div><div class="line">    <span class="keyword">final</span> <span class="keyword">double</span> width;</div><div class="line"></div><div class="line">    Rectangle(<span class="keyword">double</span> length, <span class="keyword">double</span> width) &#123;</div><div class="line">        <span class="keyword">this</span>.length = length;</div><div class="line">        <span class="keyword">this</span>.width  = width;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">area</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> length * width; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>优点：</p>
<ul>
<li>条理清楚，每个子类去掉了不相关的属性</li>
<li>不需要大量的样板代码，无须标签区分</li>
<li>别人看地轻松一点</li>
<li>方便检查代码层次关系，灵活性很高</li>
</ul>
<h2 id="0x09-用函数对象表示策略"><a href="#0x09-用函数对象表示策略" class="headerlink" title="0x09 用函数对象表示策略"></a>0x09 用函数对象表示策略</h2><p>java已经支持lambda表达式了，所以，这一条可以使用lambda表达式来代替。<br>因为lambda表达式自身是没有域属性的（即无状态），天生线程安全。</p>
<p>函数对象表示策略，首先知道策略是什么，这里举个例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringLengthComparator</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String s1, String s2)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> s1.length() - s2.length();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在一个函数中，需要动态的根据两个参数的不同属性来执行不同的逻辑，这个逻辑就是策略。</p>
<p>上面代码的策略是根据字符的长短实现字符串的大小比较。<br>书上有些说明，但是请还是了解一下java 8 的lambda表达式，很有用！！！<br>这里就不仔细说了。</p>
<h2 id="0x10-优先考虑静态成员类"><a href="#0x10-优先考虑静态成员类" class="headerlink" title="0x10 优先考虑静态成员类"></a>0x10 优先考虑静态成员类</h2><blockquote>
<p>静态成员类是最简单的一种嵌套类。最好把他看作是普通的类，只是碰巧被声明在另一个类的内部而已，它可以方位外围类的所有成员，包括那些声明为私有的成员。</p>
</blockquote>
<p>这么做的目的跟最早说明的访问权限最小化类似<br>当你需要一个类，只供某一个类访问时，务必将其作为静态成员类，放在某个类的内部。</p>
<p>静态static可以减少类对外围对象的依赖，减少时间和空间的消耗。</p>
<p>个人观点：虽让书上这么说了，不过实际上，一般很少设计一个类，只供某个类使用。如果类的代码量很大，还是抽出来做独立类吧。</p>
<p>love &amp; peace</p>
<p>转载请注明出处：<a href="https://micorochio.github.io/2017/08/06/reading-effective-java-03/">https://micorochio.github.io/2017/08/06/reading-effective-java-03/</a></p>
<p>如若有误请帮忙指正，谢谢</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;第四章讲了类的设计，大部分应该遵守，书中也给出了遵守这些规则的理由, 然后书已经看得差不多了，这样记笔记实在没啥效率，后面就不这么写了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-89717ee7e4af41a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="笔记" scheme="http://micorochio.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
      <category term="Java基础" scheme="http://micorochio.github.io/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>Effective Java 读书笔记-第三章</title>
    <link href="http://micorochio.github.io/2017/08/06/reading-effective-java-02/"/>
    <id>http://micorochio.github.io/2017/08/06/reading-effective-java-02/</id>
    <published>2017-08-05T23:15:36.000Z</published>
    <updated>2017-08-05T12:25:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>第三章讲了一些通用的方法。看的时候很快，记笔记的时候慢了<br><img src="http://upload-images.jianshu.io/upload_images/1112615-7341f62f8111e454.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="298" height="52" src="//music.163.com/outchain/player?type=2&id=2116504&auto=1&height=32"></iframe>

<h2 id="0x01-equals方法应该如何写"><a href="#0x01-equals方法应该如何写" class="headerlink" title="0x01 equals方法应该如何写"></a>0x01 equals方法应该如何写</h2><p>equals 方法是对象判断是否相等的方法，如果一个类具有多实例的需求时，可以重equals方法来判断两个对象是否相等。</p>
<p>除非：</p>
<blockquote>
<ul>
<li>类的每个实例都是唯一的</li>
<li>不关心实例是否逻辑上相等</li>
<li>父类已经重写了equals </li>
<li>类是私有的，equals方法永远不会被调用</li>
</ul>
</blockquote>
<a id="more"></a>
<p>如果不是以上条件，那就需要考虑对象是不是逻辑相等。那么判断相等的方法就应该具有以下特性：</p>
<ol>
<li><strong>reflexive</strong> :  对象自己与自己对比永远是true，<code>x.equals(x)</code> 返回一定是true</li>
<li><strong>symmetric</strong> : <code>x.equals(y)</code>为true时，<code>y.equals(x)</code>一定为true</li>
<li><strong>transitive</strong> :   如果 <code>x.equals(y)</code> 为true，且 <code>y.equals(z)</code>也为true，那么<code>x.equals(z)</code> 也必须为true</li>
<li><strong>consistent</strong> :   如果 <code>x.equals(y)</code> 为true，再x和y没有修改的情况下，无论何时再调用equals方法都会返回true。</li>
<li>任何对象equals <code>null</code>时，必须返回false<blockquote>
<p>以上对象全部都是非空对象</p>
</blockquote>
</li>
</ol>
<p>有了这几个标准，于是就有了写equals方法的公式：</p>
<ol>
<li>使用==操作符检查“参数是否为这个对象的引用”。</li>
<li>使用instanceof操作符检查“参数是否为正确的类型”</li>
<li>把参数转换成正确的类型。</li>
<li><p>对于该类中每个“关键（significant）域，检查参数中的域是否与该对象中对应的域相匹配”<br>比较域（类属性参数） 的方法可以参照下下面的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(field == o.field || (field != <span class="keyword">null</span> &amp;&amp; field.equals(o.field)))</div></pre></td></tr></table></figure>
</li>
<li><p>编写完成了equals方法之后，应该问自己三个问题：它是不是对称的、传递的、一致的</p>
</li>
</ol>
<p>以上是写equals的公式</p>
<blockquote>
<p>另外，equals只做比较对象的工作，不要让equals过于智能，且不要将equals声明中的Object对象替换为其他的类型.</p>
</blockquote>
<h2 id="0x02-hashCode方法为什么也要覆写"><a href="#0x02-hashCode方法为什么也要覆写" class="headerlink" title="0x02 hashCode方法为什么也要覆写"></a>0x02 hashCode方法为什么也要覆写</h2><p>hashCode方法是需要和equals方法一起重新的，在使用HashMap，HashSet这样的散列集合时会大大提升效率</p>
<p>Object规范里有一段话</p>
<blockquote>
<ul>
<li>在应用程序的执行期间，只要对象的equlas方法的比较操作所用到的信息没有被修改，那么对同一个对象调用多次，hashCode方法都必须始终如一地返回同一个整数。在同一个应用程序的多次执行过程中，每次执行所返回的整数可以不一致。</li>
<li>如果两个对象根据equlas(Object)方法比较是相等的，那么调用这两个对象中任意一个对象的hashCode方法都必须产生同样的整数结果。</li>
<li>如果两个对象根据equlas(Object)方法比较是不相等的，那么调用这两个对象中任意一个对象的hashCode方法，则不一定要产生不同的整数结果。但是程序员应该知道，给不相等的对象产生截然不同的整数结果，有可能提高散列表（hash table）的性能。</li>
</ul>
</blockquote>
<p>这段话第二条就明确了，重写equals方法之后就应该连同hashCode方法一起重写。</p>
<p>举个例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">short</span> areaCode;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">short</span> prefix;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">short</span> lineNumber;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(<span class="keyword">int</span> areaCode, <span class="keyword">int</span> prefix,</span></span></div><div class="line">                       <span class="keyword">int</span> lineNumber) &#123;</div><div class="line">        rangeCheck(areaCode, <span class="number">999</span>, <span class="string">"area code"</span>);</div><div class="line">        rangeCheck(prefix, <span class="number">999</span>, <span class="string">"prefix"</span>);</div><div class="line">        rangeCheck(lineNumber, <span class="number">9999</span>, <span class="string">"line number"</span>);</div><div class="line">        <span class="keyword">this</span>.areaCode = (<span class="keyword">short</span>) areaCode;</div><div class="line">        <span class="keyword">this</span>.prefix = (<span class="keyword">short</span>) prefix;</div><div class="line">        <span class="keyword">this</span>.lineNumber = (<span class="keyword">short</span>) lineNumber;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rangeCheck</span><span class="params">(<span class="keyword">int</span> arg, <span class="keyword">int</span> max,</span></span></div><div class="line">                                   String name) &#123;</div><div class="line">        <span class="keyword">if</span> (arg &lt; <span class="number">0</span> || arg &gt; max)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(name + <span class="string">": "</span> + arg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (o == <span class="keyword">this</span>)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> PhoneNumber))</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        PhoneNumber pn = (PhoneNumber) o;</div><div class="line">        <span class="keyword">return</span> pn.lineNumber == lineNumber</div><div class="line">                &amp;&amp; pn.prefix == prefix</div><div class="line">                &amp;&amp; pn.areaCode == areaCode;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestHashCode</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Map&lt;String, String&gt; m = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">        m.put(<span class="keyword">new</span> String(<span class="string">"HAHA"</span>), <span class="string">"Jenny"</span>);</div><div class="line">        System.out.println(m.get(<span class="keyword">new</span> String(<span class="string">"HAHA"</span>)));</div><div class="line"></div><div class="line">        Map&lt;PhoneNumber, String&gt; s = <span class="keyword">new</span> HashMap&lt;PhoneNumber, String&gt;();</div><div class="line">        s.put(<span class="keyword">new</span> PhoneNumber(<span class="number">707</span>, <span class="number">867</span>, <span class="number">5309</span>), <span class="string">"Jenny"</span>);</div><div class="line">        System.out.println(s.get(<span class="keyword">new</span> PhoneNumber(<span class="number">707</span>, <span class="number">867</span>, <span class="number">5309</span>)));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>TestHashCode 运行结果如下</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-c5188e903a5f7e47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>String对象重写了hashCode，所以没啥问题，但是后面就不一样了。<br>很明显两个PhoneNumber实例逻辑是相等的：第一个被用于插入到HashMap中，第二个实例用于（试图用于）获取。由于PhoneNumber类没有覆盖hashCode方法，从而导致两个相等的实例具有不相等的散列码，违反了hashCode的约定。这样，用第二个实例去取Value的时候，现在的hashCode不在HashMap的hash bucket中，没有办法找到存放的value，即使对象明明相等。</p>
<p>那么如何写hashCode方法呢？<br>最好根据类的关键域（参与equals方法比较的属性）来写，书中给出了这样的建议：</p>
<blockquote>
<ol>
<li>把某个非零的常数值，比如说17，保存在一个名为result的int类型的变量中。</li>
<li>对于对象中每个关键域f（指equals方法中涉及的每个域），完成以下步骤：</li>
</ol>
<ul>
<li>a. 为该域计算int类型的散列码c:<ul>
<li>i. 如果该域是boolean类型，则计算(f ? 1 : 0).</li>
<li>ii. 如果该域是byte、char、short或者int类型，则计算(int)f。</li>
<li>iii. 如果该域是long类型，则计算(int)(f ^ (f &gt;&gt;&gt; 32))。</li>
<li>iv. 如果该域是float类型，则计算Float.floatToIntBits(f)。</li>
<li>v. 如果该域是double类型，则计算Double.doubleToLongBits(f)，然后按照步骤2.a.iii，为得到的long类型值计算散列值。</li>
<li>vi. 如果该域是一个对象引用，并且该域的equlas方法通过递归地调用equlas的方式来比较这个域，则同样为这个域递归地调用hashCode。如果需要更复杂的比较，则为这个域计算一个“范式（canonical representation）”，然后针对这个范式调用hashCode。如果这个域的值为null，则返回0（或者其他某个常数，但通常是0）。</li>
<li>vii. 如果该域是一个数组，则要把每一个元素当做单独的域来处理。也就是说，递归地应用上述规则，对每个重要的元素计算一个散列码，然后根据步骤2.b中的做法把这些散列值组合起来。如果数组域中的每个元素都很重要，可以利用发行版本1.5中增加的其中一个Arrays.hashCode方法。</li>
</ul>
</li>
<li>b. 按照下面的公式，把步骤2.a中计算得到的散列码c合并到result中：<br>result = 31 * result + c;</li>
</ul>
<ol>
<li>返回result。</li>
</ol>
</blockquote>
<h2 id="0x03-toString方法的好处"><a href="#0x03-toString方法的好处" class="headerlink" title="0x03 toString方法的好处"></a>0x03 toString方法的好处</h2><p>这条不多说了，这个方法可以让类在运行的时候具有更高的可读性，方便调试。</p>
<h2 id="0x04-谨慎使用clone方法"><a href="#0x04-谨慎使用clone方法" class="headerlink" title="0x04 谨慎使用clone方法"></a>0x04 谨慎使用clone方法</h2><p>Object的clone方法是受保护的。如果不借助于反射（reflection）（见第53条），就不能仅仅因为一个对象实现了Cloneable，就可以调用clone方法。<br>而且目前JDK中对clone的约束非常弱。<br>一般情况下，良好的clone方法可以调用构造器来创建对象，构造之后再复制内部数据。如果这个类是final的，clone甚至可能会返回一个由构造器创建的对象。</p>
<p>Cloneable接口并没有清楚地指明，一个类在实现这个接口时应该承担哪些责任。一个默认调用的是super.clone()，这样不能保证<code>x.clone().getClass() == x.getClass()</code> 返回true了。这不太合逻辑。</p>
<p>另外，如果对象中的属性是个引用对象，那么Clone出来的东西就可能出现各种问题。操作源对象的属性将会影响克隆对象的属性，结果将是灾难性的。</p>
<p>另外，也不可以在一个类中的构造函数中使用clone方法。<br>clone方法再线程安全的类中也需要谨慎使用，保证同步。</p>
<p>因为Cloneable缺陷很多，所以非必要一般不使用。</p>
<p>##0x05 考虑实现一下Comparable接口<br>实现Comparable就表示类的对象中存在大小先后关系，允许执行顺序比较。实现Comparable接口的对象数组进行排序<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Arrays.sort(a);</div></pre></td></tr></table></figure></p>
<p>实现这个接口和重新equals方法有点类似：</p>
<blockquote>
<p>符号sgn（表达式）表示数学中的signum函数，它根据表达式（expression）的值为负值、零和正值，分别返回-1、0或1。</p>
<ul>
<li>实现者必须确保所有的x和y都满足sgn(x.compareTo(y) == -sgn(y.compareTo(x)))。（这也暗示着，当且仅当y.compareTo(x)抛出异常时，x.compareTo(y)才必须抛出异常。）</li>
<li>实现者还必须确保这个比较关系是可传递的：x.compareTo(y) &gt; 0 &amp;&amp; y.compareTo(z) &gt; 0暗示着x.compareTo(z) &gt; 0。</li>
<li>最后，实现者必须确保x.compareTo(y) == 0暗示着所有的z都满足sgn(x.compareTo(z)) == sgn(y.compareTo(z))。</li>
<li>强烈建议(x.compareTo(y) == 0) == (x.equals(y))，但这并非绝对必要。一般说来，任何实现了Comparable接口的类，若违反了这个条件，都应该明确予以说明。推荐使用这样的说法：“注意，该类具有内在的排序功能，但是与equals不一致。”</li>
</ul>
</blockquote>
<p>另外，注意compareTo方法中最好不要有可能溢出的计算，会导致compareTo方法返回错误的结果</p>
<p>love &amp; peace</p>
<p>转载请注明出处：<a href="https://micorochio.github.io/2017/08/06/reading-effective-java-02/">https://micorochio.github.io/2017/08/06/reading-effective-java-02/</a></p>
<p>如若有误请帮忙指正，谢谢</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;第三章讲了一些通用的方法。看的时候很快，记笔记的时候慢了&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-7341f62f8111e454.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=&quot;298&quot; height=&quot;52&quot; src=&quot;//music.163.com/outchain/player?type=2&amp;id=2116504&amp;auto=1&amp;height=32&quot;&gt;&lt;/iframe&gt;

&lt;h2 id=&quot;0x01-equals方法应该如何写&quot;&gt;&lt;a href=&quot;#0x01-equals方法应该如何写&quot; class=&quot;headerlink&quot; title=&quot;0x01 equals方法应该如何写&quot;&gt;&lt;/a&gt;0x01 equals方法应该如何写&lt;/h2&gt;&lt;p&gt;equals 方法是对象判断是否相等的方法，如果一个类具有多实例的需求时，可以重equals方法来判断两个对象是否相等。&lt;/p&gt;
&lt;p&gt;除非：&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;类的每个实例都是唯一的&lt;/li&gt;
&lt;li&gt;不关心实例是否逻辑上相等&lt;/li&gt;
&lt;li&gt;父类已经重写了equals &lt;/li&gt;
&lt;li&gt;类是私有的，equals方法永远不会被调用&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="笔记" scheme="http://micorochio.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
      <category term="Java基础" scheme="http://micorochio.github.io/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>Effective Java 读书笔记-第二章</title>
    <link href="http://micorochio.github.io/2017/07/28/reading-effective-java-01/"/>
    <id>http://micorochio.github.io/2017/07/28/reading-effective-java-01/</id>
    <published>2017-07-27T23:15:36.000Z</published>
    <updated>2017-07-29T16:15:27.000Z</updated>
    
    <content type="html"><![CDATA[<p>Thinking in java 太厚了，我不想看，所以先拿EJ开坑。<br>Effective Java 和 Thinking in java都是java基础评分超高的书，所以有必要看一看。<br>Effective Java这本书被java之父推荐，所以特意买了本正版。</p>
<blockquote>
<p>我很希望10年前就拥有这本书。可能有人认为我不需要任何Java方面的书籍，但是我需要这本书。<br><br>——Java 之父 James Gosling</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-b9600d580327741e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>当然，这本书是2009年出版的，已经过去N多个年头，所以带着“批判”的眼光来瞻仰这本巨作。</p>
<a id="more"></a>
<p>ps：中文版的翻译真是烂的可以，英文厉害的强烈推荐看英文原版，另外，新手还是先多搬砖，或者去看看java核心技术上下两卷，这本书不适合0基础。</p>
<h2 id="0x01-静态工厂方法代替构造器"><a href="#0x01-静态工厂方法代替构造器" class="headerlink" title="0x01 静态工厂方法代替构造器"></a>0x01 静态工厂方法代替构造器</h2><p>用静态工厂方法代替构造器有什么好处呢？</p>
<blockquote>
<ol>
<li>静态工厂方法有方法名称，可以更确切的针对对象进行不同的构造如构造素数和正整数，可以在同一个类里放两个不同的工厂方法，起两个有意义的名字</li>
<li>工厂方法不一定每次都会创建一个新对象，如果配合单例，会有更好的性能提升（这个视场景而定）</li>
<li>可以返回子类型的对象，具有更高的灵活性。</li>
<li>在创建参数化实例时，代码更加简洁（这个书中使用了泛型作为例子，现在java已经有了类型推断的能力，所以看情况咯）<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//以前</span></div><div class="line"> Map&lt;String,List&lt;String&gt;&gt; m = <span class="keyword">new</span> HashMap&lt;String,List&lt;String&gt;&gt;();</div><div class="line"><span class="comment">//现在</span></div><div class="line">Map&lt;String,List&lt;String&gt;&gt; m = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"> <span class="comment">//工厂</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;K,V&gt; <span class="function">HashMap&lt;K,V&gt; <span class="title">newIncetance</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HashMap&lt;K,V&gt;();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<p>当然工厂方法也有缺点</p>
<blockquote>
<ol>
<li>如果类中没有public 或者protected的构造器，就不能子类化</li>
<li>工厂方法和其他静态方法没有区别，所以不能作为特殊的方法对待</li>
</ol>
</blockquote>
<h2 id="0x02-构造器"><a href="#0x02-构造器" class="headerlink" title="0x02 构造器"></a>0x02 构造器</h2><p>上面提到的工厂方法和类的构造函数对多个可选参数时，劣势就明显出来了，一个方法中包含多个参数对调用方是非常不友好的，这时候可以考虑使用构造器（Builder）<br>放上书中的实例<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Builder Pattern</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NutritionFacts</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servingSize;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servings;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> calories;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> fat;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> sodium;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> carbohydrate;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line">        <span class="comment">// Required parameters</span></div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servingSize;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servings;</div><div class="line"></div><div class="line">        <span class="comment">// Optional parameters - initialized to default values</span></div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> calories     = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> fat          = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> sodium       = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> carbohydrate = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.servingSize = servingSize;</div><div class="line">            <span class="keyword">this</span>.servings    = servings;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">calories</span><span class="params">(<span class="keyword">int</span> val)</span> </span></div><div class="line">            &#123; calories = val;        <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">fat</span><span class="params">(<span class="keyword">int</span> val)</span></span></div><div class="line">            &#123; fat = val;             <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">sodium</span><span class="params">(<span class="keyword">int</span> val)</span></span></div><div class="line">            &#123; sodium = val;          <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">carbohydrate</span><span class="params">(<span class="keyword">int</span> val)</span></span></div><div class="line">            &#123; carbohydrate = val;    <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> NutritionFacts <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> NutritionFacts(<span class="keyword">this</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">NutritionFacts</span><span class="params">(Builder builder)</span> </span>&#123;</div><div class="line">        servingSize  = builder.servingSize;</div><div class="line">        servings     = builder.servings;</div><div class="line">        calories     = builder.calories;</div><div class="line">        fat          = builder.fat;</div><div class="line">        sodium       = builder.sodium;</div><div class="line">        carbohydrate = builder.carbohydrate;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样调用方就可以非常方便的构造出带有不同属性的对象了,这些属性都是可选的，而且可读性非常好<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NutritionFacts cocaCola = <span class="keyword">new</span> NutritionFacts.Builder(<span class="number">240</span>, <span class="number">8</span>)</div><div class="line">    .calories(<span class="number">100</span>).sodium(<span class="number">35</span>).carbohydrate(<span class="number">27</span>).build();</div></pre></td></tr></table></figure></p>
<p>但是Builder模式也不是完美的，创建对象前需要先创建Builder对象，而且Builder代码相对比较多，并不适合参数少的时候使用。但是一个类如果要考虑以后扩展属性，最好一开始就使用Builder模式，因为属性越多，静态工厂和构造函数就越难控制。</p>
<h2 id="0x03-单例模式"><a href="#0x03-单例模式" class="headerlink" title="0x03 单例模式"></a>0x03 单例模式</h2><p>单例模式一般面试被问到的可能性比较高，什么饱汉饿汉的区别，几种单例模式的写法，单例模式的好处自然是很多的，对只需要被实例化一次的类，最好使用单例模式<br>一般单例模式的类的构造器被私有化，并且加了一重或者两重判断来保障线程安全，并且有的写法还在构造器中添加防止反射强制实例化的代码。<br>关于单例模式的几种写法我就不写了，网上有。<br>Effective Java上介绍的单例模式的代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 单例模式静态成员变量</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Elvis INSTANCE = <span class="keyword">new</span> Elvis();</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span> </span>&#123; ... &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123; ... &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 静态工厂方法</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Elvis INSTANCE = <span class="keyword">new</span> Elvis();</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span> </span>&#123; ... &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Elvis <span class="title">getInstance</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> INSTANCE &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123; ... &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 枚举单例模式</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Elvis &#123;</div><div class="line">    INSTANCE;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123; ... &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>另外为了防止反序列化出假冒的单利的对象，书上说要加上这么一句。具体的牵扯到后面内容，坑以后填。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// readResolve method to preserve sigleton property</span></div><div class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// Return the one true Elvis and let the garbage collector</span></div><div class="line">    <span class="comment">// take care of the Elvis impersonator.</span></div><div class="line">    <span class="keyword">return</span> INSTANCE;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##0x04 私有构造器强化 禁止工具类被实例化<br>Math类，Arrays类这些工具类是不应该被实例化的，因为里面的方法都是静态的。并且没有实例化的意义，实例化反而会浪费内存。所以编写这类Java类的时候，最好将构造器私有化。<br>当实例化这些类的时候，应该有异常抛出。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UtilityClass</span> </span>&#123;</div><div class="line">    <span class="comment">// Suppress default constructor for noninstantiability</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">UtilityClass</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError();</div><div class="line">    &#125;</div><div class="line">    ... <span class="comment">// Remainder omitted</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##0x05 不重复创建对象</p>
<p>书中建议相同功能的对象只需要创建一次就行了，不需要多次创建，另外要尽可能的重用对象，高效运用内存。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String s = <span class="keyword">new</span> String(<span class="string">"stringette"</span>); <span class="comment">// 别这么干！</span></div></pre></td></tr></table></figure></p>
<p>上面的代码会在常量池创建一个String，再在用构造器在堆里创建一个String，相当于两次创建，最好是这样的写法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String s = <span class="string">"stringette"</span>;</div></pre></td></tr></table></figure>
<p>另外不变的常亮最好事先加载，不要每次使用对象的时候重新创建。书中用了一个例子，判断一个人是不是1946年至1964年生的<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Date birthDate;</div><div class="line"></div><div class="line">    <span class="comment">// 2B程序员的写法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBabyBoomer</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 没有必要每次都创建Calendar对象</span></div><div class="line">        Calendar gmtCal = </div><div class="line">            Calendar.getInstance(TimeZone.getTimeZone(<span class="string">"GMT"</span>));</div><div class="line">        gmtCal.set(<span class="number">1946</span>, Calendar.JANUARY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        Date boomStart = gmtCal.getTime();</div><div class="line">        gmtCal.set(<span class="number">1964</span>, Calendar.JANUARY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        Date boomEnd = gmtCal.getTime();</div><div class="line">        <span class="keyword">return</span> birthDate.compareTo(boomStart) &gt;= <span class="number">0</span> &amp;&amp; </div><div class="line">               birthdate.compareTo(boomEnd)   &lt;  <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>很明显，下面代码会好很多，如果你看不出来，请回炉重学java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Date birthDate;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 正经程序员的写法</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Date BOOM_START;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Date BOOM_END;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        Calendar gmtCal = </div><div class="line">            Calendar.getInstance(TimeZone.getTimeZone(<span class="string">"GMT"</span>));</div><div class="line">        gmtCal.set(<span class="number">1946</span>, Calendar.JANUARY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        BOOM_START = gmtCal.getTime();</div><div class="line">        gmtCal.set(<span class="number">1964</span>, Calendar.JANUARY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        BOOM_END = gmtCal.getTime();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBabyBoomer</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> birthDate.compareTo(boomStart) &gt;= <span class="number">0</span> &amp;&amp; </div><div class="line">               birthdate.compareTo(boomEnd)   &lt;  <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在这一节，还讲到了拆装箱对程序性能的影响</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">    Long sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">long</span> i = <span class="number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;</div><div class="line">        sum += i;</div><div class="line">    &#125;</div><div class="line">    System.out.println(sum);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>因为将long的第一个字母大写了，导致程序慢了近40秒。<br>并不是所有创建对象的开销都很大，但是重复创建是很浪费的，内存就那么大，CPU速度也有上限，无意义的拆装箱浪费了性能。所以养成好习惯，节约内存。</p>
<p>另外书中说自己维护对象池是个费力不讨好的事情，如果能交给GC，请务必交给GC。否则代码后期维护将是一个很重量级的工作。</p>
<h2 id="0x06-及时丢弃无用对象"><a href="#0x06-及时丢弃无用对象" class="headerlink" title="0x06 及时丢弃无用对象"></a>0x06 及时丢弃无用对象</h2><p>首先看一段代码,是一种栈的实方式<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 这里藏着一个内存泄漏的隐患</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stack</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Object[] elements;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">16</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Stack</span><span class="params">()</span> </span>&#123;</div><div class="line">        elements = <span class="keyword">new</span> Object[DEFAULT_INITIAL_CAPACITY];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Object e)</span> </span>&#123;</div><div class="line">        ensureCapacity();</div><div class="line">        elements[size++] = e;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">pop</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> EmptyStackException();</div><div class="line">        <span class="keyword">return</span> elements[--size];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 确保至少有一个元素的可用空间，每次到达临界时让容量增加一倍。</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (elements.length == size)</div><div class="line">            elements = Arrays.copayOf(elements, <span class="number">2</span> * size + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">``` </div><div class="line"></div><div class="line">写C/C++的程序员在对象失去作用的时候，会把对象置空。这个是好办法，但是java里没有必要这样,所以程序员对释放资源松懈了.</div><div class="line">栈弹出元素后，需要解除对这个元素的引用，否则有可能会导致内存泄漏。</div><div class="line"></div><div class="line">```<span class="function">java</span></div><div class="line"><span class="keyword">public</span> Object <span class="title">pop</span><span class="params">()</span> &#123;</div><div class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>)</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> EmptyStackException();</div><div class="line">    Object result = elements[--size];</div><div class="line">    elements[size] = <span class="keyword">null</span>; <span class="comment">// 置空引用</span></div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>java的缓存是一个内存泄漏的高发地段，因为缓存的对象会被遗忘，最后即使不用也放在缓存中，所以现在的带缓存的功能都有一个时间机智，一段时间不用后，自动回收。</p>
<p>另外回调函数也有可能造成内存泄漏。如果一个对象注册了回调，但是还没等到回调这个对象就被干掉了，这时候，回调的时候就出现了内存泄漏问题。所以注册回调的时候最好是弱引用。减少内存泄漏的概率</p>
<h2 id="0x07-尽量别使用finalizer方法"><a href="#0x07-尽量别使用finalizer方法" class="headerlink" title="0x07 尽量别使用finalizer方法"></a>0x07 尽量别使用finalizer方法</h2><p>书中说了很多，概括一下就是</p>
<ul>
<li>使用这个方法不知道什么时候会被调用，甚至不会执行，容易造成内存泄漏</li>
<li>即使被调用了，不一定会让你得到想要的结果，比如打印异常日志。</li>
<li>如果是多线程，分布式系统，容易导致系统崩溃。（线程被锁住，宕机）</li>
<li>严重的性能损耗<br>所以能在对象回收前做完的，不要等到对象失去引用后再做！能不用finalize()方法就不用。</li>
</ul>
<p>至于好处嘛，finalizer方法的确有两个优点<br>当对象的所有者忘记调用前面段落中建议的显式终止方法时，可以作为保险方法<br>另一种是对GC不知道的对象进行保险回收操作，比如Native Peer对象。</p>
<p>（<code>FileInputStream</code>、<code>FileOutputStream</code>、<code>Timer</code>和<code>Connection</code>），都具有终结方法，当它们的close方法未能被调用的情况下，终结方法提供了一层保障。<br>书上说：</p>
<blockquote>
<p>总之，除非是作为安全网，或者是为了终止非关键的本地资源，否则请不要使用终结方法。在这些很少见的情况下，既然使用了终结方法，就要记住调用super.finalize。如果终结方法作为安全网，要记得记录终结方法的非法用法。最后，如果需要把终结方法与公有的非final类关联起来，请考虑使用终结方法守卫者，以确保即使子类的终结方法未能调用super.finalize，该终结方法也会被执行。</p>
</blockquote>
<p>love &amp; peace</p>
<p>转载请注明出处：<a href="https://micorochio.github.io/2017/07/28/reading-effective-java-01/">https://micorochio.github.io/2017/07/28/reading-effective-java-01/</a></p>
<p>如若有误请帮忙指正，谢谢</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Thinking in java 太厚了，我不想看，所以先拿EJ开坑。&lt;br&gt;Effective Java 和 Thinking in java都是java基础评分超高的书，所以有必要看一看。&lt;br&gt;Effective Java这本书被java之父推荐，所以特意买了本正版。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我很希望10年前就拥有这本书。可能有人认为我不需要任何Java方面的书籍，但是我需要这本书。&lt;br&gt;&lt;br&gt;——Java 之父 James Gosling&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-b9600d580327741e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;当然，这本书是2009年出版的，已经过去N多个年头，所以带着“批判”的眼光来瞻仰这本巨作。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="笔记" scheme="http://micorochio.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
      <category term="Java基础" scheme="http://micorochio.github.io/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>Ansible自动化部署从入门到弃坑</title>
    <link href="http://micorochio.github.io/2017/06/19/ansible-learning-03/"/>
    <id>http://micorochio.github.io/2017/06/19/ansible-learning-03/</id>
    <published>2017-06-18T17:48:58.000Z</published>
    <updated>2017-06-24T07:37:56.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/1112615-d08c2ab7f6cf7012.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="0x00-Before"><a href="#0x00-Before" class="headerlink" title="0x00 @Before"></a>0x00 @Before</h2><p>上次Ansible自动部署入门，最后写了点playbook的项目，了解了一些如task，template，vars等简单的用法。但是真正的Ansible项目并不是通过主机来分Roles的，而是一个Ansible管理多台主机，用Roles来区分项目。<br>所以这一次，我带来了不一样的使用姿势。<br><a id="more"></a></p>
<h2 id="1x00-Playbook再介绍"><a href="#1x00-Playbook再介绍" class="headerlink" title="1x00 Playbook再介绍"></a>1x00 Playbook再介绍</h2><p>playbook 是剧本，我在上片已经介绍了点，总之入口是一个yml文件<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- hosts:</span> <span class="string">local</span></div><div class="line"><span class="attr">  remote_user:</span> <span class="string">zing</span></div><div class="line"><span class="attr">  environment:</span> </div><div class="line"><span class="attr">    JAVA_HOME:</span>  <span class="string">/application/jdk8/</span></div><div class="line"><span class="attr">    JRE_HOME:</span> <span class="string">/application/jdk8/jre/</span></div><div class="line"><span class="attr">    M2_HOME:</span> <span class="string">/application/maven/bin/</span></div><div class="line"><span class="attr">  tasks:</span></div><div class="line"><span class="attr">    - name:</span> <span class="string">package</span> <span class="string">project</span></div><div class="line"><span class="attr">      shell:</span> <span class="string">mvn</span> <span class="string">clean</span> <span class="string">package</span></div><div class="line"><span class="attr">      remote_user:</span> <span class="string">zing</span></div><div class="line"><span class="attr">    - name:</span> <span class="string">deploy</span> <span class="string">to</span> <span class="string">maven</span> <span class="string">service</span></div><div class="line"><span class="attr">      shell:</span> <span class="string">mvn</span> <span class="string">deploy</span></div><div class="line"><span class="attr">      sudo:</span> <span class="literal">yes</span></div><div class="line"><span class="attr">      ignore_errors:</span> <span class="literal">yes</span></div></pre></td></tr></table></figure></p>
<p>如果项目简单, 一个playbook.yml文件就可以搞定了</p>
<h3 id="1x01-Handler"><a href="#1x01-Handler" class="headerlink" title="1x01 Handler"></a>1x01 Handler</h3><p>handler，用来执行某些条件下的任务，比如当配置文件发生变化的时候，通过notify触发handler去重启服务器。如下面playbook。<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- hosts:</span> <span class="string">local</span></div><div class="line"><span class="attr">  remote_user:</span> <span class="string">zing</span></div><div class="line"><span class="attr">  tasks:</span></div><div class="line"><span class="attr">    - name:</span> <span class="string">copy</span> <span class="string">properties</span></div><div class="line"><span class="attr">      copy:</span> <span class="string">src=/home/zing/project.properties</span> <span class="string">dest=/home/java/pro/project.properties</span></div><div class="line"><span class="attr">    - name:</span> </div><div class="line"><span class="attr">      file:</span> <span class="string">path=/home/java/pro/project.properties</span> <span class="string">mode=600</span></div><div class="line"><span class="attr">      notify:</span></div><div class="line"><span class="bullet">        -</span> <span class="string">restart</span> <span class="string">server</span></div><div class="line"><span class="attr">  handlers:</span></div><div class="line"><span class="attr">    - name:</span> <span class="string">restart</span> <span class="string">server</span></div><div class="line"><span class="attr">      service:</span> <span class="string">name=tomcat</span> <span class="string">state=restarted</span></div></pre></td></tr></table></figure></p>
<p>还有一种条件判断，可以直接写在task里面，如下<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- hosts:</span> <span class="string">local</span></div><div class="line"><span class="attr">  remote_user:</span> <span class="string">zing</span></div><div class="line"><span class="attr">  tasks:</span></div><div class="line"><span class="attr">    - name:</span> <span class="string">copy</span> <span class="string">properties</span></div><div class="line"><span class="attr">      copy:</span> <span class="string">src=/home/zing/project.properties</span> <span class="string">dest=/home/java/pro/project.properties</span></div><div class="line"><span class="attr">    - name:</span> <span class="string">modify</span> <span class="string">project</span> <span class="string">property</span></div><div class="line"><span class="attr">      file:</span> <span class="string">path=/home/java/pro/project.properties</span> <span class="string">mode=600</span></div><div class="line"><span class="attr">    - name:</span> <span class="string">restart</span> <span class="string">server</span> <span class="string">when</span> <span class="string">server</span> <span class="string">is</span> <span class="string">zing</span></div><div class="line"><span class="attr">      service:</span> <span class="string">name=tomcat</span> <span class="string">state=restarted</span></div><div class="line"><span class="attr">      when:</span> <span class="string">result|changed</span></div></pre></td></tr></table></figure></p>
<p>when的用法还有很多，可以自己探索。不过一般用Handler会更加灵活一些。when的条件判断需要了解很多Ansible变量，想知道的话，可以自己参考官方文档</p>
<h3 id="1x02-循环迭代"><a href="#1x02-循环迭代" class="headerlink" title="1x02 循环迭代"></a>1x02 循环迭代</h3><p>上一篇文章已经写过迭代了，我怕写的笼统，这里再拿出来讲一下</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- hosts:</span> <span class="string">local</span></div><div class="line"><span class="attr">  remote_user:</span> <span class="string">zing</span></div><div class="line"><span class="attr">  tasks:</span></div><div class="line"><span class="attr">    - name:</span> <span class="string">transfom</span> <span class="string">template</span></div><div class="line"><span class="attr">      template:</span> <span class="string">src="&#123;</span> <span class="string">&#123;item.file_src&#125;</span> <span class="string">&#125;"</span> <span class="string">dest="&#123;</span> <span class="string">&#123;item.target_file_path&#125;</span> <span class="string">&#125;"</span></div><div class="line"><span class="attr">      with_items:</span></div><div class="line"><span class="bullet">        -</span> <span class="string">&#123;file_src:</span> <span class="string">'/home/zing/template/application.j2'</span><span class="string">,</span> <span class="attr">target_file_path:</span> <span class="string">'/home/service/resources/application.properties'</span><span class="string">&#125;</span></div><div class="line"><span class="bullet">        -</span> <span class="string">&#123;file_src:</span> <span class="string">'/home/zing/template/config.j2'</span><span class="string">,</span> <span class="attr">target_file_path:</span> <span class="string">'/home/service/resources/config.properties'</span><span class="string">&#125;</span></div></pre></td></tr></table></figure>
<p>使用with_items，将下面的参数迭代进tasks里面，这样每一个参数都按照变量名称会放入<code>{ {  } }</code>对应的变量名称中。直到item循环迭代介绍，才会执行下一个task</p>
<h2 id="1x03-Tags"><a href="#1x03-Tags" class="headerlink" title="1x03 Tags"></a>1x03 Tags</h2><p>通过tag可以指定运行的task，然而简单的部署时tag并不常用，需要tag的时候一般可以直接使用ansible命令处理，或者再写新的playbook。只有在大型项目部署的时候，偶尔才会使用。所以只简单介绍一下tag的用法。</p>
<ul>
<li><p>首先，在tasks内的yml文件中，对需要的task打上tag：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- name:</span> <span class="string">yun</span> <span class="string">install</span> <span class="string">package</span> </div><div class="line"><span class="attr">  yum:</span> <span class="string">name="&#123;</span> <span class="string">&#123;</span> <span class="string">item</span> <span class="string">&#125;</span> <span class="string">&#125;"</span> <span class="string">state=installed</span> </div><div class="line"><span class="attr">  with_items:</span> </div><div class="line"><span class="bullet">     -</span> <span class="string">httpd</span> </div><div class="line"><span class="bullet">     -</span> <span class="string">memcached</span> </div><div class="line"><span class="attr">  tags:</span> </div><div class="line"><span class="bullet">     -</span> <span class="string">packages</span> </div><div class="line"></div><div class="line"><span class="attr"> - name:</span> <span class="string">configuration</span> <span class="string">modity</span> </div><div class="line"><span class="attr">  template:</span> <span class="string">src=templates/src.j2</span> <span class="string">dest=/etc/foo.conf</span> </div><div class="line"><span class="attr">  tags:</span> </div><div class="line"><span class="bullet">      -</span> <span class="string">configuration</span></div></pre></td></tr></table></figure>
</li>
<li><p>调用某个tag：</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook example.yml – tags “configuration,packages”</div></pre></td></tr></table></figure>
<p>task可以打上任意多个tag。</p>
<h3 id="1x04-变量"><a href="#1x04-变量" class="headerlink" title="1x04 变量"></a>1x04 变量</h3><p>变量分好几种，可以定义在playbook中，也可以定义在hosts文件上，后面也可以写在roles的vars文件夹中。<br>上面介绍循环迭代，<code>{ {item.file_src} }</code>就是变量引用，<code>with_items</code>下的就是变量值。变量可以放置在几乎所有地方，除了关键字外，其他地方都可以引用变量。Ansible自己也定义了好多自带的变量，有兴趣的可以自己看看</p>
<p>hosts主机变量如下<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> 针对主机的主机变量</span></div><div class="line">127.0.0.1 my_name_is=zing</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> 针对组的变量</span></div><div class="line">[webServer]</div><div class="line">domain1.example.com</div><div class="line">domain2.example.com</div><div class="line">[webServer:vars]</div><div class="line">server_user_name_is="zing"</div><div class="line">server_user_is="java_programer"</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> 针对所有主机的所有变量</span></div><div class="line">[all:vars]</div><div class="line">user_name_is="zing"</div><div class="line">user_is="java_programer"</div></pre></td></tr></table></figure></p>
<p>使用变量只要在正确的位置加上变量引用<code>{ { varable_name } }</code>就好<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- hosts:</span> <span class="string">local</span></div><div class="line"><span class="attr">  remote_user:</span> <span class="string">"&#123; &#123; user_name_is &#125; &#125;”</span></div><div class="line">  tasks:</div><div class="line">    - name: copy properties</div><div class="line">      copy: src=/home/zing/project.properties</div></pre></td></tr></table></figure></p>
<blockquote>
<p>Ansible支持复杂变量，我们的<code>{ { item.src } }</code>就是一个复杂型的，通过<code>.</code>来引用item下的src值。所以，变量名称不要带<code>.</code>。</p>
</blockquote>
<p>复杂变量也很简单。不过一般定义在yaml文件里面，playbook中可以这么定义<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- hosts:</span> <span class="string">local</span></div><div class="line"><span class="attr">  remote_user:</span> <span class="string">zing</span></div><div class="line"><span class="attr">  tasks:</span></div><div class="line"><span class="attr">    - name:</span> <span class="string">start</span> <span class="string">server</span> <span class="string">&#123;</span> <span class="string">&#123;</span> <span class="string">server1.name</span> <span class="string">&#125;</span> <span class="string">&#125;</span></div><div class="line"><span class="attr">      service:</span> <span class="string">name=tomcat</span> <span class="string">state=restarted</span></div><div class="line"><span class="attr">  vars:</span></div><div class="line"><span class="attr">    server1:</span></div><div class="line"><span class="attr">        name:</span> <span class="string">"zing_service"</span></div><div class="line"><span class="attr">        type:</span> <span class="string">"tomcat"</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意：<br>某些时候YAML冒号后面的值不能以{开头，如果有要以{开头，必须加上引号。解决方式如下。<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- hosts:</span> <span class="string">zing_servers</span></div><div class="line"><span class="attr">  vars:</span></div><div class="line"><span class="attr">       server_path:</span> <span class="string">"&#123; &#123; base_path &#125; &#125;/zing"</span></div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="1x05-模板和变量搭配使用"><a href="#1x05-模板和变量搭配使用" class="headerlink" title="1x05 模板和变量搭配使用"></a>1x05 模板和变量搭配使用</h3><p>所谓的模板就是以一个现成的文件为样板，向其中填充参数，来生成我们需要的真实文件，这个无须多介绍，参考<br><a href="https://micorochio.github.io/2017/06/05/ansible-learning-02/#0x03-yaml和playbook">https://micorochio.github.io/2017/06/05/ansible-learning-02/#0x03-yaml和playbook</a><br>下的 application.properties.j2 文件写法，双大括号里的参数会被定义的变量所替换，文件替换流程参考下面的写法<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- name:</span> <span class="string">transfom</span> <span class="string">template</span></div><div class="line"><span class="attr">  template:</span> <span class="string">src=&#123;</span> <span class="string">&#123;item.template_file&#125;</span> <span class="string">&#125;</span> <span class="string">dest=&#123;</span> <span class="string">&#123;item.target_file&#125;</span> <span class="string">&#125;</span></div><div class="line"><span class="attr">  with_items:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">&#123;template_file:</span> <span class="string">'template/application.j2'</span><span class="string">,</span> <span class="attr">target_file:</span> <span class="string">'resources/application.properties'</span><span class="string">&#125;</span></div><div class="line"><span class="bullet">    -</span> <span class="string">&#123;template_file:</span> <span class="string">'template/config.j2'</span><span class="string">,</span> <span class="attr">target_file:</span> <span class="string">'resources/config.properties'</span><span class="string">&#125;</span></div></pre></td></tr></table></figure></p>
<p>这段task的意思是：将item的模板template_file转换成target_file。定义多个item 自动迭代，将参数替换到task变量中</p>
<h2 id="2x00-Roles"><a href="#2x00-Roles" class="headerlink" title="2x00 Roles"></a>2x00 Roles</h2><p>这是个新的概念，playbook只能管理一个项目的话，通过Roles可以用一个ansible工程，管理公司所有的工程。上一篇文章，我介绍的Roles是根据主机来分Roles（角色）的，实际开发中，大多是根据项目名称来分角色。这样一套ansible，就能hold住全部工程。</p>
<p>###2x01 正确的ansible工程目录<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">inventory/                   <span class="comment">//hosts文件夹</span></div><div class="line">    project_a_host           <span class="comment">//工程a的hosts</span></div><div class="line">    project_a_hosts          <span class="comment">//工程b的hosts</span></div><div class="line">project_a_playbook.yml       <span class="comment">//参考上篇文章的side.yml</span></div><div class="line">project_b_playbook.yml       <span class="comment">//参考上篇文章的side.yml</span></div><div class="line">roles/                       <span class="comment">//roles文件夹，第一级子文件夹就是就是role的名称</span></div><div class="line">   project_a/                <span class="comment">//role,表示工程A</span></div><div class="line">     files/                  <span class="comment">//一般用来存放脚本，或者其他部署时需要使用的文件</span></div><div class="line">     templates/              <span class="comment">//存放模板</span></div><div class="line">     tasks/                  <span class="comment">//存放任务tasks</span></div><div class="line">     handlers/               <span class="comment">//存放Handler</span></div><div class="line">     vars/                   <span class="comment">//存放本角色可以使用的变量</span></div><div class="line">     defaults/               <span class="comment">//用来存放默认变量的，如果其他地方不定义，会在这里找，否则会使用其他地方定义的变量</span></div><div class="line">     meta/                   <span class="comment">//用于定义此角色的特殊设定及其依赖关系,我还没用到这个</span></div><div class="line">   project_b/</div><div class="line">     files/</div><div class="line">     templates/</div><div class="line">     tasks/</div><div class="line">     handlers/</div><div class="line">     vars/</div><div class="line">     defaults/</div><div class="line">     meta/</div></pre></td></tr></table></figure></p>
<h3 id="2x02-一个开源的-tomcat-工程实例"><a href="#2x02-一个开源的-tomcat-工程实例" class="headerlink" title="2x02 一个开源的 tomcat 工程实例"></a>2x02 一个开源的 tomcat 工程实例</h3><p>这个例子的开源地址：<a href="https://github.com/ansible/ansible-examples/tree/master/tomcat-memcached-failover" target="_blank" rel="external">https://github.com/ansible/ansible-examples/tree/master/tomcat-memcached-failover</a><br>这个例子很好的展示了Tomcat服务的自动化部署的Ansible工程写法</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-93ef05cd84dfacb3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="3x00部署一个Maven版的java项目"><a href="#3x00部署一个Maven版的java项目" class="headerlink" title="3x00部署一个Maven版的java项目"></a>3x00部署一个Maven版的java项目</h2><p>只是简单介绍一下从0开始到部署的一个流程，具体的例子，可以到<a href="https://github.com/ansible/ansible-examples" target="_blank" rel="external">https://github.com/ansible/ansible-examples</a> 上随意查找，里面应有尽有。</p>
<p>流程如下：</p>
<ul>
<li>所有主机安装Java （首次执行）</li>
<li>Ansible主机安装Maven（首次执行）</li>
<li>Ansible主机安装git （首次执行）</li>
<li>使用Ansible shell模块清理残余代码（首次无须执行）</li>
<li>Ansible主机使用git 获取Java项目源码</li>
<li>Ansible Template替换新源码</li>
<li>使用shell模块，执行mvn package打出jar包或者war包</li>
<li>服务主机安装服务软件Tomcat Nginx Mysql等（首次执行）</li>
<li>关闭服务（如果是热更新，无须关闭）</li>
<li>将jar包或者war包使用copy模块，传输到服务主机</li>
<li>修改服务软件配置等主机环境</li>
<li>启动服务</li>
</ul>
<p>如果是多项目部署，最好是：</p>
<ul>
<li>每个项目都有自己的role name，</li>
<li>运维负责在当前role使用的inventory文件中修改配置，</li>
<li>将这些配置通过模板的方式，覆盖到代码的各个配置文件中，</li>
<li>最后打成运行包，传输到承载软件的服务器上，启动即可。</li>
</ul>
<p>这样不会出现不同环境切换，程序员自己手动改配置，出现：在生产上使用了测试的数据库。生产服务连接测试的 redis，打爆了测试用的redis服务器还造成了严重的数据丢失。</p>
<h2 id="4x00Ansible和Jenkins一键部署"><a href="#4x00Ansible和Jenkins一键部署" class="headerlink" title="4x00Ansible和Jenkins一键部署"></a>4x00Ansible和Jenkins一键部署</h2><p>其实很简单，安装Jinkens，用Jinkens 执行<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook project-playbool.yml -i inventory-file</div></pre></td></tr></table></figure></p>
<p>下面的东西就交给Ansible了，不再需要用繁琐的Shell脚本来写Jenkins部署脚本了。并且，每个项目都是一键发布，而且不用维护用于项目发布的部署shell，十分轻量，尤其是对微服务，批量扩展和修改很方便。</p>
<p>写到这里就出坑了，毕竟不是专业的运维，多谢观看</p>
<p>##5x00 @After<br>参考：<br>极力推荐=》<a href="https://github.com/ansible/ansible-examples" target="_blank" rel="external">https://github.com/ansible/ansible-examples</a></p>
<blockquote>
<p>文章内代码部分，双花括号之间没有空格，为博客软件bug，无法解决。ansible项目中使用&#123;&#123; &#125;&#125;</p>
</blockquote>
<p>转载请注明出处：<a href="https://micorochio.github.io/2017/06/19/ansible-learning-03/">https://micorochio.github.io/2017/06/19/ansible-learning-03/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-d08c2ab7f6cf7012.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;0x00-Before&quot;&gt;&lt;a href=&quot;#0x00-Before&quot; class=&quot;headerlink&quot; title=&quot;0x00 @Before&quot;&gt;&lt;/a&gt;0x00 @Before&lt;/h2&gt;&lt;p&gt;上次Ansible自动部署入门，最后写了点playbook的项目，了解了一些如task，template，vars等简单的用法。但是真正的Ansible项目并不是通过主机来分Roles的，而是一个Ansible管理多台主机，用Roles来区分项目。&lt;br&gt;所以这一次，我带来了不一样的使用姿势。&lt;br&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="http://micorochio.github.io/tags/Linux/"/>
    
      <category term="ansible" scheme="http://micorochio.github.io/tags/ansible/"/>
    
      <category term="运维" scheme="http://micorochio.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
      <category term="自动化持续部署" scheme="http://micorochio.github.io/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/"/>
    
  </entry>
  
  <entry>
    <title>Ansible自动化部署入门</title>
    <link href="http://micorochio.github.io/2017/06/05/ansible-learning-02/"/>
    <id>http://micorochio.github.io/2017/06/05/ansible-learning-02/</id>
    <published>2017-06-04T17:48:58.000Z</published>
    <updated>2017-06-18T15:30:04.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/1112615-1a9c0f3807270562.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ul>
<li>Ansible的特性：<ul>
<li>ansible基于Python实现，有Paramiko、PyYAML、JinJia2主要模块</li>
<li>使用SSH链接主机，部署简单</li>
<li>可以使用自定义模块，也可以使用其他语言编写的模块，基于模块可以完成各种任务。</li>
</ul>
</li>
</ul>
<a id="more"></a>
<h1 id="0x00-Ansible-主机库文件：-hosts-inventory"><a href="#0x00-Ansible-主机库文件：-hosts-inventory" class="headerlink" title="0x00 Ansible 主机库文件： hosts inventory"></a>0x00 Ansible 主机库文件： hosts inventory</h1><p>host inventory是主机库文件，里面存放的是要管理的主机列表，和一些主机参数，另外也可以加入变量等自定义的参数。</p>
<p>一般来说，常见的主机库文件如下<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> 单独的主机域名</span></div><div class="line">mail.example.com</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash">单独的主机ip</span></div><div class="line">8.8.8.8</div><div class="line"></div><div class="line">[webservers] #主机组的名称</div><div class="line">127.0.0.1 #主机1</div><div class="line">bar.example.com #主机2</div><div class="line"></div><div class="line">[dbservers] #新的主机组</div><div class="line">one.example.com #主机1</div><div class="line">two.example.com #主机2</div><div class="line">three.example.com</div></pre></td></tr></table></figure></p>
<p><a href="https://micorochio.github.io/2017/05/31/ansible-learning-01/#0x02-host文件">https://micorochio.github.io/2017/05/31/ansible-learning-01/#0x02-host文件</a><br>上一次介绍了默认的主机库，其实在运行ansible 命令时，是可以指定inventory文件的<br>这里先不做介绍。带着下面问题，继续往下看</p>
<ul>
<li>hosts inventory的常用参数有哪些？</li>
<li>如何针对不同的环境，使用不同的hosts inventory文件？</li>
<li>hosts inventory如何定义变量？</li>
</ul>
<h1 id="0x01-入门级命令"><a href="#0x01-入门级命令" class="headerlink" title="0x01 入门级命令"></a>0x01 入门级命令</h1><p>上一次介绍了一个简单的ansible命令:<a href="https://micorochio.github.io/2017/05/31/ansible-learning-01/#0x03-爱因斯坦的小板凳-hello-world">ansible 打印 Hello  World</a></p>
<ul>
<li>命令的组成</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-0c5d42edf618e261.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>这句话会找到指定的主机（127.0.0.1）在主机上，使用command，执行<code>echo hello world</code></p>
<p>如果默认的hosts文件中，定义了主机组，也可以将ip换成主机组的名字<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> /etc/ansible/hosts 文件</span></div><div class="line">[local]</div><div class="line">127.0.0.1</div></pre></td></tr></table></figure></p>
<p>执行<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">aisible local -m command -a 'echo hello world'</div></pre></td></tr></table></figure></p>
<p>local会去hosts文件中找到对应的组，组下的每一台机器都会运行指令。</p>
<p>如果想让所以主机全部执行<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">aisible all -m command -a 'echo hello world'</div></pre></td></tr></table></figure></p>
<p>command模块意思是执行Linux主机的command，模块使用命令名称后跟一个列表空格分隔的参数。 给定的命令将全部执行选定的节点。 因为不会通过shell进行处理，所以“$ HOME”这样的变量，像“”&lt;“”，“”&gt;“”，“”|“`“;”“和”“＆”“将不起作用。</p>
<p>-那么 -m 指定模块，除了command，一定还有其他模块，那么在没有文档的情况下，</p>
<ul>
<li>怎么知道其他模块，和模块指令的用法呢？</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># 查询所有模块</div><div class="line">ansible-doc -l</div><div class="line"># 查看command模块</div><div class="line">ansible-doc command</div><div class="line"># 查看shell 模块</div><div class="line">ansible-doc shell</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-9e086e810fa2a6f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="模块列表"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-d1f4efdc142e5c95.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="模块具体介绍"></p>
<p>使用ansible-doc，可以帮助快速了解模块的作用和用法,ansible 还有其他参数，如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">用法：ansible-doc [options] [module ...]</div><div class="line"></div><div class="line">选项：</div><div class="line">   -a，--all显示所有模块的文档</div><div class="line">   -h，--help显示此帮助消息并退出</div><div class="line">   -l，--list列出可用的模块</div><div class="line">   -M MODULE_PATH，--module-path = MODULE_PATH</div><div class="line">                         指定模块库的路径（默认=无）</div><div class="line">   -s，--snippet显示指定模块的播放列表片段</div><div class="line">   -v，--verbose详细模式（-vvv为更多，-vvvv启用</div><div class="line">                         连接调试）</div><div class="line">   --version显示程序的版本号并退出</div></pre></td></tr></table></figure></p>
<p>接下来介绍几个常用的模块</p>
<h1 id="0x02-ansible常用模块介绍"><a href="#0x02-ansible常用模块介绍" class="headerlink" title="0x02 ansible常用模块介绍"></a>0x02 ansible常用模块介绍</h1><ul>
<li>command：这是个默认模块，不写-m xx模块的时候，默认会当成command模块，表示执行主机指令<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible local -a 'whoami'</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-e348ca07b9650bca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="默认为command模块"></p>
<ul>
<li>cron：定时任务模块，可以指定一个时间去执行某个任务</li>
</ul>
<p>有以下参数可供选择<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- name: Manage cron.d and crontab entries.</div><div class="line">  action: cron</div><div class="line">      backup                 # 如果设置，在修改之前会创建crontab的备份。 备份的位置由此模块在`backup_file'变量中返回。</div><div class="line">      cron_file              # 如果指定，则使用此文件而不是单个用户的crontab。 如果这是一个相对路径，它将被解释为/etc/cron.d。 （如果是绝对的，它通常是/ etc / crontab）。 要使用`cron_file'参数，你也必须指定'user'。</div><div class="line">      day                    # 每个月中的某天 ( 1-31, *, */2, etc )</div><div class="line">      disabled               # 当state = present的时候，可以在cron中禁用当前job。 </div><div class="line">      env                    # 管理crontab的环境变量，新变量会从crontab顶部添加</div><div class="line">      hour                   # 任务执行时间：时 ( 0-23, *, */2, etc )</div><div class="line">      insertafter            # 与'state = present'和'env'一起使用。 如果指定，新的环境变量将在声明指定的环境变量后插入。</div><div class="line">      insertbefore           # 与'state = present'和'env'一起使用。 如果指定，新的环境变量将在声明指定的环境变量前插入</div><div class="line">      job                    # 要执行的命令，或者如果设置了env，则为环境变量的值。 state =present则为必需声明job。</div><div class="line">      minute                 # 任务执行时间：分钟( 0-59, *, */2, etc )</div><div class="line">      month                  # 任务执行时间：月 ( 1-12, *, */2, etc )</div><div class="line">      name                   # crontab条目的描述，或者如果设置了env，则为环境变量的名称。 如果state=absent则必配置。 请注意，如果名称未设置且state=present，则将放弃已有条目，始终创建一个新的crontab条目。</div><div class="line">      reboot                 # 弃用了，使用special_time更好，表示重启后执行</div><div class="line">      special_time           # 特殊时间规格昵称。</div><div class="line">      state                  # 是否确保工作或环境变量存在或不存在。</div><div class="line">      user                   # crontab应该修改的具体用户。</div><div class="line">      weekday                # 任务执行时间：周几 ( 0-6 for Sunday-Saturday, *, etc )</div></pre></td></tr></table></figure></p>
<p>举个栗子：<br>每10分钟输出一次 hello<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible local -m cron -a 'minute="*/10" job="/bin/echo hello" name="test ansible-cron"'</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-7dfc809a5768a865.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="执行结果"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> 到主机中查看：</span></div><div class="line">crontab -l</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-71f4d73e1a56b717.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> 移除定时任务</span></div><div class="line">ansible local -m cron -a 'minute="*/10" job="/bin/echo hello" name="test ansible-cron" state=absent'</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-faf3abc3f8bbec9d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="移除定时任务"></p>
<p>cron 我是直接翻译了文档，之后可以使用<code>ansible-doc -s</code>命令自己查看.后面也不再详细翻译</p>
<ul>
<li>user 操作用户 </li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> 创建用户</span></div><div class="line">ansible local -m user -a 'name="zing1" password="自定义的密码" groups="root,system,sys" home="/home/zing1" '</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> 删除用户</span></div><div class="line">ansible local -m user -a 'name="zing1" state=absent fource=yes'</div></pre></td></tr></table></figure>
<ul>
<li><p>group 操作用户组</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> 创建组</span></div><div class="line">ansible local -m group -a 'name="mysql" gid=306 system=yes '</div><div class="line"><span class="meta">#</span><span class="bash"> 删除同user</span></div></pre></td></tr></table></figure>
</li>
<li><p>copy 复制文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> 将本机 源.txt 文件拷贝到远程主机上成为 目标.txt</span></div><div class="line">ansible webserverhost -m copy -a 'src="/home/zing/Documents/源.txt" dest="/home/xxserver/目标.txt" owner="root" mode=640'</div></pre></td></tr></table></figure>
</li>
</ul>
<p>src=本地目标（可以是文件夹）<br>dest=远程目标（可以是文件夹）<br>src可以用content替换<br>content：可以取代src，表示信息直接生成文件，与src不能同时使用。</p>
<ul>
<li><p>file 操作文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible local -m file -a 'ower="mysql" mode=644 src="/home/zing/Documents/from_mysql.link"  path="/home/mysql/xxx.link" state="link" '</div></pre></td></tr></table></figure>
</li>
<li><p>service 指定服务的运行状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ansible local -m service -a 'name="httpd" enabled=true state=started '</div><div class="line"><span class="meta">#</span><span class="bash"><span class="built_in">enable</span>表示是否开机启动</span></div><div class="line"><span class="meta">#</span><span class="bash">state 参数有started stopped restarted</span></div></pre></td></tr></table></figure>
</li>
<li><p>shell，指定执行shell命令，与command类似，在用到pipline，等复杂命令时，使用shell更加合适,这里不举例了</p>
</li>
<li><p>script 在远程主机上运行本机脚本，只支持用相对路径</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible serverhost -m script -a 'test.sh'</div></pre></td></tr></table></figure>
</li>
<li><p>setup 查看主机状态信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible all -m setup</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="0x03-yaml和playbook"><a href="#0x03-yaml和playbook" class="headerlink" title="0x03 yaml和playbook"></a>0x03 yaml和playbook</h1><p>是一个可读性高，用来表达数据序列的格式。YAML参考了其他多种语言，包括：C语言、Python、Perl，并从XML、电子邮件的数据格式（RFC 2822）中获得灵感。目前已经有数种编程语言或脚本语言支持（或者说解析）这种语言。</p>
<p>YAML的语法和其他高级语言类似，并且可以简单表达清单、散列表，标量等数据形态。[4]它使用空白符号缩进和大量依赖外观的特色，特别适合用来表达或编辑数据结构、各种配置文件、倾印除错内容、文件大纲（例如：许多电子邮件标题格式和YAML非常接近）。尽管它比较适合用来表达层次结构式（hierarchical model）的数据结构，不过也有精致的语法可以表示关系性（relational model）的数据。[5]由于YAML使用空白字符和分行来分隔数据，使得它特别适合用grep／Python／Perl／Ruby操作。其让人最容易上手的特色是巧妙避开各种封闭符号，如：引号、各种括号等，这些符号在嵌套结构时会变得复杂而难以辨认。</p>
<p>想细致学习YAML的可以去阮一峰大神的博客看看：<br><a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2016/07/yaml.html</a></p>
<p>那么Ansible中的Yaml文件是干啥的，其实就是指定，什么主机，执行什么任务的一个列表<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- hosts: local</div><div class="line">  remote_user: root</div><div class="line">  tasks:</div><div class="line">    - name: git clone</div><div class="line">      git: repo=git@github.com:yourproject.git</div><div class="line">           dest=/home/yourhome/git/</div><div class="line">           accept_hostkey=yes</div><div class="line">           force=yes</div><div class="line">           recursive=no</div><div class="line">           key_file=/home/user/.ssh/id_rsa.github-&#123;&#123; item.repo &#125;&#125;</div></pre></td></tr></table></figure></p>
<p>上面的一串yml配置就是让local主机以root身份去git上获取代码放到本地<br>很简单明了。</p>
<p>那么playbook怎么理解呢？<br>playbook本身是剧本的意思，ansible playbook中，包含了：</p>
<ul>
<li>Inventory 主机库文件</li>
<li>modules 调用模块</li>
<li>Ad Hoc Commands 指定主机运行的命令</li>
<li>Playbooks 剧本文件<ul>
<li>tasks 任务，调用模块执行某些命令</li>
<li>varable 变量</li>
<li>Template 模板</li>
<li>Handlers 处理器 由某些事件触发某些行为</li>
<li>Roles 角色</li>
</ul>
</li>
</ul>
<p>playbook的主要文件是用来指定tasks,下面举些例子<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> webservice 服务运行</span></div><div class="line">tasks:</div><div class="line">  - name: make server running</div><div class="line">    service: name="webservice" state="ruuning"</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> 执行某个命令</span></div><div class="line">tasks:</div><div class="line">  - name: kill services</div><div class="line">    shell: kill -9 &#123;&#123;service_PID&#125;&#125;</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> 执行某个命令</span></div><div class="line">tasks:</div><div class="line">  - name: kill services</div><div class="line">    shell: kill -9 &#123;&#123;service_PID&#125;&#125;</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> 忽略脚本返回值</span></div><div class="line">tasks:</div><div class="line">  - name: some shell running</div><div class="line">    shell: xxxxx.sh || /bin/true</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> 忽略错误信息</span></div><div class="line">tasks:</div><div class="line">  - name: ignore errors</div><div class="line">    shell: /tomcatpath/bin/startup.sh</div><div class="line">    ignore_errors: True</div></pre></td></tr></table></figure></p>
<p>执行playbook也很简单<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook xxxxx.yml</div></pre></td></tr></table></figure></p>
<p>指定hosts inventory文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook xxxxx.yml -i hostsInventory文件PATH</div></pre></td></tr></table></figure></p>
<h1 id="0x04-从git开始到项目发布并启动"><a href="#0x04-从git开始到项目发布并启动" class="headerlink" title="0x04 从git开始到项目发布并启动"></a>0x04 从git开始到项目发布并启动</h1><p>1.定义hosts inventory<br>test_evn_hosts文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[local]</div><div class="line">127.0.0.1 ansible_ssh_port=22222 ansible_user=zing</div><div class="line"></div><div class="line">[server]</div><div class="line">yourside.example.com  ansible_user=root</div><div class="line"></div><div class="line">[all:vars]</div><div class="line"><span class="meta">#</span><span class="bash">application.prpperties</span></div><div class="line">SPRING_DATASOURCE_URL="jdbc:mysql://127.0.0.1:3306/yordatabase"</div><div class="line">SPRING_DATASOURCE_USERNAME="yourname"</div><div class="line">SPRING_DATASOURCE_PASSWORD="your_password"</div><div class="line">SPRING_DATASOURCE_DRIVER_CLASS_NAME="org.mysql.Driver"</div></pre></td></tr></table></figure></p>
<p>2.编写playbook YAML 文件<br>side.yml文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- hosts: local</div><div class="line">  remote_user: zing</div><div class="line">  environment: </div><div class="line">    JAVA_HOME:  /application/jdk8/</div><div class="line">    JRE_HOME: /application/jdk8/jre/</div><div class="line">    M2_HOME: /application/maven/bin/</div><div class="line">  roles:</div><div class="line">    - local</div><div class="line"></div><div class="line">  </div><div class="line">- hosts: server</div><div class="line">  remote_user: root</div><div class="line">  roles:</div><div class="line">  - server</div></pre></td></tr></table></figure></p>
<p>3.编写配置文件<br>application.properties.j2 模板文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">spring.datasource.url = &#123;&#123;SPRING_DATASOURCE_URL&#125;&#125;</div><div class="line">spring.datasource.username = &#123;&#123;SPRING_DATASOURCE_USERNAME&#125;&#125;</div><div class="line">spring.datasource.password = &#123;&#123;SPRING_DATASOURCE_PASSWORD&#125;&#125;</div><div class="line">spring.datasource.driver-class-name = &#123;&#123;SPRING_DATASOURCE_DRIVER_CLASS_NAME&#125;&#125;</div></pre></td></tr></table></figure></p>
<p>4.编写脚本<br>git_clone.sh文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></div><div class="line">cd /home/zing/Documents/ansible/xxx/src</div><div class="line">rm -rf xxx</div><div class="line">git clone git@gitlabhost.com:xxx/xxx.git</div></pre></td></tr></table></figure></p>
<p>5.编写task yaml<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- name: git clone your xxx project</div><div class="line">  shell: /home/zing/Documents/ansible/xxx/roles/local/files/git_clone.sh</div><div class="line"></div><div class="line">- name: transfom template</div><div class="line">  template: src=&#123;&#123;item.file_src&#125;&#125; dest=&#123;&#123;item.target_file_path&#125;&#125;</div><div class="line">  with_items:</div><div class="line">    - &#123;file_src: '/home/zing/Documents/ansible/xxx/roles/local/template/application.j2', target_file_path: '/home/zing/Documents/ansible/xxx/src/xxx/src/main/resources/application.properties'&#125;</div><div class="line">    - &#123;file_src: '/home/zing/Documents/ansible/xxx/roles/local/template/config.j2', target_file_path: '/home/zing/Documents/ansible/xxx/src/xxx/src/main/resources/config.properties'&#125;</div></pre></td></tr></table></figure></p>
<p>6.playbook 执行<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook side.yml -i test_evn_hosts文件路径</div></pre></td></tr></table></figure></p>
<p>整体结构</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-acaa83da1e5a0e4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ansible项目结构文件"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://ansible-tran.readthedocs.io/en/latest/docs/intro_inventory.html#inventoryformat" target="_blank" rel="external">http://ansible-tran.readthedocs.io/en/latest/docs/intro_inventory.html#inventoryformat</a></p>
<hr>
<p>转载请注明来自MaxZing : <a href="https://micorochio.github.io/2017/06/05/ansible-learning-02/">https://micorochio.github.io/2017/06/05/ansible-learning-02/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-1a9c0f3807270562.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ansible的特性：&lt;ul&gt;
&lt;li&gt;ansible基于Python实现，有Paramiko、PyYAML、JinJia2主要模块&lt;/li&gt;
&lt;li&gt;使用SSH链接主机，部署简单&lt;/li&gt;
&lt;li&gt;可以使用自定义模块，也可以使用其他语言编写的模块，基于模块可以完成各种任务。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="http://micorochio.github.io/tags/Linux/"/>
    
      <category term="ansible" scheme="http://micorochio.github.io/tags/ansible/"/>
    
      <category term="运维" scheme="http://micorochio.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
      <category term="自动化持续部署" scheme="http://micorochio.github.io/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/"/>
    
  </entry>
  
  <entry>
    <title>自动化部署工具 Ansible填坑记录</title>
    <link href="http://micorochio.github.io/2017/05/31/ansible-learning-01/"/>
    <id>http://micorochio.github.io/2017/05/31/ansible-learning-01/</id>
    <published>2017-05-30T17:48:58.000Z</published>
    <updated>2017-06-04T02:55:27.000Z</updated>
    
    <content type="html"><![CDATA[<p>因为公司想对项目逐步转向为自动化部署，所以安排我和一位大佬做起了运维。目前是想先用ansible实现从git上获取code，在ansible主机上编译，配置，打包，发布。所以就有了这篇文章。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-fea8ebad97cb96d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><a id="more"></a></p>
<h1 id="0x00-安装"><a href="#0x00-安装" class="headerlink" title="0x00 安装"></a>0x00 安装</h1><p>Ubuntu 16.04<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install software-properties-common</div><div class="line">sudo apt-add-repository ppa:ansible/ansible</div><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install ansible</div></pre></td></tr></table></figure></p>
<p>Pip安装<br>pip是Python的包管理工具，先装好pip，再安装ansible。目前建议Python版本：2.7，pip版本：9<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo pip install ansible</div></pre></td></tr></table></figure></p>
<p>源码编译安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> git://github.com/ansible/ansible.git --recursive</div><div class="line"><span class="built_in">cd</span> ./ansible</div><div class="line">sudo make install</div></pre></td></tr></table></figure></p>
<p>CentOS安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install ansible</div></pre></td></tr></table></figure></p>
<blockquote>
<ul>
<li>强烈建议使用CentOS安装。且安装ansible用户最好能保证拥有其他需要使用软件的权限，如Maven，Java，Python，Mysql等<br>否则ansible使用到这些软件时，容易出现权限不足，或者找不到环境变量等问题</li>
<li>Windows server 和OS X最好放在虚拟机里学习ansible，因为这是运维专用的，最好运行在Linux系统上，有实战意义。</li>
</ul>
</blockquote>
<p>检测安装成功:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible --version</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-deb275ca4824f5ab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h1 id="0x01-配置"><a href="#0x01-配置" class="headerlink" title="0x01 配置"></a>0x01 配置</h1><p>安装之后是需要做一些配置，如果你是从源码<code>make install</code>安装的，可能没有配置文件。可以直接从example文件夹中，复制一份到<code>/etc/ansible/</code>下就可以了。</p>
<p>如果没有这个文件夹，创建一下就行，保证ansible的操作用户有这个文件夹的操作权限。</p>
<p>如果是其他方式安装的，执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible --version</div></pre></td></tr></table></figure></p>
<p>可以看到配置文件的位置，找不到就去github上看看，example文件夹里有<br>这两个文件，很重要！</p>
<ul>
<li>ansible.cfg：是ansible 全局的配置</li>
<li>hosts：是ansible管理的主机列表，和部分参数。</li>
</ul>
<p>anbile配置文件是有优先级的<br>下面是ansible1.5只后版本查找ansible.cfg的优先级。</p>
<ol>
<li>ANSIBLE_CONFIG (an environment variable)</li>
<li>ansible.cfg (in the current directory)</li>
<li>.ansible.cfg (in the home directory)</li>
<li>/etc/ansible/ansible.cfg</li>
</ol>
<p>下面是配置参数大全，参考用。<br>刚开始使用的时候，主要配置hosts文件位置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (扩展插件存放目录)</span></div><div class="line">action_plugins = /usr/share/ansible_plugins/action_plugins </div><div class="line"><span class="comment"># (插入Ansible模板的字符串)</span></div><div class="line">ansible_managed = Ansible managed: &#123;file&#125; modified on %Y-%m-%d %H:%M:%S by &#123;uid&#125; on &#123;host&#125;</div><div class="line"><span class="comment"># （PlayBook是否需要提供密码，默认为No）</span></div><div class="line"><span class="comment"># ask_pass=True</span></div><div class="line"><span class="comment"># （PlayBook是否需要提供sudo 密码）[](http://www.ansible.cn/docs/intro_configuration.html#ask-sudo-pass)</span></div><div class="line"><span class="comment"># ask_sudo_pass=True</span></div><div class="line"><span class="comment"># （回调函数插件存放路径）</span></div><div class="line">action_plugins = /usr/share/ansible_plugins/action_plugins</div><div class="line"><span class="comment"># （连接插件存放路径）</span></div><div class="line">action_plugins = /usr/share/ansible_plugins/action_plugins</div><div class="line"><span class="comment"># （是否展示警告信息）</span></div><div class="line">deprecation_warnings = True</div><div class="line"><span class="comment"># （是否展示跳过的主机的信息）</span></div><div class="line"><span class="comment"># display_skipped_hosts=True</span></div><div class="line"><span class="comment"># （执行错误时候赋予的变量）</span></div><div class="line"><span class="comment"># error_on_undefined_vars=True</span></div><div class="line"><span class="comment"># （默认的Shell）</span></div><div class="line"><span class="comment"># executable = /bin/bash</span></div><div class="line"><span class="comment"># （拦截器插件）</span></div><div class="line">action_plugins = /usr/share/ansible_plugins/action_plugins</div><div class="line"><span class="comment"># （最大进程数）</span></div><div class="line">forks=5</div><div class="line"><span class="comment"># （哈希特性，没事不用去动它）</span></div><div class="line"><span class="comment"># hash_behavior=replace</span></div><div class="line"><span class="comment"># （资产文件存放位置）</span></div><div class="line">hostfile = /etc/ansible/hosts</div><div class="line"><span class="comment"># （是否检查SSH key）</span></div><div class="line">host_key_checking=True</div><div class="line"><span class="comment"># （JinJa扩展）</span></div><div class="line">jinja2_extensions = jinja2.ext.do,jinja2.ext.i18n</div><div class="line"><span class="comment"># （PlayBook变量）</span></div><div class="line">legacy_playbook_variables = no</div><div class="line"><span class="comment"># （Ansible默认库）</span></div><div class="line">library = /usr/share/ansible</div><div class="line"><span class="comment"># （日志路径）</span></div><div class="line">log_path=/var/<span class="built_in">log</span>/ansible.log</div><div class="line"><span class="comment"># （插件路径）</span></div><div class="line">action_plugins = /usr/share/ansible_plugins/action_plugins</div><div class="line"><span class="comment"># （默认模块名称）</span></div><div class="line">module_name = <span class="built_in">command</span></div><div class="line"><span class="comment"># (输出样式)</span></div><div class="line">nocolor=0</div><div class="line"><span class="comment"># (是否使用cowsay打印)</span></div><div class="line">nocows=0</div><div class="line"><span class="comment"># （主机）</span></div><div class="line">hosts=*</div><div class="line"><span class="comment"># （pool间隔）</span></div><div class="line">poll_interval=15</div><div class="line"><span class="comment"># （私钥的存放路径）</span></div><div class="line">private_key_file=/path/to/file.pem</div><div class="line"><span class="comment"># （远程连接端口号）</span></div><div class="line">remote_port = 22</div><div class="line"><span class="comment"># (远程目录临时文件夹)</span></div><div class="line">remote_temp = <span class="variable">$HOME</span>/.ansible/tmp</div><div class="line"><span class="comment"># （远程用户）</span></div><div class="line">remote_user = root</div><div class="line"><span class="comment"># （角色路径）</span></div><div class="line">roles_path = /opt/mysite/roles</div><div class="line"><span class="comment"># （SUDO执行）</span></div><div class="line">sudo_exe=sudo</div><div class="line"><span class="comment"># （SUDO标记）</span></div><div class="line">sudo_flags=-H</div><div class="line"><span class="comment"># （sudo用户）</span></div><div class="line">sudo_user=root</div><div class="line"><span class="comment"># （重连次数）</span></div><div class="line">timeout = 10</div><div class="line"><span class="comment"># （传输模式） 默认用的smart</span></div><div class="line">transport</div><div class="line"><span class="comment"># （变量插件存放路径）</span></div><div class="line">action_plugins = /usr/share/ansible_plugins/action_plugins</div><div class="line"><span class="comment"># SSH变量</span></div><div class="line"><span class="comment"># (SSH连接参数)</span></div><div class="line">ssh_args = -o ControlMaster=auto -o ControlPersist=60s</div><div class="line"><span class="comment"># （采用SCP还是SFTP进行文件传输）</span></div><div class="line">scp_if_ssh=False</div></pre></td></tr></table></figure></p>
<h1 id="0x02-host文件"><a href="#0x02-host文件" class="headerlink" title="0x02 host文件"></a>0x02 host文件</h1><p>hosts文件是ansible管理主机的Inventory文件，里面存放的是主机组和部分参数<br>例如<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[<span class="built_in">local</span>]</div><div class="line">127.0.0.2 ansible_ssh_port=22 ansible_user=zing ansible_ssh_pass=别傻了，我不会写的</div><div class="line"></div><div class="line">[webserver]</div><div class="line">xxx1.example.com ansible_ssh_port=33 ansible_user=root</div><div class="line">xxx2.example.com</div></pre></td></tr></table></figure></p>
<p>port：ssh到目标主机的端口<br>user：目标主机将会以这个身份登录<br>pass：目标主机该用户的密码</p>
<p>中括号内是主机的分组名</p>
<ul>
<li>下面的是主机地址，可以是ip，可以是域名。ip（域名）之后跟的是链接参数。</li>
<li>如果啥都不写，安装咱们之前写的ansible.cfg中定义的默认配置来进行ssh链接</li>
<li>其中如果两台主机进行了ssh 互信。那么ansible_ssh_pass参数可以不写。<br><a href="http://ansible-tran.readthedocs.io/en/latest/docs/intro_inventory.html" target="_blank" rel="external">http://ansible-tran.readthedocs.io/en/latest/docs/intro_inventory.html</a><br>在上面有详细讲解hosts文件定义的规范和技巧。</li>
</ul>
<p>遇到几个坑：</p>
<p>错误：用户没有ssh的权限。首先保证user能被ssh连上。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Failed to connect to the host via ssh: Permission denied</div></pre></td></tr></table></figure></p>
<p>错误：密码不对<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Authentication failure.</div></pre></td></tr></table></figure></p>
<p>错误：主机没有sshpass模块，这个想办法自己装上。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">to use the <span class="string">'ssh'</span> connection <span class="built_in">type</span> with passwords, you must install the sshpass program</div></pre></td></tr></table></figure></p>
<h1 id="0x03-爱因斯坦的小板凳-hello-world"><a href="#0x03-爱因斯坦的小板凳-hello-world" class="headerlink" title="0x03 爱因斯坦的小板凳 hello world"></a>0x03 爱因斯坦的小板凳 hello world</h1><p>接下来介绍使用ansible在目标主机上打印出：hello world<br>先不管命令的含义<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible 127.0.0.1 -m <span class="built_in">command</span> -a <span class="string">'echo "hello world"'</span></div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-168b6a19d6b502f8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="成功！"></p>
<h1 id="0x04-参考"><a href="#0x04-参考" class="headerlink" title="0x04 参考"></a>0x04 参考</h1><ul>
<li><a href="http://ansible-tran.readthedocs.io/en/latest/index.html" target="_blank" rel="external">http://ansible-tran.readthedocs.io/en/latest/index.html</a></li>
<li><a href="http://docs.ansible.com/ansible/" target="_blank" rel="external">http://docs.ansible.com/ansible/</a></li>
<li><a href="http://docs.ansible.com/ansible/intro_configuration.html" target="_blank" rel="external">http://docs.ansible.com/ansible/intro_configuration.html</a></li>
<li>已失效：<a href="http://www.kiratechblog.com/?p=420" target="_blank" rel="external">http://www.kiratechblog.com/?p=420</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;因为公司想对项目逐步转向为自动化部署，所以安排我和一位大佬做起了运维。目前是想先用ansible实现从git上获取code，在ansible主机上编译，配置，打包，发布。所以就有了这篇文章。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-fea8ebad97cb96d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="http://micorochio.github.io/tags/Linux/"/>
    
      <category term="ansible" scheme="http://micorochio.github.io/tags/ansible/"/>
    
      <category term="运维" scheme="http://micorochio.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
      <category term="自动化持续部署" scheme="http://micorochio.github.io/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/"/>
    
  </entry>
  
  <entry>
    <title>初探Gradle</title>
    <link href="http://micorochio.github.io/2017/05/08/gradle-learning-01/"/>
    <id>http://micorochio.github.io/2017/05/08/gradle-learning-01/</id>
    <published>2017-05-07T23:06:43.000Z</published>
    <updated>2017-05-07T15:33:21.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-所谓构建工具"><a href="#0x00-所谓构建工具" class="headerlink" title="0x00 所谓构建工具"></a>0x00 所谓构建工具</h2><p>多人合作时，代码需要按照规范统一管理，但是早期一个项目很难做到一处编写到处运行。一方面，开发者自己的编写环境不能绝对统一，另一方面，没有一个方案去解决自动构建项目的问题，而手动机械重复构建往往出现各种问题。</p>
<p>后来，Java构建项目工具诞生了Ant，第一代自动化构建工具。通过XML，约束构建流程，达到自动构建的目的。<br>Ant构建脚本由 一个project ，多个target，以及可用的task构成。<br>有兴趣的童鞋可用查一下，Ant构建的XML文件的大致写法，这里不作详解。只介绍缺点<br>ㄟ( ▔, ▔ )ㄏ<br>Ant虽然实现了自动构建，但是在大型项目中，XML构建脚本异常臃肿庞大；构建脚本逻辑也会越来越复杂，最后难以维护。<br>而且Ant没有规范项目结构，可能导致每次编译出来的东西都不太一样，特别当依赖被改来改去，易出现重复拷贝。因为Ant自身本来就没有提供依赖管理工具，只能借助Ivy。<br>构建时也无法监控内存变化，task执行。<br><a id="more"></a></p>
<p>然后又出现了Maven，现在Maven依然被广泛利用。<br>Maven本身规范了项目结构，并提供了依赖管理。主要功能如下：</p>
<ul>
<li>代码编译</li>
<li>测试（单元，集成）</li>
<li>装配（如，jar文件依赖）</li>
<li>部署（将项目部署到本地仓库）</li>
<li>发布（将项目发布到远程仓库）</li>
</ul>
<p>上面都是看来的，因为Maven解决了Ant的痛点，很快流行起来，其中仓库的概念，更是好用，解决了依赖问题。而且Maven可以添加各种插件，相对来说，比Ant更易用，更稳定。</p>
<p>但是：Maven规范很严格，可能导致你搬运来的非Maven项目，需要大改才能运行。扩展也非常难搞，需要了解Major，早期版本还会自己更新，这对有墙的我们来说很痛苦。</p>
<p>所以今天我要介绍Gradle，一个灵活的构建工具。</p>
<h2 id="0x01-Gradle，一个更好的构建工具！"><a href="#0x01-Gradle，一个更好的构建工具！" class="headerlink" title="0x01 Gradle，一个更好的构建工具！"></a>0x01 Gradle，一个更好的构建工具！</h2><p>一开始接触gradle会觉得，这玩意儿写的东西很简洁，logo也比Maven好看。<br>但是估计也不知道这东西咋玩。所以这个东西究竟好在哪里？</p>
<ol>
<li>基于JVM，Gradle是基于JVM的构建工具（Java跨平台，你值得拥有😁）。</li>
<li>由Groovy的领域语言DSL来表达构建脚本（所以简洁，强大）。</li>
<li>项目迁移到gradle不需要特大改动，而且极易扩展</li>
<li>用的人越来越多了</li>
<li>大型项目持续交付，</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-be2d8b2a656cb75c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>唉，看的书作者懒得翻译，我给你们看<a href="https://zh.wikipedia.org/wiki/%E5%81%A5%E5%A3%AE%E6%80%A7_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6" target="_blank" rel="external">wikipedia的解释</a>)</p>
<blockquote>
<p>鲁棒 ：<strong>健壮性</strong>（英语：<strong>Robustness</strong>）是指一个计算机系统在执行过程中处理错误，以及算法在遭遇输入、运算等异常时继续正常运行的能力。 诸如<a href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95" target="_blank" rel="external">模糊测试</a>之类的<a href="https://zh.wikipedia.org/wiki/%E5%BD%A2%E5%BC%8F%E5%8C%96%E6%96%B9%E6%B3%95" target="_blank" rel="external">形式化方法</a>中，必须通过制造错误的或不可预期的输入来验证程序的健壮性。很多商业产品都可用来测试软件系统的健壮性。健壮性也是<a href="https://zh.wikipedia.org/wiki/%E5%A4%B1%E6%95%88%E8%AF%84%E5%AE%9A" target="_blank" rel="external">失效评定</a>分析中的一个方面。</p>
</blockquote>
<h2 id="0x02-Gradle之世界你好"><a href="#0x02-Gradle之世界你好" class="headerlink" title="0x02 Gradle之世界你好"></a>0x02 Gradle之世界你好</h2><p>废话一大堆，现在写一个Gradle版的Hello World</p>
<ul>
<li>准备</li>
</ul>
<ol>
<li>安装JDK，配置JAVA_HOME<br>Windows：<a href="http://jingyan.baidu.com/article/6dad5075d1dc40a123e36ea3.html" target="_blank" rel="external">http://jingyan.baidu.com/article/6dad5075d1dc40a123e36ea3.html</a><br>Lunix：<a href="http://jingyan.baidu.com/article/ab0b56308966acc15afa7d18.html" target="_blank" rel="external">http://jingyan.baidu.com/article/ab0b56308966acc15afa7d18.html</a><br>Mac：自行搜索吧</li>
<li>安装Gradle，配置GRADLE_HOME<br>官方安装文档：<a href="https://gradle.org/install" target="_blank" rel="external">https://gradle.org/install</a><br>如果你英文烂，请使用百度，我只说一下Lunix<br><a href="https://gradle.org/releases" target="_blank" rel="external">https://gradle.org/releases</a>   找一个最新的稳定版本，不看源码你只需要binary-only 版本的,我以3.5 为例子。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span></div><div class="line">sudo mkdir gradle</div><div class="line"><span class="built_in">cd</span> gradle</div><div class="line">sudo wget https://services.gradle.org/distributions/gradle-3.5-bin.zip</div><div class="line">sudo unzip gradle-3.5-bin.zip</div></pre></td></tr></table></figure>
<p>配置环境变量<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim ~/.profile</div></pre></td></tr></table></figure></p>
<p>在最后添加下面<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> GRADLE_HOME=/usr/<span class="built_in">local</span>/gradle/gradle-3.5</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$GRADLE_HOME</span>/bin:<span class="variable">$PATH</span></div></pre></td></tr></table></figure></p>
<p>按下<code>esc</code> 然后<code>:wq!</code>保存<br>然后使环境变量生效<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">source</span> ~/.profile</div></pre></td></tr></table></figure></p>
<p>好了，安装完成。</p>
<blockquote>
<p><strong>请务必自己处理好路径</strong></p>
</blockquote>
<p>测试，打开命令行。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-9dd7019706ee29d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="输入  gradle -v "></p>
<p>接下来创造爱因斯坦小板凳</p>
<p>随便找一个文件夹，创建一个build.gradle文件，里面写如下代码<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">task helloworld&#123;</div><div class="line">  doLast&#123;</div><div class="line">    println 'Hello World!'</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后，在这个文件夹下运行命令行<br>输入<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gradle -q helloworld</div></pre></td></tr></table></figure></p>
<p>看效果</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-e933d43e41ec3b2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="我是在graldeTest文件夹下运行的"></p>
<p>这里只是运行了一个task，task和action是gradle重要的概念，当然我也是开始学习。后面会把这些概念挨个介绍给各位老爷。</p>
<p>这里介绍一下 gralde -q这个命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-q, --quiet             Log errors only.</div></pre></td></tr></table></figure></p>
<p>安静模式运行，只打印错误日志。<br>当然<br>还有其他的命令，我找几个常用的介绍一下。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-b xxx.gradle  <span class="comment">#运行一个叫xxx的构建脚本</span></div><div class="line">--offline <span class="comment">#离线运行（保证本地有离线仓库）</span></div><div class="line">-P --project-prop <span class="comment">#向构建脚本中传参</span></div><div class="line">-i --info <span class="comment">#设置编译日志输出级别</span></div><div class="line">-s --stacktrace <span class="comment">#构建出错输出跟踪栈信息</span></div><div class="line">tasks <span class="comment">#显示所有可运行的task</span></div><div class="line">properties <span class="comment">#显示项目中可用的属性</span></div></pre></td></tr></table></figure></p>
<h2 id="0x03-小结"><a href="#0x03-小结" class="headerlink" title="0x03 小结"></a>0x03 小结</h2><p>废话了一大堆，后面写了个helloWorld，想必目前各位看官老爷还是不太明白gradle究竟如何使用。不急，后面我会一一把坑填好的：我会介绍创建Gradle项目，构建脚本，依赖管理等，不过写的会稍微慢一点。<br>ps:因为脑残升级了node，导致Hexo博客炸了，昨天抢救了一整天。发了一篇小白文。<br>因为要熟悉项目，还有那个FS计划依然在进行，不过会慢一些了，过些日子还有一堆其他事情要处理，希望我能够保持学习的节奏吧。</p>
<p>欢迎转载，请保留出处：<a href="https://micorochio.github.io/2017/05/08/gradle-learning-01/">初探Gradle by:MaxZing</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-所谓构建工具&quot;&gt;&lt;a href=&quot;#0x00-所谓构建工具&quot; class=&quot;headerlink&quot; title=&quot;0x00 所谓构建工具&quot;&gt;&lt;/a&gt;0x00 所谓构建工具&lt;/h2&gt;&lt;p&gt;多人合作时，代码需要按照规范统一管理，但是早期一个项目很难做到一处编写到处运行。一方面，开发者自己的编写环境不能绝对统一，另一方面，没有一个方案去解决自动构建项目的问题，而手动机械重复构建往往出现各种问题。&lt;/p&gt;
&lt;p&gt;后来，Java构建项目工具诞生了Ant，第一代自动化构建工具。通过XML，约束构建流程，达到自动构建的目的。&lt;br&gt;Ant构建脚本由 一个project ，多个target，以及可用的task构成。&lt;br&gt;有兴趣的童鞋可用查一下，Ant构建的XML文件的大致写法，这里不作详解。只介绍缺点&lt;br&gt;ㄟ( ▔, ▔ )ㄏ&lt;br&gt;Ant虽然实现了自动构建，但是在大型项目中，XML构建脚本异常臃肿庞大；构建脚本逻辑也会越来越复杂，最后难以维护。&lt;br&gt;而且Ant没有规范项目结构，可能导致每次编译出来的东西都不太一样，特别当依赖被改来改去，易出现重复拷贝。因为Ant自身本来就没有提供依赖管理工具，只能借助Ivy。&lt;br&gt;构建时也无法监控内存变化，task执行。&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="Gradle" scheme="http://micorochio.github.io/tags/Gradle/"/>
    
  </entry>
  
  <entry>
    <title>使用Ubuntu快速搭建Java Web开发环境</title>
    <link href="http://micorochio.github.io/2017/05/07/make-ubuntu-to-be-your-dev-system/"/>
    <id>http://micorochio.github.io/2017/05/07/make-ubuntu-to-be-your-dev-system/</id>
    <published>2017-05-06T21:06:11.000Z</published>
    <updated>2017-05-06T13:16:28.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-从Windows安装"><a href="#0x00-从Windows安装" class="headerlink" title="0x00 从Windows安装"></a>0x00 从Windows安装</h2><p>我是Mac用户，新公司用PC，为了适应，决定用Linux做主力开发系统，首先需要安装系统</p>
<p>有两种方式：</p>
<blockquote>
<ol>
<li>使用EasyBCD 添加引导</li>
<li>使用UltraISO制作安装U盘</li>
</ol>
</blockquote>
<p>EasyBCD安装的坑：</p>
<ol>
<li>需要自己写ISO引导位置<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">title Install Ubuntu 16.04</div><div class="line">root (hd0,1)</div><div class="line">kernel (hd0,1)/vmlinuz.efi boot=casper iso-scan/filename=/ubuntu-16.04-desktop-amd64.iso ro quiet </div><div class="line">splash locale=zh_CN.UTF-8</div><div class="line">initrd (hd0,1)/initrd.lz</div></pre></td></tr></table></figure>
</li>
</ol>
<p>hd(0,1)表示第一个物理分区的第二个盘，当然不一定是C盘。所以ISO文件的位置一定会坑到一堆人。<br>其实可以安装时更改hd位置，参考：<a href="http://www.jianshu.com/p/9b4e4137bc11" target="_blank" rel="external">http://www.jianshu.com/p/9b4e4137bc11</a></p>
<ol>
<li>要将ISO文件解压，将其中 .disk 文件夹，initrd.lz，vmlinuz.efi 文件放到C盘中，不能少。</li>
</ol>
<p>UltraISO安装的坑<br>UltraISO版本一定要新版的，我用的是UltraISO 9，不然U盘启动会报错，老毛桃的刻录工具版本太低。建议自己下载一个。<br><a id="more"></a></p>
<h2 id="0x01安装配置"><a href="#0x01安装配置" class="headerlink" title="0x01安装配置"></a>0x01安装配置</h2><p>Ubuntu 安装过程中一般情况不用特殊配置，不过我建议修改一下分区，因为是图形化界面，使用<code>/home</code>目录较多，建议使用分区大一些。<br>大致如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">分区：swap    格式：swap    大小：与内存一样大小</div><div class="line">分区：/boot   格式：xfs     大小：500M   （启动区以前大约40M，且不能随便更改）</div><div class="line">分区：/       格式：xfs     大小：剩下空间的一半</div><div class="line">分区：/home   格式：xfs     大小：剩下的空间（如果没有特殊要求）</div></pre></td></tr></table></figure></p>
<p>其实这只是我单方面建议，因为home太小，系统被我玩的卡的不行，尤其VBOX装虚拟机 大约35G，瞬间占满home</p>
<p>所以，要装虚拟机，建议home分大一些。，其实这些也不是绝对<br>在CentOS中，只有<code>/boot</code>和<code>/</code>两个物理分区。至于分区做什么用的，可以参考Linux 资料</p>
<p>如果不会分区，大佬的建议是，除了<code>swap</code>和<code>/boot</code> 其余空间全部分给<code>/</code></p>
<h2 id="0x02-环境变量的配置"><a href="#0x02-环境变量的配置" class="headerlink" title="0x02 环境变量的配置"></a>0x02 环境变量的配置</h2><p>这个很重要，也很简单，只要记住三点</p>
<ol>
<li>vim ~/.profile</li>
<li>写准软件bin文件夹的位置，（不一定是bin文件夹，只要是存放可执行文件的文件夹都可以）</li>
<li>保存好文件，然后一点要运行<code>source ~/.profile</code>才能生效</li>
</ol>
<p>这里以Maven，和JDK举例<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim ~/.profile</div></pre></td></tr></table></figure></p>
<p>将jdk文件的位置和maven的位置准确的写进去<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#JAVA_HOME</span></div><div class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jdk/jdk1.8</div><div class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$CLASSPATH</span>  </div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span> </div><div class="line"></div><div class="line"><span class="comment">#MAVEN_HOME</span></div><div class="line"><span class="built_in">export</span> MAVEN_HOME=/usr/<span class="built_in">local</span>/maven/apache-maven-3.3.9</div><div class="line"><span class="built_in">export</span> MAVEN_OPTS=<span class="string">"-Xms256m -Xmx512m"</span></div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;MAVEN_HOME&#125;</span>/bin:<span class="variable">$PATH</span></div></pre></td></tr></table></figure></p>
<p>写完 按<code>esc</code> 输入<code>:wq</code>保存退出<br>执行source命令，使环境变量生效<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">source</span> ~/.profile</div></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>记住路径一定要写对，不然环境变量配了也白配。</strong></p>
</blockquote>
<h2 id="0x03-IDE和其他软件的安装"><a href="#0x03-IDE和其他软件的安装" class="headerlink" title="0x03 IDE和其他软件的安装"></a>0x03 IDE和其他软件的安装</h2><p>JDK安装我就不提了，教程特别多，只要解压后配置好环境变量就能使用了。</p>
<p>1.eclipse<br>即下即用，想方便可以再运行后，将应用绑定到dock上</p>
<p>2.IDEA<br>也是即下即用，不过可以将IDEA 文件夹下bin目录中 idea.sh 使用ln -s 命令链接到桌面上，或者配置IDEA_HOME。这样找运行文件会快一些。</p>
<p>3.Node<br>这个可以用apt-get命令安装，这样会方便很多，编译安装需要安装gcc编译器，另外<br>然后执行configure<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># prefix 参数是配置软件安装的位置</span></div><div class="line">./configure  --prefix=/usr/<span class="built_in">local</span>/node</div><div class="line">make</div><div class="line">sudo make install</div></pre></td></tr></table></figure></p>
<p>4.Python<br>建议apt-get安装</p>
<p>5.Git<br>一样建议apt-get安装</p>
<p>6.Nginx<br>建议编译安装，步骤自己查，我只提醒一下，记住先安装依赖，zlib，pcre，openssl。</p>
<p>7.虚拟机安装<br>因为Wine 特别难用，所以需要安装个虚拟机，跑个QQ和微信什么的，这里推荐使用VisualBox，开源免费。<br>Ubuntu 16.04 apt源中有，如果想尝试deb安装的话，可以先apt-get 安装deb工具<br>安装完成后，可以使用 win+tab 搜索 virtual box，就能找到。<br>我用deb安装一直失败，使用后来换apt-get安装了。</p>
<p>8.搭建梯子<br>这个有太多教程，我建议看看秋水逸冰的博客：<br><a href="https://shadowsocks.be/9.html" target="_blank" rel="external">https://shadowsocks.be/9.html</a><br>如果用docker搭建梯子，可以看看mritd现有的docker镜像<br><a href="https://hub.docker.com/r/mritd/shadowsocks/" target="_blank" rel="external">https://hub.docker.com/r/mritd/shadowsocks/</a></p>
<h2 id="0x04-OpenVPN的使用"><a href="#0x04-OpenVPN的使用" class="headerlink" title="0x04 OpenVPN的使用"></a>0x04 OpenVPN的使用</h2><p>也许公司代码在内网中，<br><a href="http://blog.csdn.net/w746805370/article/details/51774609" target="_blank" rel="external">http://blog.csdn.net/w746805370/article/details/51774609</a><br>知乎大神的原文被知乎河蟹了，这里包括如何搭建Server 和运行Client，自行取用。</p>
<p>这里只写一个Client链接VPN命令。<br>找服务端拿到client.ovpn 文件，注意位置，可能跟我的不一样。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openvpn /etc/openvpn/client.ovpn</div></pre></td></tr></table></figure></p>
<p>如果你不想一直开着命令窗口，可以用下面的命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nohub openvpn /etc/openvpn/client.ovpn &amp;</div></pre></td></tr></table></figure></p>
<h2 id="最后补充"><a href="#最后补充" class="headerlink" title="最后补充"></a>最后补充</h2><p>MySQL安装我没写，建议用docker 跑MySQL，我也才开始看docker，现在只会跑个mysql，还是没问题的。国外镜像需要良好的梯子。</p>
<p>UI美化我也没写，你可以自己搜索unity-tweak-tool ，然后自行玩耍。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-0579862bb72c3641.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="奏是姐样的"></p>
<hr>
<p>其他的坑，以后遇到就给补上。<br>爱转不转吧<br>作者<a href="https://micorochio.github.io/2017/05/07/make-ubuntu-to-be-your-dev-system/">zing</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-从Windows安装&quot;&gt;&lt;a href=&quot;#0x00-从Windows安装&quot; class=&quot;headerlink&quot; title=&quot;0x00 从Windows安装&quot;&gt;&lt;/a&gt;0x00 从Windows安装&lt;/h2&gt;&lt;p&gt;我是Mac用户，新公司用PC，为了适应，决定用Linux做主力开发系统，首先需要安装系统&lt;/p&gt;
&lt;p&gt;有两种方式：&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;使用EasyBCD 添加引导&lt;/li&gt;
&lt;li&gt;使用UltraISO制作安装U盘&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;EasyBCD安装的坑：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;需要自己写ISO引导位置&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;title Install Ubuntu 16.04&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root (hd0,1)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;kernel (hd0,1)/vmlinuz.efi boot=casper iso-scan/filename=/ubuntu-16.04-desktop-amd64.iso ro quiet &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;splash locale=zh_CN.UTF-8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;initrd (hd0,1)/initrd.lz&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;hd(0,1)表示第一个物理分区的第二个盘，当然不一定是C盘。所以ISO文件的位置一定会坑到一堆人。&lt;br&gt;其实可以安装时更改hd位置，参考：&lt;a href=&quot;http://www.jianshu.com/p/9b4e4137bc11&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/9b4e4137bc11&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;要将ISO文件解压，将其中 .disk 文件夹，initrd.lz，vmlinuz.efi 文件放到C盘中，不能少。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;UltraISO安装的坑&lt;br&gt;UltraISO版本一定要新版的，我用的是UltraISO 9，不然U盘启动会报错，老毛桃的刻录工具版本太低。建议自己下载一个。&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="Linux" scheme="http://micorochio.github.io/tags/Linux/"/>
    
      <category term="Ubuntu" scheme="http://micorochio.github.io/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>一次艰难的拒绝</title>
    <link href="http://micorochio.github.io/2017/04/29/2017-04-28%EF%A3%BF23:53:23/"/>
    <id>http://micorochio.github.io/2017/04/29/2017-04-2823:53:23/</id>
    <published>2017-04-28T23:54:18.000Z</published>
    <updated>2017-04-28T15:55:57.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="对不起，可是我还是要拒绝"><a href="#对不起，可是我还是要拒绝" class="headerlink" title="对不起，可是我还是要拒绝"></a>对不起，可是我还是要拒绝</h1><p>这段时间一直在面试，没有什么精力写文章，整个人处于一种k于是我把快窒息的状态，所以我把简历发给了一家外包公司。</p>
<p>公司非常热心，帮我推荐了很多家岗位。直到这天，我接到一个电话，彻底让我失望了。于是晚上我就打电话给外包的经理，拒绝了两家的甲方的offer。</p>
<p>这个电话是其实是一家甲方公司打给我的，告诉我公司因为我面试通过了甲方的面试，向甲方提出涨价的要求，而我被我的公司隐瞒了拿到offer的事情，直到甲方给我私人打电话，整个流程内部操作十分不规范。<br><a id="more"></a><br>我询问了甲方开的工资，瞬间对这家外包公司彻底失去了好感。</p>
<p>首先我感谢外包公司推荐了那么多岗位，在我困难的时候帮助我。我Android转Java Web确实有很多不足，可能也只能从外包做起。</p>
<p>但是我还是要对这家公司说不，晚上就打电话拒绝了，虽然已经签了合同，可是我不喜欢这种方式对待员工的公司，最后大家很不愉快的结束了谈话。</p>
<h1 id="事情原委"><a href="#事情原委" class="headerlink" title="事情原委"></a>事情原委</h1><p>前期公司给我推荐了很多岗位，这是我个人完全搞不定的，大部分都石沉大海。然而这家外包公司非常热情的推荐了我N家企业，每周都有几个面试。当时也被面的体无完肤，回答的好，被刷，回答的差，也被刷。整个人都很不好，甚至想过离开这个城市，转行。</p>
<p>其实第二次面试我觉得是过了，甲方下午给了答复，而且得到答复后就和这家外包签了雇佣合同。</p>
<p>第二天外包公司说甲方乌龙有一个人跟我一个姓，所以没有录用我，没有录用我的原因是态度恶劣。可是我那一次和面试官聊的非常好，而且态度也非常诚恳。我不知道公司和甲方怎么沟通的，但是我面试黄了。因为这个乌龙，公司承诺给我涨薪。</p>
<p>最近一次是甲方直接电话联系我过了，而且绕过了我的外包公司，说我公司变卦要涨价，我当时就蒙了。这个电话说我面试完当天就有结果，并且联系了公司，可是我没有得到任何方式的通知，说我面试过了。而且甲方联系我的时候，我过了另一家面试。</p>
<p>于是我问这家外包公司情况，公司答复我说过了，我再问之前承诺的涨薪，公司说不行，甲方没给那么多，让我先干3个月再酌情考虑。任何一个有脑子的人都知道这是拒绝了。</p>
<p>下午我就拒绝推荐的面试。晚上就跟外包公司说了离职。</p>
<h1 id="为什么我要拒绝"><a href="#为什么我要拒绝" class="headerlink" title="为什么我要拒绝"></a>为什么我要拒绝</h1><ol>
<li>我手上有正式的offer了，正式岗位非外包</li>
<li>公司层层外包的关系，太复杂。</li>
<li>公司利用延缓了我通过甲方面试的消息，从中间添加了一些不太好的流程。</li>
<li>我现在的offer待遇比外包好</li>
</ol>
<p>一个求职者，因为更好的机会，拒绝正在试用期的公司，我想不出有什么问题。</p>
<h1 id="我做的欠妥的地方"><a href="#我做的欠妥的地方" class="headerlink" title="我做的欠妥的地方"></a>我做的欠妥的地方</h1><ol>
<li>这家外包也确实在我身上花费了很多精力，我对此也表示内疚。</li>
<li>诚恳道歉的时候，经理情绪特别激动，差点就骂人了，我无可奈何，也控制不了。</li>
<li>经理怀疑我做人的标准，我承认，如果我手上没有offer，我还会摇尾巴回这家外包。但是因为这件事情，这家外包我绝对呆不久。</li>
</ol>
<h1 id="教训"><a href="#教训" class="headerlink" title="教训"></a>教训</h1><ul>
<li>吃亏这种事情，该吃才吃，不该吃的，坚决不能吃。</li>
<li>在外包面试驻场，一定要拿到面试官的电话，及时联系面试结果。</li>
<li>有些时候得罪人，不要怕。世界上几十亿人口，不会每个人都喜欢你。</li>
<li>我真诚待人，希望人亦可真诚待我，如果人做不到，我不苛求，也不亲近。</li>
<li>永远回归行业，其他任何职场情况都不要让其成为你在行业的障碍，人情世故，勾心斗角，对不起，我做技术的不善于也不想加入这种事情。</li>
</ul>
<p>最后引用张龙老师对技术人员回归技术的总结，我只想做一个纯粹的技术人员：</p>
<blockquote>
<ol>
<li>重视基础。无论是面试还是平时的工作，都不应该忽视基础的重要性，好的基础会让你走的更远，且更好。</li>
<li>没有多少“新技术”是所谓的全新技术，都是构建在已知的一些理论与实践基础之上的。比较深入了解底层的一些知识会让你更好地使用各种软件与工具。</li>
<li>在平日的项目与业务开发中，切忌不能将完成工作最为最终目标，它应该只是一个基本目标，否则连任务都完成不了，要你何用？在这个基础上，多思考、多想想还有哪些地方需要改进。</li>
<li>读书。我感觉程序员群里应该是一个比较爱看书的群体了。但还是有不少开发者一年连几本书都看不上，堪忧！</li>
<li>英文。好处不多说了。</li>
<li>复盘。经过一段时间，回顾一下自己在这一段时间的成长与收获及不足都有哪些，该完善完善、该改进改进，该保持保持。</li>
<li>节奏感。不要一下子用力过猛，保持稳健的节奏感会让你生活与工作都能在正轨上前行。</li>
</ol>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;对不起，可是我还是要拒绝&quot;&gt;&lt;a href=&quot;#对不起，可是我还是要拒绝&quot; class=&quot;headerlink&quot; title=&quot;对不起，可是我还是要拒绝&quot;&gt;&lt;/a&gt;对不起，可是我还是要拒绝&lt;/h1&gt;&lt;p&gt;这段时间一直在面试，没有什么精力写文章，整个人处于一种k于是我把快窒息的状态，所以我把简历发给了一家外包公司。&lt;/p&gt;
&lt;p&gt;公司非常热心，帮我推荐了很多家岗位。直到这天，我接到一个电话，彻底让我失望了。于是晚上我就打电话给外包的经理，拒绝了两家的甲方的offer。&lt;/p&gt;
&lt;p&gt;这个电话是其实是一家甲方公司打给我的，告诉我公司因为我面试通过了甲方的面试，向甲方提出涨价的要求，而我被我的公司隐瞒了拿到offer的事情，直到甲方给我私人打电话，整个流程内部操作十分不规范。&lt;br&gt;
    
    </summary>
    
    
      <category term="日记" scheme="http://micorochio.github.io/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Java的GC如何玩弄对象</title>
    <link href="http://micorochio.github.io/2017/03/30/How-Java-GC-Play-with-Memery/"/>
    <id>http://micorochio.github.io/2017/03/30/How-Java-GC-Play-with-Memery/</id>
    <published>2017-03-30T11:09:07.000Z</published>
    <updated>2017-03-30T03:33:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>Java的GC是什么，应该做Java的人都知道。但是其实GC的历史要比Java早，Java出现之前，人们就开始研究：</p>
<ul>
<li>哪些内存需要回收</li>
<li>哪些内存什么时候回收</li>
<li>怎样回收</li>
</ul>
<p>然后就有了GC，而Java解决的这3件事情，就目前看来，效果还可以。解决了很多的内存问题。但是，GC并不能解决所有内存动态分配的问题，尤其是高并发的软件中，了解GC，方便解决内存溢出问题，更好的控制和调节程序的回收和分配内存。<br><a id="more"></a></p>
<h2 id="I-对象生死判定算法"><a href="#I-对象生死判定算法" class="headerlink" title="I 对象生死判定算法"></a>I 对象生死判定算法</h2><p>感叹一下乔布斯当年看中的两项技术Internet 和OOP Language，现在都如日中天，不愧是乔帮主。</p>
<p>Java是OOP的经典语言之一，OOP语言号称万物皆对象，对象用不到了，那就应该离开内存了，这就是对象的死亡。是不是死掉的呢</p>
<p>死掉的对象，自然需要GC来处理，但是GC怎么知道对象已经死掉了呢？</p>
<h3 id="1x01-引用计数算法"><a href="#1x01-引用计数算法" class="headerlink" title="1x01  引用计数算法"></a>1x01  <strong>引用计数算法</strong></h3><p>就是给每个对象添加一个引用计数器，当对象被引用一次，计数器就+1；引用失效时，计数器就-1。当计数器为0，就说明对象死了。这个方法实现简单，效率也可观。但是，主流的JVM没用这个算法，因为这个算法很难解决循环引用的问题。</p>
<blockquote>
<p><strong>什么是循环引用？</strong><br>就是多个对象，互相引用对方作为属性，下面就是A依赖B，B依赖C，C依赖A的循环引用。<br><img src="http://upload-images.jianshu.io/upload_images/1112615-ac9f5b3e247bc4a9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="这就是，百度一下就知道了"></p>
</blockquote>
<p>当然，还有更细致的分法：</p>
<ul>
<li><em>强引用</em><br><code>String a = new String()</code>就是这样的，强引用存在，GC就不能回收对象</li>
<li><em>软引用</em><br>有用单非必须的对象，这些对象在内存快溢出就会被回收，回收内存依旧不够才会抛出异常</li>
<li><em>弱引用</em><br>比软引用还非必要，每次GC来的时候都会被回收</li>
<li><em>虚引用</em><br>最弱的引用，无法通过这个引用来获取对象，唯一的作用是在被回收事给系统一个通知</li>
</ul>
<h3 id="1x02-可达性算法"><a href="#1x02-可达性算法" class="headerlink" title="1x02 可达性算法"></a>1x02 <strong>可达性算法</strong></h3><p>这个比上面高大上一点，Java通过可达性分析来判定对象是否还被引用。什么的可达性分析呢：<br>Java会从一些叫做GCRoot的对象开始向下遍历，可以遍历到的对象，就是被引用的对象，不可以遍历到的对象就是不可达对象，就是死掉的对象了：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-70117103618610c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="蓝色表示可达对象
灰色表示不可达对象"><br><em>蓝色表示可达对象灰色表示不可达对象</em></p>
<p>在图上可以看到，从GCRoot开始，蓝色部分的对象都可以被遍历到，儿灰色部分，即使 Object A 可以遍历到 Object B 和Object C，但是却没有了GCRoot 引用，所以就属于不可达的死亡对象了<br><br>（是不是找不到对象就可以死了<code>T^T</code>）。</p>
<p>GCRoot 包括：栈中引用对象，方法区静态引用对象，方法区常量引用对象，本地方法引用对象（Native层的）</p>
<h2 id="II-GC回收垃圾的算法"><a href="#II-GC回收垃圾的算法" class="headerlink" title="II GC回收垃圾的算法"></a>II GC回收垃圾的算法</h2><p>既然已经能判断了垃圾有哪些，接下来就简单讲讲对垃圾对象如何清理</p>
<h3 id="2x01-标记-清除算法"><a href="#2x01-标记-清除算法" class="headerlink" title="2x01  标记-清除算法"></a>2x01  标记-清除算法</h3><p>跟名字一样，先把死掉的对象标记出来，然后清除，大部分算法是基于这个思想，不足之处也很明显，1是效率问题，标记和清除的过程都慢，2是空间问题，清除之后会带啦大量的不连续碎片空间。小的碎片会放不下大对象，导致大对象创建时又会触发一次回收</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-f653d6c28c45b880.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="回收前"><br><em>回收前</em></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-206b89e6f5936577.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="回收后"><br><em>回收后</em></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-e89082cc4f16a68f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="2x02-复制算法"><a href="#2x02-复制算法" class="headerlink" title="2x02 复制算法"></a>2x02 复制算法</h3><p>为了解决效率问题，有了复制算法，这种算法将内存分成相同大小的两块</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-ffaf64836f7d71d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="回收前"><br><em>回收前</em></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-81fc977d72535b59.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="回收后"><br><em>回收后</em></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-bbd542e94ead259d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>其实并不是非要等比划分内存的，大部分对象死的很早Hotspot是划分了三块区域，一块大的两块小的，大的叫Eden，小的叫survivor，大小比例为8:1。清理时将Eden和survivor中存活的对象复制到另一块survivor内存上，然后，清理掉用过的两块内存，下次再用。当survivor不够大的时候，需要依靠新的分配担保去拓展空间。</p>
<h3 id="2x03-标记-整理算法"><a href="#2x03-标记-整理算法" class="headerlink" title="2x03 标记-整理算法"></a>2x03 标记-整理算法</h3><p>综合复制和标记算法，整理算法会把有用的存活对象向y，一端移动，这样避免了复制算法浪费那么多内存，也不会像普通标记回收算法一样导致内存碎片过于严重。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-141b22c5c8f8efce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="回收前"><br><em>回收前</em></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-821ce46430e3de22.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="回收后"><br><em>回收后</em></p>
<h3 id="2x04-分代收集算法"><a href="#2x04-分代收集算法" class="headerlink" title="2x04 分代收集算法"></a>2x04 分代收集算法</h3><p>将java堆内存分成老年代，新生代。根据经验，新生代死亡比较快，老年代比较持久。所以一般新生代区域使用复制方法，只需要复制几个就可以了，老年代比较持久，所以一般用标记清除，或标记整理来回收。</p>
<h2 id="III-小结"><a href="#III-小结" class="headerlink" title="III 小结"></a>III 小结</h2><p>GC是Java中最诱人的处理内存的方式，也是最令人难受的处理方式。想要深入java，GC是绕不过的必经之路。了解GC的运作方法，可以帮助程序员处理更深层次的Java问题，做出更深层次的系统优化。希望我的小总结能给你带来帮助</p>
<p><strong>转载请注明出处。</strong><a href="https://micorochio.github.io/2017/03/31/How-Java-GC-Play-with-Memery/">https://micorochio.github.io/2017/03/31/How-Java-GC-Play-with-Memery/</a><br>ps我的博客：<a href="https://micorochio.github.io/">https://micorochio.github.io/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Java的GC是什么，应该做Java的人都知道。但是其实GC的历史要比Java早，Java出现之前，人们就开始研究：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;哪些内存需要回收&lt;/li&gt;
&lt;li&gt;哪些内存什么时候回收&lt;/li&gt;
&lt;li&gt;怎样回收&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;然后就有了GC，而Java解决的这3件事情，就目前看来，效果还可以。解决了很多的内存问题。但是，GC并不能解决所有内存动态分配的问题，尤其是高并发的软件中，了解GC，方便解决内存溢出问题，更好的控制和调节程序的回收和分配内存。&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="FS计划" scheme="http://micorochio.github.io/tags/FS%E8%AE%A1%E5%88%92/"/>
    
      <category term="GC" scheme="http://micorochio.github.io/tags/GC/"/>
    
      <category term="JVM" scheme="http://micorochio.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC快速学习笔记</title>
    <link href="http://micorochio.github.io/2017/03/19/spring-mvc-note/"/>
    <id>http://micorochio.github.io/2017/03/19/spring-mvc-note/</id>
    <published>2017-03-19T09:57:52.000Z</published>
    <updated>2017-03-19T09:59:24.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/1112615-306b3175e2265614.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>Spring MVC的工作流程</p>
<p>1 用户请求<br>2 前端控制器<br>3 handlerMapping 找到对应的Controller<br>4 controller 返回执行链<br>5 前端控制器通过 HandlerAdapter去执行执行链，返回model and view<br>6 将model and view交给视图渲染器，渲染成视图<br><a id="more"></a></p>
<h2 id="0x01使用配置"><a href="#0x01使用配置" class="headerlink" title="0x01使用配置"></a>0x01使用配置</h2><p>配置前端控制器,在Web.xml中添加<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher-servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--集成Mybatis--&gt;</span></div><div class="line">    <span class="comment">&lt;!--集成Spring--&gt;</span></div><div class="line">    <span class="comment">&lt;!--集成SpringMvc--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/spring-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher-servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>配置完成后，在classpath目录冲创建 spring文件夹，文件夹中创建spring Mvc配置文件</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-ffdfafceb94cc87a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="分层配置"></p>
<p>先不考虑service层和dao层，有了前端控制器，就需要配置HandlerMapping 映射器和HandlerAdapter 适配器，最后是视图解析器</p>
<p>为了简化配置，DefaultAnnotationHandlerMapping和AnnotationMethodHandlerAdapter被mvc标签代替<br>所以 spring-web.xml文件如下<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></div><div class="line">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></div><div class="line">       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</div><div class="line">       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd</div><div class="line">       http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!--开启注解模式--&gt;</span></div><div class="line">    <span class="comment">&lt;!--简化注解：</span></div><div class="line">        1：自动注册DefaultAnnotationHandlerMapping和AnnotationMethodHandlerAdapter</div><div class="line">        2：提供了一系列功能（数据绑定，数字和日期转换 @NumberFormat、@DateTimeFormat） xml和json的读写</div><div class="line">    --&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--</span></div><div class="line">        静态资源默认Servlet配置</div><div class="line">        对静态资源请求的支持：图片，css，js</div><div class="line">        允许使用"/"做整体映射</div><div class="line">    --&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--静态资源映射--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/rs/**"</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/static/"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--配置视图解析器--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"viewClass"</span> <span class="attr">value</span>=<span class="string">"org.springframework.web.servlet.view.JstlView"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/view/"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--配置自动扫描bean 如果和Spring其他组件一起使用，不建议全局扫描，只扫描controller就好了--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.zing"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div><div class="line">`</div></pre></td></tr></table></figure></p>
<h2 id="0x02-Controller"><a href="#0x02-Controller" class="headerlink" title="0x02 Controller"></a>0x02 Controller</h2><ul>
<li>URL映射<br>简单URL映射的配置：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mappings"</span>&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span>  </div><div class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"/userInfo"</span>&gt;</span>ControllerA<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>  </div><div class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </div><div class="line">      </div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ControllerA"</span> <span class="attr">class</span>=<span class="string">"com.zing.controller.ControllerDemo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p>不过现在一律使用注解式映射</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span>()</div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/login"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(HttpSession session)</span> </span>&#123;</div><div class="line">      ...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过RequestMapping来限定url访问的方法，注意的是@Controller()和@RequestMapping()是需要成对出现的，否则无法访问，另外RequestMapping还有延伸，通过规范请求方式，请求头等来限定用户请求。</p>
<ul>
<li>参数的绑定和自定义参数绑定<br>Spring MVC 自带参数绑定的功能，就是根据request中的key/value数据，找到对应名称和类型的入参，将参数绑定到对应的pojo对象上，特殊类型例如Date，可以通过自定义参数绑定，来讲参数绑定到pojo上</li>
</ul>
<p>写几个案例：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/user/signUp"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"邮箱  name="</span><span class="attr">email</span>"/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//注入1</span></div><div class="line">    <span class="meta">@PostMapping</span>(<span class="string">"user/signUp"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getToken</span><span class="params">(String email)</span> </span>&#123;</div><div class="line">      ...</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">//注入2</span></div><div class="line">   <span class="meta">@PostMapping</span>(<span class="string">"user/signUp"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getToken</span><span class="params">(@RequestParam(“email”)</span>String name) </span>&#123;</div><div class="line">      ...</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>还有N多注入方式，其原理大致一样：有兴趣百度：SpringMVC参数绑定<br>自定义参数绑定的方式是参数按照用户自己编写转换器处理后绑定<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>= <span class="string">"convertersBinder"</span> <span class="attr">class</span>= <span class="string">"org.springframework.format.support.FormattingConversionServiceFactoryBean"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"converters"</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>= <span class="string">"com.zing.converter.Converter01"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>= <span class="string">"com.zing,converter.Converter02"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>= <span class="string">"com.zing,converter.Converter03"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zing.account.interceptor;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Converter01</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">I</span>,<span class="title">O</span>&gt; </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> O <span class="title">convert</span><span class="params">(I input)</span> </span>&#123;</div><div class="line"><span class="comment">//        将input处理后生成O类型输出</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> O();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样前端的字符串，就可以转换成其他任意类型了。</p>
<h2 id="0x03-SpringMVC对事务的支持"><a href="#0x03-SpringMVC对事务的支持" class="headerlink" title="0x03 SpringMVC对事务的支持"></a>0x03 SpringMVC对事务的支持</h2><p>service一般用来处理数据逻辑业务，校验数据等。这一层属于业务逻辑层，所以在某些业务上需要进行事物处理.</p>
<p>如何使用SpringMVC的事务管理呢，有两种方法</p>
<ol>
<li>开启事务注解<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--配置事务管理器--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></div><div class="line">      <span class="comment">&lt;!--数据库连接池，集成之后就不会出现红色--&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="comment">&lt;!--开启注解式事物--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>使用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//注册Service接口中的注解式事物</span></div><div class="line"><span class="meta">@Transactional</span>(readOnly = <span class="keyword">false</span>, rollbackFor = DataAccessException.class)   </div><div class="line">    <span class="function">Account <span class="title">register</span><span class="params">(Account account)</span></span>;</div></pre></td></tr></table></figure></p>
<ol>
<li>配置AOP自动事务管理<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">&lt;!--切面通知--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"transactionInterceptor"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"save*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"insert*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"delete*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"select*"</span> <span class="attr">propagation</span>=<span class="string">"SUPPORTS"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">propagation</span>=<span class="string">"SUPPORTS"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">propagation</span>=<span class="string">"SUPPORTS"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--配置AOP--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"transactionInterceptor"</span></span></div><div class="line">                 <span class="attr">pointcut</span>=<span class="string">"execution(* com.zing.*.service.*.*(..))"</span>&gt;<span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>前者简单，后者可以规范代码。都可以选择。</p>
<h2 id="0x04-RESTful链接和静态资源的支持"><a href="#0x04-RESTful链接和静态资源的支持" class="headerlink" title="0x04 RESTful链接和静态资源的支持"></a>0x04 RESTful链接和静态资源的支持</h2><p>可以将URL的链接某部分作为参数传入方法<br><img src="http://upload-images.jianshu.io/upload_images/1112615-e6f7447b1d9f4860.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>静态资源可以用<code>&lt;mvc:resource &gt;</code>标签来映射，否则可能会会被拦截</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-769800662cdea7cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>如图的配置，表示将WEB-INF下static文件夹用/rs/来映射，这样就可以通过<br><code>http://localhost:8000/rs/js/jquery.min.js</code>来访问static目录下/js/jquery.min.js文件了</p>
<h2 id="0x05-拦截器"><a href="#0x05-拦截器" class="headerlink" title="0x05 拦截器"></a>0x05 拦截器</h2><p>Spring拦截器，编写一个类实现<code>org.springframework.web.servlet.HandlerInterceptor;</code>就可以作为拦截器使用了</p>
<p>拦截器中有3个方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//请求到达方法前执行</span></div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest var1, HttpServletResponse var2, Object var3)</span> <span class="keyword">throws</span> Exception</span>;</div><div class="line"></div><div class="line"><span class="comment">//执行方法后，没有返回ModuleAndView之前，可以执行</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest var1, HttpServletResponse var2, Object var3, ModelAndView var4)</span> <span class="keyword">throws</span> Exception</span>;</div><div class="line"></div><div class="line"><span class="comment">//方法执行后执行</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest var1, HttpServletResponse var2, Object var3, Exception var4)</span> <span class="keyword">throws</span> Exception</span>;</div></pre></td></tr></table></figure></p>
<p>配置拦截器方式<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/rs/**"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/getCaptcha"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/user/**"</span>/&gt;</span>    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.zing.account.interceptor.LoginInterceptor"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="0x06全局异常的处理-ExceptionResolver"><a href="#0x06全局异常的处理-ExceptionResolver" class="headerlink" title="0x06全局异常的处理 ExceptionResolver"></a>0x06全局异常的处理 ExceptionResolver</h2><p>Spring中有现成的全局异常处理解决方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionResolver</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> MyException) &#123;</div><div class="line">            <span class="comment">//处理逻辑</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">//处理逻辑</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到返回的依旧是 ModelAndView ，处理完成后，可将想返回给用户的友好的界面。</p>
<p>将这个全局异常处理器配置到xml中, 直接当Bean放进去就行，Spring会默认将异常处理交给这个Resolver。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.zing.exp-resolver.MyExceptionResolver"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-306b3175e2265614.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Spring MVC的工作流程&lt;/p&gt;
&lt;p&gt;1 用户请求&lt;br&gt;2 前端控制器&lt;br&gt;3 handlerMapping 找到对应的Controller&lt;br&gt;4 controller 返回执行链&lt;br&gt;5 前端控制器通过 HandlerAdapter去执行执行链，返回model and view&lt;br&gt;6 将model and view交给视图渲染器，渲染成视图&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="Spring" scheme="http://micorochio.github.io/tags/Spring/"/>
    
      <category term="SpringMVC" scheme="http://micorochio.github.io/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>(转载)Java设计模式：十篇</title>
    <link href="http://micorochio.github.io/2017/03/17/ten-kind-of-design-pattern/"/>
    <id>http://micorochio.github.io/2017/03/17/ten-kind-of-design-pattern/</id>
    <published>2017-03-17T15:56:19.000Z</published>
    <updated>2017-03-17T11:28:40.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/1112615-d97fd460c214b5cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="Java设计模式-一-—-单例模式"><a href="#Java设计模式-一-—-单例模式" class="headerlink" title="Java设计模式(一)—-单例模式"></a>Java设计模式(一)—-单例模式</h2><ul>
<li><p>一、特点：</p>
<ul>
<li><p>1、单例类只能有一个实例。</p>
</li>
<li><p>2、单例类必须自己创建自己的唯一实例。</p>
</li>
<li><p>3、单例类必须给所有其他对象提供这一实例。</p>
</li>
</ul>
</li>
</ul>
<p>单例模式确保某个类只有一个实例，而且自行实例化并向整个系统提供这个实例。<br><a id="more"></a></p>
<ul>
<li><p>二．分类</p>
<ul>
<li>(一)、懒汉式单例</li>
</ul>
</li>
</ul>
<p>//懒汉式单例类.在第一次调用的时候实例化自己</p>
<p>Singleton通过将构造方法限定为private避免了类在外部被实例化，在同一个虚拟机范围内，Singleton的唯一实例只能通过getInstance()方法访问。<br>（事实上，通过Java反射机制是能够实例化构造方法为private的类的，那基本上会使所有的Java单例实现失效。此问题在此处不做讨论，姑且掩耳盗铃地认为反射机制不存在。） </p>
<p><a href="https://yq.aliyun.com/articles/11333" target="_blank" rel="external">点击阅读此篇</a></p>
<h2 id="Java设计模式（二）—-建造者模式"><a href="#Java设计模式（二）—-建造者模式" class="headerlink" title="Java设计模式（二）—-建造者模式"></a>Java设计模式（二）—-建造者模式</h2><ul>
<li>一、 概念　</li>
</ul>
<p>建造模式是对象的创建模式。建造模式可以将一个产品的内部表象（internal representation）与产品的生产过程分割开来，从而可以使一个建造过程生成具有不同的内部表象的产品对象。</p>
<ul>
<li><p>1、产品的内部表象<br>一个产品常有不同的组成成分作为产品的零件，这些零件有可能是对象，也有可能不是对象，它们通常又叫做产品的内部表象（internal representation）。不同的产品可以有不同的内部表象，也就是不同的零件。使用建造模式可以使客户端不需要知道所生成的产品有哪些零件，每个 产品的对应零件彼此有何不同，是怎么建造出来的，以及怎么组成产品。</p>
</li>
<li><p>2、对象性质的建造</p>
</li>
</ul>
<p>有些情况下，一个对象的一些性质必须按照某个顺序赋值才有意义。在某个性质没有赋值之前，另一个性质则无法赋值。这些情况使得性质本身的建造涉 及到复杂的商业逻辑。这时候，此对象相当于一个有待建造的产品，而对象的这些性质相当于产品的零件，建造产品的过程是建造零件的过程。由于建造零件的过程 很复杂，因此，这些零件的建造过程往往被“外部化”到另一个称做建造者的对象里，建造者对象返还给客户端的是一个全部零件都建造完毕的产品对象。</p>
<p><a href="https://yq.aliyun.com/articles/11334" target="_blank" rel="external">点击阅读此篇</a></p>
<h2 id="Java设计模式（三—四）—-工厂模式"><a href="#Java设计模式（三—四）—-工厂模式" class="headerlink" title="Java设计模式（三—四）—-工厂模式"></a>Java设计模式（三—四）—-工厂模式</h2><p>工厂模式</p>
<p>在面向对象编程中, 最通常的方法是一个new操作符产生一个对象实例,new操作符就是用来构造对象实例的。但是在一些情况下, new操作符直接生成对象会带来一些问题。举例来说, 许多类型对象的创造需要一系列的步骤: 你可能需要计算或取得对象的初始设置; 选择生成哪个子对象实例; 或在生成你需要的对象之前必须先生成一些辅助功能的对象。在这些情况,新对象的建立就是一个“过程”，不仅是一个操作，像一部大机器中的一个齿轮传动。</p>
<p>模式的问题：你如何能轻松方便地构造对象实例，而不必关心构造对象实例的细节和复杂过程呢？</p>
<p>解决方案：建立一个工厂来创建对象</p>
<ul>
<li>一、引言<ul>
<li>1）还没有工厂时代：假如还没有工业革命，如果一个客户要一款宝马车,一般的做法是客户去创建一款宝马车，然后拿来用。</li>
<li>2）简单工厂模式：后来出现工业革命。用户不用去创建宝马车。因为客户有一个工厂来帮他创建宝马.想要什么车，这个工厂就可以建。比如想要宝马系列车。工厂就创建这个系列的车。即工厂可以创建产品。</li>
<li>3）工厂方法模式时代：为了满足客户，车系列越来越多，奔驰等系列,一个工厂无法创建所有的车系列。于是由单独分出来多个 具体的工厂。每个具体工厂创建一种系列。即具体工厂类只能创建一个具体产品。</li>
<li>4）抽象工厂模式时代：随着客户的要求越来越高，车进行分类，分为商务车和运动车两个族</li>
</ul>
</li>
</ul>
<p><a href="https://yq.aliyun.com/articles/11335" target="_blank" rel="external">点击阅读此篇</a></p>
<h2 id="Java设计模式（五）—-原型模式"><a href="#Java设计模式（五）—-原型模式" class="headerlink" title="Java设计模式（五）—-原型模式"></a>Java设计模式（五）—-原型模式</h2><ul>
<li>一、概述</li>
</ul>
<p>定义：原型模式属于对象的创建模式。通过给出一个原型对象来指明所有创建的对象的类型，然后用复制这个原型对象的办法创建出更多同类型的对象。简言之：就是复制粘贴。这就是选型模式的用意。</p>
<ul>
<li>二、结构</li>
</ul>
<p>原型模式主要用于对象的复制，它的核心是就是类图中的原型类Prototype。Prototype类需要具备以下两个条件：</p>
<ul>
<li><p>1、实现Cloneable接口。在java语言有一个Cloneable接口，它的作用只有一个，就是在运行时通知虚拟机可以安全地在实现了此接 口的类上使用clone方法。在java虚拟机中，只有实现了这个接口的类才可以被拷贝，否则在运行时会抛出 CloneNotSupportedException异常。</p>
</li>
<li><p>2、重写Object类中的clone方法。Java中，所有类的父类都是 Object类，Object类中有一个clone方法，作用是返回对象的一个拷贝，但是其作用域protected类型的，一般的类无法调用，因 此，Prototype类需要将clone方法的作用域修改为public类型。</p>
</li>
</ul>
<p><a href="https://yq.aliyun.com/articles/11336" target="_blank" rel="external">点击阅读此篇</a></p>
<h2 id="Java设计模式（六）—-适配器模式"><a href="#Java设计模式（六）—-适配器模式" class="headerlink" title="Java设计模式（六）—-适配器模式"></a>Java设计模式（六）—-适配器模式</h2><ul>
<li>1、概述</li>
</ul>
<p>　适配器模式把一个类的接口变换成客户端所期待的另一种接口，从而使原本因接口不匹配而无法在一起工作的两个类能够在一起工作。</p>
<ul>
<li>2、适配器模式的用途</li>
</ul>
<p>即Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以在一起工作。</p>
<p>下面是两个典型例子</p>
<p><a href="https://yq.aliyun.com/articles/11337" target="_blank" rel="external">点击阅读此篇</a></p>
<h2 id="Java设计模式（七）—-装饰模式"><a href="#Java设计模式（七）—-装饰模式" class="headerlink" title="Java设计模式（七）—-装饰模式"></a>Java设计模式（七）—-装饰模式</h2><ul>
<li><p>一、概述</p>
<ul>
<li><p>1.装饰模式(Decorator)的定义：又名包装(Wrapper)模式，装饰模式以对客户端透明的方式扩展对象的功能，是继承关系的一个替代方案。</p>
</li>
<li><p>2.装饰模式以对客户端透明的方式动态的给一个对象附加上更多的责任。换言之客户端并不会觉的对象在装饰前和装饰后有什么区别。</p>
</li>
<li><p>3.装饰模式可以在不创造更多的子类的模式下，将对象的功能加以扩展。</p>
</li>
</ul>
</li>
<li><p>二、装饰模式的结构</p>
</li>
</ul>
<p><a href="https://yq.aliyun.com/articles/11338" target="_blank" rel="external">点击阅读此篇</a></p>
<h2 id="Java设计模式（八）—-代理模式"><a href="#Java设计模式（八）—-代理模式" class="headerlink" title="Java设计模式（八）—-代理模式"></a>Java设计模式（八）—-代理模式</h2><p>代理模式</p>
<ul>
<li>1、生活中：</li>
</ul>
<p>代理就是一个人或者一个组织代表其他人去做一件事的现实生活中的。在一些情况下，一个客户不想或者不能够直接引用一个对象，而代理对象可以在客户端和目标对象之间起到中介的作用。</p>
<ul>
<li>2、官方：</li>
</ul>
<p>代理模式是对象的结构模式。代理模式给某一个对象提供一个代理对象，并由代理对象控制对原对象的引用</p>
<p><a href="https://yq.aliyun.com/articles/11339" target="_blank" rel="external">点击阅读此篇</a></p>
<h2 id="Java设计模式（九）—-外观模式"><a href="#Java设计模式（九）—-外观模式" class="headerlink" title="Java设计模式（九）—-外观模式"></a>Java设计模式（九）—-外观模式</h2><ul>
<li>一、定义</li>
</ul>
<p>Facade（外观）模式为子系统中的各类（或结构与方法）提供一个简明一致的界面，隐藏子系统的复杂性，使子系统更加容易使用。</p>
<ul>
<li>二、结构</li>
</ul>
<p>门面(Facade)角色 ：客户端可以调用这个角色的方法。此角色知晓相关的（一个或者多个）子系统的功能和责任。在正常情况下，本角色会将所有从客户端发来的请求委派到相应的子系统去。</p>
<p>子系统(SubSystem)角色 ：可以同时有一个或者多个子系统。每个子系统都不是一个单独的类，而是一个类的集合（如上面的子系统就是由SystemA、SystemB、 SystemC三个类组合而成）。每个子系统都可以被客户端直接调用，或者被门面角色调用。子系统并不知道门面的存在，对于子系统而言，门面仅仅是另外一 个客户端而已。</p>
<p><a href="https://yq.aliyun.com/articles/11340" target="_blank" rel="external">点击阅读此篇</a></p>
<h2 id="Java设计模式（十）—-桥接模式"><a href="#Java设计模式（十）—-桥接模式" class="headerlink" title="Java设计模式（十）—-桥接模式"></a>Java设计模式（十）—-桥接模式</h2><ul>
<li>一、定义</li>
</ul>
<p>将抽象部分与实现(行为)部分分离，使它们都可以独立的变化。<br>桥接模式的做法是把变化部分(实现)抽象出来，使变化部分与主类(抽象)分离开来，从而将多个维度的变化彻底分离。最后，提供一个管理类(如下面的引擎类)来组合不同维度上的变化，通过这种组合来满足业务的需要。</p>
<ul>
<li>二、结构</li>
</ul>
<p>图-桥接模式结构图</p>
<p><a href="https://yq.aliyun.com/articles/11342" target="_blank" rel="external">点击阅读此篇</a></p>
<p>原文地址：<a href="https://zhuanlan.zhihu.com/p/25781005" target="_blank" rel="external">https://zhuanlan.zhihu.com/p/25781005</a> </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-d97fd460c214b5cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Java设计模式-一-—-单例模式&quot;&gt;&lt;a href=&quot;#Java设计模式-一-—-单例模式&quot; class=&quot;headerlink&quot; title=&quot;Java设计模式(一)—-单例模式&quot;&gt;&lt;/a&gt;Java设计模式(一)—-单例模式&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;一、特点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;1、单例类只能有一个实例。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;2、单例类必须自己创建自己的唯一实例。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;3、单例类必须给所有其他对象提供这一实例。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;单例模式确保某个类只有一个实例，而且自行实例化并向整个系统提供这个实例。&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="设计模式" scheme="http://micorochio.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>java基础之：JDBC</title>
    <link href="http://micorochio.github.io/2017/03/09/basic-of-java-JDBC/"/>
    <id>http://micorochio.github.io/2017/03/09/basic-of-java-JDBC/</id>
    <published>2017-03-09T14:50:13.000Z</published>
    <updated>2017-08-05T12:28:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>JDBC是Java连接数据库的标准，为了兼容大部分数据库，Java提出了JDBC标准，通过这个标准，让各个数据库提供实现支持，这样实现一处编码，处处运行的Java特性。</p>
<p>习惯了ORM框架，却忘记了原本的JDBC，所以我觉得有必要复习来夯实一下基础。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-719a927e4839a667.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<a id="more"></a>
<h2 id="0x00-JDBC-历史"><a href="#0x00-JDBC-历史" class="headerlink" title="0x00 JDBC 历史"></a>0x00 JDBC 历史</h2><p>JDBC是Sun公司为了能够让SQL访问统一的一套纯JAVA API设计的一套接口，这种接口是遵循了微软的ODBC API模式。其驱动实现是各家数据库供应商编写的，通过JDBC API可以通过驱动实现数据库通信。</p>
<h2 id="0x01-链接数据库回顾"><a href="#0x01-链接数据库回顾" class="headerlink" title="0x01 链接数据库回顾"></a>0x01 链接数据库回顾</h2><p>基本Web常用的数据库都是有供Java链接的驱动，</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-d0884440199c9cc7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="三层结构"></p>
<p>那么如何使用JDBC？<br>写个Demo<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.sql.*;</div><div class="line"><span class="keyword">import</span> java.util.Properties;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by zing on 2017/3/7.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCDemo</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span>  <span class="keyword">void</span> <span class="title">testJDBC</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, IOException, SQLException </span>&#123;</div><div class="line">        <span class="comment">//注册驱动</span></div><div class="line">        Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</div><div class="line">        <span class="comment">//JDBC使用类似URL的数据源描述</span></div><div class="line">        String url = <span class="string">"jdbc:mysql://localhost:3306/demo"</span>;<span class="comment">//忽略</span></div><div class="line">        <span class="comment">//但是我们一般不会直接这样写死。而是使用配置来描述数据源，用户名，密码</span></div><div class="line">        Properties props = <span class="keyword">new</span> Properties();</div><div class="line">        FileInputStream propertiesFile = <span class="keyword">new</span> FileInputStream(<span class="string">"JDBC.properties"</span>);</div><div class="line">        props.load(propertiesFile);</div><div class="line">        propertiesFile.close();</div><div class="line"></div><div class="line">        String DriverStr = props.getProperty(<span class="string">"jdbc.Driver"</span>);</div><div class="line">        String urlStr = props.getProperty(<span class="string">"jdbc.url"</span>);</div><div class="line">        String userName = props.getProperty(<span class="string">"jdbc.name"</span>);</div><div class="line">        String passcode = props.getProperty(<span class="string">"jdbc.passworld"</span>);</div><div class="line"></div><div class="line">        <span class="comment">//打开数据库链接</span></div><div class="line">        Connection connection = DriverManager.getConnection(urlStr,userName,passcode);</div><div class="line">        <span class="comment">//执行SQL</span></div><div class="line">        Statement sta = connection.createStatement();</div><div class="line">        <span class="comment">//executeUpdate可以返回数据库更新的行数</span></div><div class="line">        <span class="keyword">int</span> efactRow = sta.executeUpdate(<span class="string">"UPDATE USER SET Permition = 'admin' WHERE username = 'Zing'"</span>);</div><div class="line">        <span class="comment">//executeQuery可以返回一个查询的结果集，这个集合的迭代器略有不同Iterator,没有hasNext方法，初始是，指针在数据前，必须调用next方法才能读取第一行数据</span></div><div class="line">        ResultSet resultSet = sta.executeQuery(<span class="string">"SELECT * FROM USER ;"</span>);</div><div class="line">        <span class="keyword">while</span> (resultSet.next())&#123;</div><div class="line">            <span class="comment">//当前行获取第一栏的值，具体类型需要看数据库实现</span></div><div class="line">            resultSet.getString(<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//关闭语句</span></div><div class="line">        sta.close();</div><div class="line">        <span class="comment">//关闭结果集</span></div><div class="line">        resultSet.close();</div><div class="line">        <span class="comment">//关闭数据库连接</span></div><div class="line">        connection.close();</div><div class="line"></div><div class="line">        <span class="comment">/*</span></div><div class="line">        一般情况下，关闭的操作会放在catch语句的finally块中，catch处理数据库异常，finally来关闭连接</div><div class="line">        */</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上面写的是大杂烩，一般会将获取连接抽取成一个方法，异常也会捕获，并在try/catch/finally中的finally块中，关闭数据库连接。</p>
<p>API用法可以看看<code>java.sql.Connection</code>，<code>java.sql.Statement</code>，<code>java.sql.ResultSet</code>，这样，基本的操作就可以了然了。</p>
<blockquote>
<p><em><code>boolean execute(String sql) throws SQLException;</code>这个方法可以执行任何SQL，返回执行是否成功</em>。慎用。</p>
</blockquote>
<h2 id="0x02-预编译SQL"><a href="#0x02-预编译SQL" class="headerlink" title="0x02 预编译SQL"></a>0x02 预编译SQL</h2><p>PrepareStatement，一个可以让数据库预编译SQL的API。<br>并不是所有的SQL都是写死的，例如：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> UserAccount <span class="keyword">Where</span> <span class="keyword">Name</span> =</div></pre></td></tr></table></figure></p>
<p>根据名称来查找用户，这里的名字自然是用户自己定义的，如果用Statement，则应该这么写<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findUserByName</span><span class="params">(String name)</span></span>&#123;</div><div class="line">  Statement  sta = connection.createStatement();</div><div class="line">  String findByName = <span class="string">"SELECT * FROM USER WHERE Name=' "</span>+name+<span class="string">" ';"</span>;</div><div class="line">  ResultSet resultSet = sta.executeQuery(findByName);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果将name交给普通用户来输入，则没什么问题，但是 如果交给黑客，name他会输入 <code>小明&#39; OR &#39;1&#39; = &#39;1</code>,这样语句拼接后就会变成<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">USER</span> <span class="keyword">WHERE</span> <span class="keyword">Name</span>=<span class="string">' 小明'</span> <span class="keyword">OR</span> <span class="string">'1'</span> = <span class="string">'1'</span>;</div></pre></td></tr></table></figure></p>
<p>这一句就会把数据库所有的用户全部查出来了，很严重的注入漏洞，基本就会被脱库了。</p>
<p>所以Java JDBC定义的预编译SQL的API。<br>上例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.sql.*;</div><div class="line"><span class="keyword">import</span> java.util.Properties;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCDemo</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testJDBC</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        Connection connection = <span class="keyword">null</span>;</div><div class="line">        Statement sta = <span class="keyword">null</span>;</div><div class="line">        ResultSet resultSet = <span class="keyword">null</span>;</div><div class="line">        PreparedStatement preSta = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            connection = getConnection();</div><div class="line">            <span class="comment">//执行SQL</span></div><div class="line">            </div><div class="line">            String findByName = <span class="string">"SELECT * FROM USER WHERE Name=?;"</span>;</div><div class="line">            preSta = connection.prepareStatement(findByName);</div><div class="line">            preSta.setString(<span class="number">1</span>,<span class="string">"Zing"</span>);</div><div class="line">            resultSet = preSta.executeQuery();</div><div class="line"></div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="comment">/*</span></div><div class="line">                一般情况下，关闭的操作会放在catch语句的finally块中，catch处理数据库异常，finally来关闭连接</div><div class="line">            */</div><div class="line">            <span class="comment">//关闭语句</span></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                preSta.close();</div><div class="line">                <span class="comment">//关闭结果集</span></div><div class="line">                resultSet.close();</div><div class="line">                <span class="comment">//关闭数据库连接</span></div><div class="line">                connection.close();</div><div class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, IOException, SQLException </span>&#123;</div><div class="line">        <span class="comment">//注册驱动</span></div><div class="line">        Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</div><div class="line">        <span class="comment">//JDBC使用类似URL的数据源描述</span></div><div class="line">        <span class="comment">//但是我们一般不会直接这样写死。而是使用配置来描述数据源，用户名，密码</span></div><div class="line">        Properties props = <span class="keyword">new</span> Properties();</div><div class="line">        FileInputStream propertiesFile = <span class="keyword">new</span> FileInputStream(<span class="string">"JDBC.properties"</span>);</div><div class="line">        props.load(propertiesFile);</div><div class="line">        propertiesFile.close();</div><div class="line"></div><div class="line">        String DriverStr = props.getProperty(<span class="string">"jdbc.Driver"</span>);</div><div class="line">        String urlStr = props.getProperty(<span class="string">"jdbc.url"</span>);</div><div class="line">        String userName = props.getProperty(<span class="string">"jdbc.name"</span>);</div><div class="line">        String passcode = props.getProperty(<span class="string">"jdbc.passworld"</span>);</div><div class="line">        <span class="keyword">return</span> DriverManager.getConnection(urlStr, userName, passcode);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 顺便重构了之前的代码。<br>我们用 <code>?</code>占位，留下可变参数的位置，后来再用<code>setString(int parameterIndex, String x)</code>这个方法将数据填充进SQL，这样，如果参数含有SQL关键字时，就不能通过编译，查不到结果。可以避免SQL注入。</p>
<p>preSta.setString(1,”Zing”);表示，在第一个<code>?</code>处设置参数为<code>Zing</code><br>当然参数是数字，日期时，可以使用，<br><code>void setDouble(int parameterIndex, double x) throws SQLException</code><br><code>setDate(int parameterIndex, java.sql.Date x)
            throws SQLException;</code></p>
<p>等方法，根据不同类型设置参数。</p>
<h2 id="0x03-数据库类型与转义"><a href="#0x03-数据库类型与转义" class="headerlink" title="0x03 数据库类型与转义"></a>0x03 数据库类型与转义</h2><p>数据库类型和Java类型是有一点不一样的，但是JDBC定义了其中的大部分类型，这里不一一列举</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-1b51a004c32f21c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MySQL部分类型对照表，有兴趣可以查一查"></p>
<p>JDBC中的转义是为了让Java访问数据库时，得到普遍的支持。一般用于下列特性</p>
<ul>
<li>时间日期的字面常亮</li>
<li>标量函数调用</li>
<li>存储过程调用</li>
<li>外连接查询</li>
<li>LIKE子句中转义字符</li>
</ul>
<p>数据库的日期转换成Java的日期，是通过ISO8601标准衡定并相互转换的</p>
<blockquote>
<p>d表示DATE、t表示TIME、ts表示TIMESTANP<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;d &apos;2017-01-22&apos;&#125;</div><div class="line">&#123;t &apos;19:30:29&apos;&#125;</div><div class="line">&#123;ts &apos;2017-01-22 19:30:29.989&apos;&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<p>标量函数是获取一个数值的函数，一般调用时嵌入标准函数名和参数，这个很少见到有人使用的，就不举例了。</p>
<p>存储过程，是数据库自建的存储方式，不同的数据库存储过程基本不一样，要调用存储过程，需要用call来进行转义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123;call PROC01(?,?)&#125;</div><div class="line">&#123;call PROC02&#125;</div></pre></td></tr></table></figure></p>
<p>如果你不明白什么存储过程，可以看看数据库相关的资料。</p>
<p>外连接，就是Outter Join，借用核心卷II中的例子<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> &#123;oj Books <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Publishers <span class="keyword">ON</span> Books.Publish_ID = Publishers.Publish_ID &#125;</div></pre></td></tr></table></figure></p>
<p>这条语句表示查询找不到出版商的书，相反如果是<code>RIGHT OUTER JOIN</code>则会查询出没有出版书的出版商，如果需要查到全部，则用<code>FULL OUTER JOIN</code><br>。这里用转义是因为有些数据库实现不太统一。</p>
<p>Like子句转义，是因为下划线和百分号在Like条件里是特殊的含义，需要用转义来表示<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">User</span> <span class="keyword">WHERE</span> <span class="keyword">Name</span> <span class="keyword">LIKE</span> %!_%ming &#123;escape <span class="string">'!'</span>&#125;</div></pre></td></tr></table></figure></p>
<p>{escape ‘!’}表示将！定义为转义符号，!_表示字面量下划线</p>
<h2 id="0x04-事务"><a href="#0x04-事务" class="headerlink" title="0x04 事务"></a>0x04 事务</h2><p>为了保证数据和业务逻辑的完整性，我们可以将一系列的SQL语句构建成一个事物，当所有语句都顺利执行的时候，事务可以被提交。但是如果中途被阻碍，则数据会被回滚，将数据恢复成执行前的样子。</p>
<p>首先需要关闭数据库自动提交<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">connection.setAutoCommit(<span class="keyword">false</span>);</div></pre></td></tr></table></figure></p>
<p>然后根据实际业务执行多条UPDATE INSERT DELETE语句<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">statement.executeUpdate(<span class="string">"SQL1"</span>);</div><div class="line">statement.executeUpdate(<span class="string">"SQL2"</span>);</div><div class="line">statement.executeUpdate(<span class="string">"SQL3"</span>);</div></pre></td></tr></table></figure></p>
<p>当所有语句顺利执行后，调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">connection.commit();</div></pre></td></tr></table></figure></p>
<p>如果遇到异常或错误，则可以调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">connection.rollback();</div></pre></td></tr></table></figure></p>
<p>其中JDBC支持事务保存点和批量更新<br>保存点：将事务的某一阶段设置为保存点后，可以控制回滚时，恢复到这个保存点的数据。从而更加精确的控制回滚操作<br>批量更新就是将大量数据一次性存入，或修改大量数据时使用的。两个🌰：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">statement.executeUpdate(<span class="string">"SQL1"</span>);</div><div class="line">Savepoint step1 = connection.setSavepoint();</div><div class="line">statement.executeUpdate(<span class="string">"SQL2"</span>);</div><div class="line"><span class="keyword">if</span>(something==<span class="keyword">false</span>)&#123;</div><div class="line">  connection.rollback(step1);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">String updateSQL = <span class="string">"……"</span>;</div><div class="line">statement.addBatch(updateSQL);</div><div class="line"><span class="keyword">while</span>(needUpdate)&#123;</div><div class="line">  command = <span class="string">"……"</span>+<span class="string">"updateSQL2"</span></div><div class="line">  statement.addBatch(updateSQL);</div><div class="line">&#125;</div><div class="line"><span class="comment">//批量执行</span></div><div class="line"><span class="keyword">int</span> effectRows = statement.executeBatch();</div></pre></td></tr></table></figure>
<blockquote>
<p><strong><em>批量执行中一定不能有查询语句，否则会抛出异常。</em></strong></p>
</blockquote>
<h2 id="0x05-文件查询和存入数据库"><a href="#0x05-文件查询和存入数据库" class="headerlink" title="0x05 文件查询和存入数据库"></a>0x05 文件查询和存入数据库</h2><p>不建议这么搞，数据库存入太多大文件会导致数据库庞大，备份和恢复的成本将增加。<br>在数据库中，二进制大对象称为Blob，字符型大对象为Clob<br>这里演示一下查询和存储<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//读取</span></div><div class="line"> PreparedStatement preparedStatement01 = connection.prepareStatement(<span class="string">"SELECT picture FROM PictureTab WHERE picName=?;"</span>);</div><div class="line"> preparedStatement01.setString(<span class="number">1</span>,<span class="string">"superman"</span>);</div><div class="line"> ResultSet rs = preparedStatement01.executeQuery();</div><div class="line"> <span class="keyword">if</span>(rs.next())&#123;</div><div class="line">     Blob picBlob = rs.getBlob(<span class="number">1</span>);</div><div class="line">     Image pic = ImageIO.read(picBlob.getBinaryStream());</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">//存储</span></div><div class="line"> Blob pictureBlob = connection.createBlob();</div><div class="line"> <span class="keyword">int</span> offset = <span class="number">0</span>;</div><div class="line"> OutputStream outStram = pictureBlob.setBinaryStream(offset);</div><div class="line"> ImageIO.write(pictureBlob,<span class="string">"PNG"</span>,outStram);</div><div class="line"> PreparedStatement preparedStatement02 = connection.prepareStatement(<span class="string">"INSERT INTO PictureTab VALUE (?,?);"</span>);</div><div class="line"> preparedStatement02.setString(<span class="number">1</span>, <span class="string">"SuperMan"</span>);</div><div class="line"> preparedStatement02.setBlob(<span class="number">2</span>,pictureBlob);</div><div class="line"> preparedStatement02.executeUpdate();</div></pre></td></tr></table></figure></p>
<h2 id="0x06-其他一些概念"><a href="#0x06-其他一些概念" class="headerlink" title="0x06 其他一些概念"></a>0x06 其他一些概念</h2><ul>
<li>元数据：数据库的结构和表信息等描述数据库结构和组成部分的数据</li>
<li>多结果集：一次查询，使用多个Select SQL语句是，会得到一个多结果集</li>
<li>可滚动结果集：可以向前，向后查询的结果集，之前的只能用Next向后查询，使用<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Statement stat = Connection.createStatement(ResultSet.TYPE_SCROLL_INSENSTIVE , ResultSet.CONCUR_READ_ONLY )</div></pre></td></tr></table></figure>
</li>
</ul>
<p>在获取结果集的时候，会变成一个可滚动集。</p>
<ul>
<li>获取数据库生成键值<code>statemwnt.getGeneratedKeys();</code></li>
<li>行集 RowSet接口继承了ResultSet，但不需要长时间占用数据库链接。</li>
</ul>
<hr>
<p>love&amp;peace<br>若有错误请不吝指出，谢谢。<br>我的博客：<a href="https://micorochio.github.io/">https://micorochio.github.io/</a><br>转载请注明出处:<a href="https://micorochio.github.io/2017/03/10/basic-of-java-JDBC/。">https://micorochio.github.io/2017/03/10/basic-of-java-JDBC/。</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JDBC是Java连接数据库的标准，为了兼容大部分数据库，Java提出了JDBC标准，通过这个标准，让各个数据库提供实现支持，这样实现一处编码，处处运行的Java特性。&lt;/p&gt;
&lt;p&gt;习惯了ORM框架，却忘记了原本的JDBC，所以我觉得有必要复习来夯实一下基础。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-719a927e4839a667.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="数据库" scheme="http://micorochio.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
      <category term="JDBC" scheme="http://micorochio.github.io/tags/JDBC/"/>
    
  </entry>
  
  <entry>
    <title>(FS计划)理清楚Spring的AOP到底怎么玩</title>
    <link href="http://micorochio.github.io/2017/02/28/how-to-play-with-SpringAOP/"/>
    <id>http://micorochio.github.io/2017/02/28/how-to-play-with-SpringAOP/</id>
    <published>2017-02-28T00:03:50.000Z</published>
    <updated>2017-03-01T07:33:57.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/1112615-6895c50cea7f837d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>前面简单介绍了Spring中AOP的使用，是基于XML配置。这次详细介绍一下Spring中AOP的使用和实现。<br><a id="more"></a></p>
<h2 id="0x00-回顾"><a href="#0x00-回顾" class="headerlink" title="0x00 回顾"></a>0x00 回顾</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">package com.zing.aspect_oriented_test;</div><div class="line">/**</div><div class="line"> * 方法切面</div><div class="line"> */</div><div class="line">public class SubjectService implements InterfaceSubjectService &#123;</div><div class="line">    @Override</div><div class="line">    public void AspectMethod(String str) &#123;</div><div class="line">        System.out.println(&quot;yo yo yo!\t&quot; + str);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">package com.zing.aspect_oriented_test;</div><div class="line">/**</div><div class="line"> * 对切面的处理，之前与之后</div><div class="line"> */public class AspectTarget &#123;</div><div class="line">    public void beforeYouTalk() &#123;</div><div class="line">        System.out.println(&quot;************beforeYouTalk, I know everything,so do not lie!&quot;);</div><div class="line">    &#125;</div><div class="line">    private void afterYouTalk() &#123;</div><div class="line">        System.out.println(&quot;************afterYouTalk, ha ha ha,good boy&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们知道了切面和切面处理方法，接下来告诉Spring，切面位置和处理方法<br>在XML配置文件中将两个bean配置到IoC容器中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;aspectService&quot; class=&quot;com.zing.aspect_oriented_test.SubjectService&quot;&gt;&lt;/bean&gt;</div><div class="line">&lt;bean id=&quot;aspect&quot; class=&quot;com.zing.aspect_oriented_test.AspectTarget&quot;&gt;&lt;/bean&gt;</div></pre></td></tr></table></figure></p>
<p>再配置切面和切面方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;aop:config&gt;</div><div class="line">    &lt;aop:pointcut id=&quot;pointCut&quot; expression=&quot;execution(* com.zing...*.*(..))&quot;&gt;&lt;/aop:pointcut&gt;</div><div class="line">    &lt;aop:aspect ref=&quot;aspect&quot;&gt;</div><div class="line">        &lt;aop:before pointcut-ref=&quot;pointCut&quot; method=&quot;beforeYouTalk&quot;&gt;&lt;/aop:before&gt;</div><div class="line">        &lt;aop:after pointcut=&quot;execution(* com.zing..*.*(..))&quot;  method=&quot;afterYouTalk&quot;&gt;&lt;/aop:after&gt;</div><div class="line">    &lt;/aop:aspect&gt;</div><div class="line">&lt;/aop:config&gt;</div></pre></td></tr></table></figure></p>
<p>上面的配置可能不太明白，因为用的是AspectJ语法，<code>* com.zing..*.*(..)</code>表示<code>com.zing</code>包下的所有子包的类与方法</p>
<p>例子撸完，写个Junit测试一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">package com.zing.aspect_oriented_test;</div><div class="line"></div><div class="line">import org.junit.Test;</div><div class="line">import org.springframework.context.ApplicationContext;</div><div class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</div><div class="line">/**</div><div class="line"> * Created by zing on 16/4/23.</div><div class="line"> */</div><div class="line">public class AspectJunitTest &#123;</div><div class="line">    @Test</div><div class="line">    public void AopTest()&#123;</div><div class="line">        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;spring-config.xml&quot;);</div><div class="line">        InterfaceSubjectService subjectService = applicationContext.getBean(&quot;aspectService&quot;,InterfaceSubjectService.class);</div><div class="line">        subjectService.AspectMethod(&quot;Monster&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>想必看完云里雾里的，这里面用到了AOP的配置，完全没有概念，接下来详细解释一下，配置的含义</p>
<h2 id="0x01-Aspect切面"><a href="#0x01-Aspect切面" class="headerlink" title="0x01 Aspect切面"></a>0x01 Aspect切面</h2><p>Aspect，是织入的节点，前面两篇文章已经介绍了代理，而代理的节点，就是用Aspect来标记的，因为Spring封装了优秀的AspectJ解决方案，Aspect作为一个既定的接口，被Spring扩展了多个具体类型的通知<code>BeforeAdvice</code>,<code>AfterAdvice</code>,<code>ThrowsAdvice</code></p>
<p>从<code>BeforeAdvice</code>中分析，Spring中将前置接口设定为<code>MethodBeforeAdvice</code>，这个接口中只需要实现<code>before</code>方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public interface MethodBeforeAdvice extends BeforeAdvice &#123;</div><div class="line">    void before(Method var1, Object[] var2, Object var3) throws Throwable;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个方法将会在目标方法执行前被回调。</p>
<p>同样<code>AfterAdvice</code>是后置通知，具体的继承有<code>AfterReturningAdvice</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public interface AfterReturningAdvice extends AfterAdvice &#123;</div><div class="line">    void afterReturning(Object var1, Method var2, Object[] var3, Object var4) throws Throwable;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>实现这个接口的<code>afterReturning</code>方法，在目标方法成功执行并返回值之后，AOP会回调<code>afterReturning</code>方法</p>
<p>最后<code>ThrowsAdvice</code>，其实是<code>AfterAdvice</code>子接口，在目标方法执行发生异常时，会被回调。<br>具体可以这么实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">class BoomException implements ThrowsAdvice&#123;</div><div class="line">    public void afterThrowing(IOException ioEx)&#123;</div><div class="line">        System.out.println(&quot;IO异常:&quot;+ioEx.getMessage());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void afterThrowing(ClassCastException ccEx)&#123;</div><div class="line">        System.out.println(&quot;转换异常:&quot;+ccEx.getMessage());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="0x02-Pointcut切点"><a href="#0x02-Pointcut切点" class="headerlink" title="0x02 Pointcut切点"></a>0x02 Pointcut切点</h2><p>切点定义了一个代理接入位置，决定了通知作用的连接点。当然，也可以是一堆连接点，一般用一个正则表达式标识。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public interface Pointcut &#123;</div><div class="line">    Pointcut TRUE = TruePointcut.INSTANCE;</div><div class="line"></div><div class="line">    ClassFilter getClassFilter();</div><div class="line"></div><div class="line">    MethodMatcher getMethodMatcher();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中<code>getMethodMatcher()</code>就是获取一个方法过滤器，这个方法过滤器将符合标准的方法，作为切面的连接点。<br>关于MethodMatcher，可以查看一下Spring源码。这里不做过多解释。</p>
<h2 id="0x03-Advisor通知器"><a href="#0x03-Advisor通知器" class="headerlink" title="0x03 Advisor通知器"></a>0x03 Advisor通知器</h2><p>配置中并没有写Advisor，所以简单介绍一下，一个完整的模块，当要进行AOP编程时，需要将方法标记为切面，并定义了切面前置通知、后置通知、异常通知。定义完成，需要通过通知器，将切面和通知绑定起来，这个通知器就是Advisor。</p>
<p>Advisor将Advice和Pointcut结合起来，通过IoC容器来配置AOP来使用。</p>
<h2 id="0x04-ProxyFactoryBean"><a href="#0x04-ProxyFactoryBean" class="headerlink" title="0x04 ProxyFactoryBean"></a>0x04 ProxyFactoryBean</h2><p>ProxyFactoryBean是Spring利用Java的代理模式或者CGLIB来实现Aop的一种方式，如何在XML中配置ProxyFactoryBean？</p>
<ul>
<li>通知器Advisor使用Bean来配置。</li>
<li>织入方法类使用Bean配置</li>
<li>定义ProxyFactoryBean，为这个bean配置几个参数：<ul>
<li>目标：target</li>
<li>代理接口：proxyInterface</li>
<li>织入类：interceptName</li>
</ul>
</li>
</ul>
<p>如果不清楚可以看<a href="http://www.jianshu.com/p/d03c6c8daab9" target="_blank" rel="external">AOP和Spring中AOP的简单介绍</a>中的第0x03小节的例子。这里就扣下代码，里面还有配置后置方法织入，异常方法通知织入，不一一介绍。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"aspectService"</span> <span class="attr">class</span>=<span class="string">"com.zing.aspect_oriented_test.SubjectService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"aspect"</span> <span class="attr">class</span>=<span class="string">"com.zing.aspect_oriented_test.AspectTarget"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"rocketProxy"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span> <span class="attr">ref</span>=<span class="string">"launchingControl"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyInterfaces"</span> <span class="attr">value</span>=<span class="string">"com.zing.aoptest.IRocketLaunching"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span> <span class="attr">value</span>=<span class="string">"beforeLaunch"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyTargetClass"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>因为ProxyFactoryBean是依靠Java或CGLIB的Proxy方式来获取对象的，使用依靠代理的<code>getObject()</code>方法来作为入口。使用接下来看一下这个方法的实现方式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public Object getObject() throws BeansException &#123;</div><div class="line">//初始化通知器</div><div class="line">        this.initializeAdvisorChain();</div><div class="line">//区分单例模式和原始模式prototype</div><div class="line">        if(this.isSingleton()) &#123;</div><div class="line">            return this.getSingletonInstance();</div><div class="line">        &#125; else &#123;</div><div class="line">            if(this.targetName == null) &#123;</div><div class="line">                this.logger.warn(&quot;Using non-singleton proxies with singleton targets is often undesirable. Enable prototype proxies by setting the \&apos;targetName\&apos; property.&quot;);</div><div class="line">            &#125;</div><div class="line">            return this.newPrototypeInstance();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>具体可以追一追<code>newPrototypeInstance()</code>和<code>getSingletonInstance()</code>两个方法，得到实现方式的完整过程。留给感兴趣的小伙伴。因为再往里挖就挖到CGLIB和JDK对象生成里去了，感觉刨过头了。</p>
<p>##0x05 Schema的AOP配置<br>前面啰嗦了一大堆，我觉得应该介绍一下具体的配置方式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--aop定义开始--&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></div><div class="line">       <span class="comment">&lt;!--定义通知器--&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">ref</span>=<span class="string">"aspectSupportBean"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></div><div class="line">       <span class="comment">&lt;!--定义切面 ref表示引用的bean--&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"aspectSupportBean"</span>&gt;</span></div><div class="line">           <span class="comment">&lt;!--定义切面增强位置--&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* cn.javass..*.*(..))"</span> &gt;</span><span class="tag">&lt;/<span class="name">aop:pointcut</span>&gt;</span></div><div class="line">           <span class="comment">&lt;!--前置通知，下面的参数跟第一个类似--&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">pointcut</span>=<span class="string">"切入点表达式"</span> <span class="attr">pointcut-ref</span>=<span class="string">"切入点Bean引用"</span>  <span class="attr">method</span>=<span class="string">"前置通知实现方法名"</span> <span class="attr">arg-names</span>=<span class="string">"前置通知实现方法参数列表参数名字"</span>/&gt;</span></div><div class="line">           <span class="comment">&lt;!--后置返回通知--&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">aop:after-returning</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></div><div class="line">           <span class="comment">&lt;!--异常通知--&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">aop:after-throwing</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></div><div class="line">           <span class="comment">&lt;!--最终通知--&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">aop:after</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></div><div class="line">           <span class="comment">&lt;!--环绕通知--&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">aop:around</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></div><div class="line">           <span class="comment">&lt;!--引入定义--&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">aop:declare-parents</span>  <span class="attr">types-matching</span>=<span class="string">"AspectJ语法类型表达式"</span> <span class="attr">implement-interface</span>=<span class="string">引入的接口</span>"  <span class="attr">default-impl</span>=<span class="string">"引入接口的默认实现"</span>  <span class="attr">delegate-ref</span>=<span class="string">"引入接口的默认实现Bean引用"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div></pre></td></tr></table></figure>
<p>如果你看完前面的东西应该不难理解这些配置<br>但是有一个execution，为此查阅了一下文档，切入点指示符。执行表达式的格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">execution（modifiers-pattern? ret-type-pattern declaring-type-pattern? name-pattern（param-pattern） throws-pattern?）</div></pre></td></tr></table></figure></p>
<p>除了返回类型模式（上面代码片断中的ret-type-pattern），名字模式和参数模式以外， 所有的部分都是可选的。返回类型模式决定了方法的返回类型必须依次匹配一个连接点。 你会使用的最频繁的返回类型模式是<code>*</code>，它代表了匹配任意的返回类型。 一个全限定的类型名将只会匹配返回给定类型的方法。名字模式匹配的是方法名。<br>你可以使用<code>*</code>通配符作为所有或者部分命名模式。 参数模式稍微有点复杂：()</p>
<p>匹配了一个不接受任何参数的方法， 而(..)</p>
<p>匹配了一个接受任意数量参数的方法（零或者更多）。 模式(*)</p>
<p>匹配了一个接受一个任何类型的参数的方法。 模式(*,String)</p>
<p>匹配了一个接受两个参数的方法，第一个可以是任意类型， 第二个则必须是String类型。</p>
<h2 id="0x06-AspectJ的AOP"><a href="#0x06-AspectJ的AOP" class="headerlink" title="0x06 @AspectJ的AOP"></a>0x06 @AspectJ的AOP</h2><p>是基于注解的AOP，默认Spring是不开启的，需要再XML里添加一行配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>之后便可以用注解的方式使用AOP了,我列举一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//配置切面</div><div class="line">@Aspect() </div><div class="line">Public class Aspect&#123; </div><div class="line">…… </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//配置织入方法</div><div class="line">@Pointcut(value=&quot;切入点表达式&quot;, argNames = &quot;参数名列表&quot;) </div><div class="line">public void pointcutName(……) &#123;&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//前置通知</span></div><div class="line"><span class="meta">@Before</span>(value = <span class="string">"切入点表达式或命名切入点"</span>, argNames = <span class="string">"参数列表参数名"</span>)</div><div class="line"></div><div class="line"><span class="comment">//后置返回通知</span></div><div class="line"><span class="meta">@AfterReturning</span>( </div><div class="line">value=<span class="string">"切入点表达式或命名切入点"</span>, </div><div class="line">pointcut=<span class="string">"切入点表达式或命名切入点"</span>, </div><div class="line">argNames=<span class="string">"参数列表参数名"</span>, </div><div class="line">returning=<span class="string">"返回值对应参数名"</span>) </div><div class="line"><span class="comment">// value：指定切入点表达式或命名切入点；</span></div><div class="line"><span class="comment">// pointcut：同样是指定切入点表达式或命名切入点，如果指定了将覆盖value属性指定的，pointcut具有高优先级；</span></div><div class="line"><span class="comment">// argNames：与Schema方式配置中的同义；</span></div><div class="line"><span class="comment">// returning：与Schema方式配置中的同义。</span></div><div class="line"></div><div class="line"><span class="comment">//后置通知</span></div><div class="line"><span class="meta">@After</span> ( </div><div class="line">value=<span class="string">"切入点表达式或命名切入点"</span>, </div><div class="line">argNames=<span class="string">"参数列表参数名"</span>) </div><div class="line"><span class="comment">//value：指定切入点表达式或命名切入点；</span></div><div class="line"><span class="comment">// argNames：与Schema方式配置中的同义；</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//异常通知</span></div><div class="line"><span class="meta">@AfterThrowing</span> ( </div><div class="line">value=<span class="string">"切入点表达式或命名切入点"</span>, </div><div class="line">pointcut=<span class="string">"切入点表达式或命名切入点"</span>, </div><div class="line">argNames=<span class="string">"参数列表参数名"</span>, </div><div class="line">throwing=<span class="string">"异常对应参数名"</span>)</div><div class="line"></div><div class="line"><span class="comment">//环绕通知</span></div><div class="line"><span class="meta">@Around</span> ( </div><div class="line">value=<span class="string">"切入点表达式或命名切入点"</span>, </div><div class="line">argNames=<span class="string">"参数列表参数名"</span>)</div><div class="line"></div><div class="line"><span class="comment">//引用</span></div><div class="line"><span class="meta">@DeclareParents</span>( </div><div class="line">value=<span class="string">" AspectJ语法类型表达式"</span>, </div><div class="line">defaultImpl=引入接口的默认实现类) </div><div class="line"><span class="keyword">private</span> Interface MyInterface;</div></pre></td></tr></table></figure>
<p>只是简化了配置，用起来跟Schema类似</p>
<p>##参考<br><a href="http://www.importnew.com/17795.html" target="_blank" rel="external">http://www.importnew.com/17795.html</a><br><a href="http://www.importnew.com/17813.html" target="_blank" rel="external">http://www.importnew.com/17813.html</a><br>《Spring 内幕技术》</p>
<hr>
<p><a href="https://micorochio.github.io/fs-plan/">FS全栈计划目录：https://micorochio.github.io/fs-plan/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-6895c50cea7f837d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;br&gt;前面简单介绍了Spring中AOP的使用，是基于XML配置。这次详细介绍一下Spring中AOP的使用和实现。&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="Spring" scheme="http://micorochio.github.io/tags/Spring/"/>
    
      <category term="AOP" scheme="http://micorochio.github.io/tags/AOP/"/>
    
  </entry>
  
  <entry>
    <title>(FS计划)AOP和Spring中AOP的简单介绍</title>
    <link href="http://micorochio.github.io/2017/02/25/introduction-of-AOP/"/>
    <id>http://micorochio.github.io/2017/02/25/introduction-of-AOP/</id>
    <published>2017-02-25T00:05:48.000Z</published>
    <updated>2017-03-01T07:33:39.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/1112615-f513cbc11f698921.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="0x00-AOP是什么"><a href="#0x00-AOP是什么" class="headerlink" title="0x00 AOP是什么"></a>0x00 AOP是什么</h2><p>AOP <em><code>(Aspect Oriented Programming)</code></em>面向切面编程，Spring是通过Java动态代理实现的。</p>
<p>AOP的目的是为了将组件和业务代码分离开，让日志、事务处理、缓存、性能统计、权限控制等等模块跟实际的业务模块解耦。</p>
<p>这么说还是很笼统，Java的类中，属性和方法才是主流，切面是什么，完全没这个概念。<br>那么以拍电影举个栗子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1.前期筹备，剧本确定、演员试镜确定</div><div class="line">############分割线a</div><div class="line">2. 开拍、剪辑、制作</div><div class="line">############分割线b</div><div class="line">3. 营销、宣传、公映</div></pre></td></tr></table></figure></p>
<p>1-&gt;2-&gt;3这个流程是拍电影的业务流程，但是如果我要拍花絮怎么办，这个流程不属于现在的电影业务流程，我们需要安排一个零时的业务，那我们就要在<code>############分割线a</code>分割线那里添加摄花絮的计划，分配一些人员。<br>那么分割线那里，就是切面。这些切面干什么，由切面代理去管理和运行，这就是AOP。<br><a id="more"></a></p>
<h2 id="0x01-AOP的用途"><a href="#0x01-AOP的用途" class="headerlink" title="0x01 AOP的用途"></a>0x01 AOP的用途</h2><p>来说说为什么要用AOP：<br>AOP中面向切面编程的这个切面就是针对流程的。当某些服务与业务无关，比如日志系统，日志系统与现实业务应该是相互独立的，但是，在编写代码的时候我们需要这些日志来调试定位程序执行的位置。<br>这些日志代码如果直接写在程序里会扰乱原本的业务模块，会影响到系统的持续集成</p>
<p>因此我们希望日志系统能够独立于业务代码，但是每当业务执行到某个位置时，日志又会输出。这就要借助于AOP了<em>（想象一下，业务代码被切开了，中间插入了日志执行的标记，走到标记时就会输出日志，这个标记就是切面）</em></p>
<p>当然，还有业务中登录状态验证，权限检查，全局的事务处理，共用的某些模块，都可以用AOP来实现，这是OOP的进步</p>
<h1 id="0x02-代理模式"><a href="#0x02-代理模式" class="headerlink" title="0x02 代理模式"></a>0x02 代理模式</h1><p>Java动态代理是基于代理模式的一种实现，可以查询一下代理模式，这里将动态代理的对应关系图贴一下</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-c3cc7c540bc86019.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="java中的动态代理模式"></p>
<p>我们通过代理接口Subject去执行RealSubject的subjectMethod()方法，而java的动态代理是，通过InvocationHandler中invoke()方法去调用Proxy事先生成好实例对象。说的有点绕口，配合看图。<br>再不明白：可以看我的：<a href="http://www.jianshu.com/p/893ffc0b7a73" target="_blank" rel="external">(FS计划)Java里的动态代理模式和代理方法增强</a><br>或者：<a href="http://www.cnblogs.com/xiaoluo501395377/p/3383130.html" target="_blank" rel="external">看别人的详细介绍</a></p>
<h2 id="0x03-Spring里的动态代理"><a href="#0x03-Spring里的动态代理" class="headerlink" title="0x03 Spring里的动态代理"></a>0x03 Spring里的动态代理</h2><p>因为Spring中拥有了DI的高级特性，所以在Spring中实现动态代理是可以依靠配置Bean来实现的。Spring中的动态代理依赖下面几个接口和类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.aop.BeforeAdvice;<span class="comment">//前置通知</span></div><div class="line"><span class="keyword">import</span> org.springframework.aop.AfterAdvice;<span class="comment">//后置通知</span></div><div class="line"><span class="keyword">import</span> org.springframework.aop.ThrowsAdvice;<span class="comment">//异常通知</span></div><div class="line"><span class="keyword">import</span> org.aopalliance.intercept.MethodInterceptor;<span class="comment">//环绕通知</span></div><div class="line"><span class="keyword">import</span> org.springframework.aop.IntroductionAdvisor;<span class="comment">//引介通知</span></div></pre></td></tr></table></figure></p>
<p>可以写一个例子来看看</p>
<ul>
<li>接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zing.aoptest;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IRocketLaunching</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">launch</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>目标对象 </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zing.aoptest;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RocketLaunchingImpl</span> <span class="keyword">implements</span> <span class="title">IRocketLaunching</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">launch</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"倒计时：987654321 发射！"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>织入类  </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zing.aoptest;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"><span class="keyword">import</span> org.springframework.aop.MethodBeforeAdvice;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrepareForLaunching</span> <span class="keyword">implements</span> <span class="title">MethodBeforeAdvice</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, Object[] params, Object obj)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        System.out.println(<span class="string">"给火箭家燃料\n"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>代理对象 </li>
</ul>
<p>交给Spring 来做<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">&lt;!--前置增强类--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"beforeLaunch"</span>  <span class="attr">class</span>=<span class="string">"com.zing.aoptest.PrepareForLaunching"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--目标类--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"launchingControl"</span> <span class="attr">class</span>=<span class="string">"com.zing.aoptest.RocketLaunchingImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--工厂--&gt;</span></div><div class="line"><span class="comment">&lt;!--optimize为true表示使用CGLib，false为Java动态代理。默认为false--&gt;</span></div><div class="line"><span class="comment">&lt;!--当织入对象需要使用单例模式的时候，optimize建议为true，这样比较节省资源--&gt;</span></div><div class="line"><span class="comment">&lt;!--target表示需要代理的类，会为这个目标织入前置增强和后置增强--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"rocketProxy"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span> <span class="attr">ref</span>=<span class="string">"launchingControl"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyInterfaces"</span> <span class="attr">value</span>=<span class="string">"com.zing.aoptest.IRocketLaunching"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span> <span class="attr">value</span>=<span class="string">"beforeLaunch"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyTargetClass"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<ul>
<li>测试一下 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">package com.zing.aoptest;</div><div class="line"></div><div class="line">import org.springframework.context.ApplicationContext;</div><div class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</div><div class="line">import org.testng.annotations.Test;</div><div class="line"></div><div class="line">public class AOPTest &#123;</div><div class="line"></div><div class="line">    @Test</div><div class="line">    public  void AopTest() &#123;</div><div class="line">        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;classpath:spring/spring-dao.xml&quot;);</div><div class="line"></div><div class="line">        RocketLaunchingImpl rocketLaunching = (RocketLaunchingImpl) context.getBean(&quot;rocketProxy&quot;);</div><div class="line"></div><div class="line">        rocketLaunching.launch();</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试结果</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-eeeff8cf57d0f994.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h2 id="0x04-Spring-里的AOP简单介绍"><a href="#0x04-Spring-里的AOP简单介绍" class="headerlink" title="0x04 Spring 里的AOP简单介绍"></a>0x04 Spring 里的AOP简单介绍</h2><p>Spring的AOP是基于JDK的代理模式和CGLib为技术基础，完成织入横切代码的一项功能。</p>
<p>朕要去撸一个AOP的代码例子：</p>
<hr>
<p>例子好了，但是依旧没搞清楚AOP配置的语法，先不急</p>
<p>放上例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">package com.zing.aspect_oriented_test;</div><div class="line">/**</div><div class="line"> * 方法切面</div><div class="line"> */</div><div class="line">public class SubjectService implements InterfaceSubjectService &#123;</div><div class="line">    @Override</div><div class="line">    public void AspectMethod(String str) &#123;</div><div class="line">        System.out.println(&quot;yo yo yo!\t&quot; + str);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">package com.zing.aspect_oriented_test;</div><div class="line">/**</div><div class="line"> * 对切面的处理，之前与之后</div><div class="line"> */public class AspectTarget &#123;</div><div class="line">    public void beforeYouTalk() &#123;</div><div class="line">        System.out.println(&quot;************beforeYouTalk, I know everything,so do not lie!&quot;);</div><div class="line">    &#125;</div><div class="line">    private void afterYouTalk() &#123;</div><div class="line">        System.out.println(&quot;************afterYouTalk, ha ha ha,good boy&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们知道了切面和切面处理方法，接下来告诉Spring，切面位置和处理方法<br>在XML配置文件中将两个bean配置到IoC容器中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;aspectService&quot; class=&quot;com.zing.aspect_oriented_test.SubjectService&quot;&gt;&lt;/bean&gt;</div><div class="line">&lt;bean id=&quot;aspect&quot; class=&quot;com.zing.aspect_oriented_test.AspectTarget&quot;&gt;&lt;/bean&gt;</div></pre></td></tr></table></figure></p>
<p>再配置切面和切面方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;aop:config&gt;</div><div class="line">    &lt;aop:pointcut id=&quot;pointCut&quot; expression=&quot;execution(* com.zing...*.*(..))&quot;&gt;&lt;/aop:pointcut&gt;</div><div class="line">    &lt;aop:aspect ref=&quot;aspect&quot;&gt;</div><div class="line">        &lt;aop:before pointcut-ref=&quot;pointCut&quot; method=&quot;beforeYouTalk&quot;&gt;&lt;/aop:before&gt;</div><div class="line">        &lt;aop:after pointcut=&quot;execution(* com.zing..*.*(..))&quot;  method=&quot;afterYouTalk&quot;&gt;&lt;/aop:after&gt;</div><div class="line">    &lt;/aop:aspect&gt;</div><div class="line">&lt;/aop:config&gt;</div></pre></td></tr></table></figure></p>
<p>上面的配置可能不太明白，因为用的是AspectJ语法，<code>* com.zing..*.*(..)</code>表示<code>com.zing</code>包下的所有子包的类与方法</p>
<p>例子撸完，写个Junit测试一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">package com.zing.aspect_oriented_test;</div><div class="line"></div><div class="line">import org.junit.Test;</div><div class="line">import org.springframework.context.ApplicationContext;</div><div class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</div><div class="line">/**</div><div class="line"> * Created by zing on 16/4/23.</div><div class="line"> */</div><div class="line">public class AspectJunitTest &#123;</div><div class="line">    @Test</div><div class="line">    public void AopTest()&#123;</div><div class="line">        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;spring-config.xml&quot;);</div><div class="line">        InterfaceSubjectService subjectService = applicationContext.getBean(&quot;aspectService&quot;,InterfaceSubjectService.class);</div><div class="line">        subjectService.AspectMethod(&quot;Monster&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">************beforeYouTalk, I know everything,so do not lie!</div><div class="line">yo yo yo!	Monster</div><div class="line">************afterYouTalk, ha ha ha,good boy</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-f10097b73ad03a88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="还是上图吧"></p>
<p>代码没问题，<em>（全程注意你引得包不要出问题，可以参考我之前的小白文<a href="http://www.jianshu.com/p/2101d176555b" target="_blank" rel="external">IDEA 构建SpringMVC+MAVEN项目</a>）</em>下面聊一下AOP的配置</p>
<p>吐槽：觉得XML配置好烦人<br>这篇再写就累赘了，算了，这个Spring的动态代理的写法并不常用，配置写起来也异常麻烦，后面会详细介绍AOP的常规使用方法，敬请期待</p>
<p>如果有错误，麻烦留言告诉我。转载请注明出处：<a href="https://micorochio.github.io/2017/02/25/introduction-of-AOP/">https://micorochio.github.io/2017/02/25/introduction-of-AOP/</a></p>
<hr>
<p><a href="https://micorochio.github.io/fs-plan/">FS全栈计划目录：https://micorochio.github.io/fs-plan/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-f513cbc11f698921.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;0x00-AOP是什么&quot;&gt;&lt;a href=&quot;#0x00-AOP是什么&quot; class=&quot;headerlink&quot; title=&quot;0x00 AOP是什么&quot;&gt;&lt;/a&gt;0x00 AOP是什么&lt;/h2&gt;&lt;p&gt;AOP &lt;em&gt;&lt;code&gt;(Aspect Oriented Programming)&lt;/code&gt;&lt;/em&gt;面向切面编程，Spring是通过Java动态代理实现的。&lt;/p&gt;
&lt;p&gt;AOP的目的是为了将组件和业务代码分离开，让日志、事务处理、缓存、性能统计、权限控制等等模块跟实际的业务模块解耦。&lt;/p&gt;
&lt;p&gt;这么说还是很笼统，Java的类中，属性和方法才是主流，切面是什么，完全没这个概念。&lt;br&gt;那么以拍电影举个栗子：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1.前期筹备，剧本确定、演员试镜确定&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;############分割线a&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2. 开拍、剪辑、制作&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;############分割线b&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3. 营销、宣传、公映&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;1-&amp;gt;2-&amp;gt;3这个流程是拍电影的业务流程，但是如果我要拍花絮怎么办，这个流程不属于现在的电影业务流程，我们需要安排一个零时的业务，那我们就要在&lt;code&gt;############分割线a&lt;/code&gt;分割线那里添加摄花絮的计划，分配一些人员。&lt;br&gt;那么分割线那里，就是切面。这些切面干什么，由切面代理去管理和运行，这就是AOP。&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="Spring" scheme="http://micorochio.github.io/tags/Spring/"/>
    
      <category term="AOP" scheme="http://micorochio.github.io/tags/AOP/"/>
    
  </entry>
  
  <entry>
    <title>个人全栈计划开始</title>
    <link href="http://micorochio.github.io/2017/02/23/2017-02-22%EF%A3%BF15-56-13/"/>
    <id>http://micorochio.github.io/2017/02/23/2017-02-2215-56-13/</id>
    <published>2017-02-22T21:00:06.000Z</published>
    <updated>2017-03-09T07:05:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>讲道理，全栈工程师很少说自己是全栈，倒是一些什么都会一点的人喜欢把全栈挂嘴边，其实什么都不精通。<br>一直想做个全栈，可惜还差得远。所以写个计划：一方面激励一下自己，防止放荡不羁的太过分；另一方做个积淀，是时候正儿八经的做事情了。</p>
<p>目前计划只是个雏形，不过肯定是围绕Java Web和NodeJS的<br>后面也许会学习一下PHP和Python，但是不敢打包票，毕竟1口吃不下N个胖子</p>
<h2 id="计划列表"><a href="#计划列表" class="headerlink" title="计划列表"></a>计划列表</h2><ol>
<li>Java 8新特性和老知识细嚼慢咽</li>
<li>Spring家族</li>
<li>MySQL</li>
<li>ES6.0</li>
<li>NodeJS</li>
<li>TypeScript</li>
<li>Angular 2 等前端框架</li>
</ol>
<p>……乍一看已经挖坑很深了，后面服务器运维的东西已经不敢提上日程了。如果顺利的话，大概得明年才能开启。<br>目前打算Java语言特性会作为穿插写一写，先从Spring开始扒起，和持久层一起看，主要是自己看的东西，笔记，也可能是转载。</p>
<p>如果努力的话，上半年能把Spring家族的坑，填个十之八九，接下来就是新的JavaScript、NodeJS和一些前端框架了<br>年底如果没完成，自打80大板<br><a id="more"></a></p>
<h2 id="离开时间的计划就是扯淡"><a href="#离开时间的计划就是扯淡" class="headerlink" title="离开时间的计划就是扯淡"></a>离开时间的计划就是扯淡</h2><p>计划需要有个期限，毕竟自己是个拖延症晚期，所以得需要有个准确是期限去完成。<br>但是计划肯定是赶不上变化的，因此我只会对1周进行详细规划，中间如果出问题，下周计划时，方便调整。</p>
<p>一周的时间说长不长，说短不短。希望自己能有所收获，并能把收获记录下来。</p>
<h2 id="叨逼叨"><a href="#叨逼叨" class="headerlink" title="叨逼叨"></a>叨逼叨</h2><p>最恨自己不够坚持，没有耐心，这次这个坑填不完就糗了，毕竟已经公开。<br>不过如果写东西写勤快了，也许可能会有错误，我会在简书上开个专栏，如果错了希望大家能积极指出。我会积极改正！</p>
<p>先这么定着，这个系列会用FallStack（FS）标记。并且将会写一个专门的目录文，后面如果有变化的话，会更新这个目录。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;讲道理，全栈工程师很少说自己是全栈，倒是一些什么都会一点的人喜欢把全栈挂嘴边，其实什么都不精通。&lt;br&gt;一直想做个全栈，可惜还差得远。所以写个计划：一方面激励一下自己，防止放荡不羁的太过分；另一方做个积淀，是时候正儿八经的做事情了。&lt;/p&gt;
&lt;p&gt;目前计划只是个雏形，不过肯定是围绕Java Web和NodeJS的&lt;br&gt;后面也许会学习一下PHP和Python，但是不敢打包票，毕竟1口吃不下N个胖子&lt;/p&gt;
&lt;h2 id=&quot;计划列表&quot;&gt;&lt;a href=&quot;#计划列表&quot; class=&quot;headerlink&quot; title=&quot;计划列表&quot;&gt;&lt;/a&gt;计划列表&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Java 8新特性和老知识细嚼慢咽&lt;/li&gt;
&lt;li&gt;Spring家族&lt;/li&gt;
&lt;li&gt;MySQL&lt;/li&gt;
&lt;li&gt;ES6.0&lt;/li&gt;
&lt;li&gt;NodeJS&lt;/li&gt;
&lt;li&gt;TypeScript&lt;/li&gt;
&lt;li&gt;Angular 2 等前端框架&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;……乍一看已经挖坑很深了，后面服务器运维的东西已经不敢提上日程了。如果顺利的话，大概得明年才能开启。&lt;br&gt;目前打算Java语言特性会作为穿插写一写，先从Spring开始扒起，和持久层一起看，主要是自己看的东西，笔记，也可能是转载。&lt;/p&gt;
&lt;p&gt;如果努力的话，上半年能把Spring家族的坑，填个十之八九，接下来就是新的JavaScript、NodeJS和一些前端框架了&lt;br&gt;年底如果没完成，自打80大板&lt;br&gt;
    
    </summary>
    
    
      <category term="日记" scheme="http://micorochio.github.io/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>（矫情）关于编程</title>
    <link href="http://micorochio.github.io/2017/02/13/2017-02-08%EF%A3%BF15-54-42/"/>
    <id>http://micorochio.github.io/2017/02/13/2017-02-0815-54-42/</id>
    <published>2017-02-12T18:59:15.000Z</published>
    <updated>2017-02-22T08:34:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>这些年，互联网爆炸式的发展，促生了无数程序员。<br>也促生了达内，黑马，极客学院等大量 IT培训机构。<br>短短数年间，科班出生的程序员和培训机构出生的程序员呈指数增长。<br>程序员的职业也不再是金饭碗。写了这么多代码，有些感触，所以写下来。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-5900f98dba39a766.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="0x00关于语言"><a href="#0x00关于语言" class="headerlink" title="0x00关于语言"></a>0x00关于语言</h3><p>从汇编到C语言，再从VB到C++，后来Java 、js……,越来越多的语言被创造出来，渐渐的出现一个奇怪的现象，程序员语言鄙视链。其实所谓的鄙视链往往也就是因为各种语言的性能以及难易度造成的。<br>按照我现在的经验，往往越高级的语言，越容易阅读，可性能也比不过C语言这种中层语言。因为一系列的检查机制和代码编译造成了一些性能浪费。<br><a id="more"></a><br>我觉得语言其实不分好坏，各种语言都各自的优点和缺点，Java适合用来做Web，因为早期的跨平台加上多年积淀，已经让Java EE发展到现在，无数的框架模板各种企业级商业解决方案，Swift在iOS上独领风骚。Python在爬虫等行业上发展壮大。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-98c6a417f12f780a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>有些人喜欢拿语言缺点说事，我觉得吧，这种人应该自己写一套语言，看看他写的语言能不能既像自然语言一样好理解，还能完美利用内存，性能堪比汇编。<br>说PHP是世界上最好的语言只是一句玩笑话，几乎有点编程经验的都知道。世界上没有最好的语言，只有最合适的语言。如果你非要分好坏，我表示不争论这个，我且尊重你的观点。</p>
<h3 id="0x01关于经验主义"><a href="#0x01关于经验主义" class="headerlink" title="0x01关于经验主义"></a>0x01关于经验主义</h3><p>很多刚毕业的或者刚培训出来的学生，在找工作的时候喜欢批评HR，没经验怎么了，你们不也是从没经验过来的吗？凭什么招聘非要3年经验的。应届生不是人吗</p>
<p>HR招人只是为工作，经验足的上手快，基本认的是这个理。不是HR错了，也不是没经验错了，这个矛盾至始至终没有什么好的解决办法。<br>大家都是从没经验过来的，如果幸运的被大公司找去当实习生出来也不愁经验的问题。所以吐槽3年经验，还不如让自己多接触点实际项目，哪怕是抄开源的东西，只要你做出来了，也是极好的，分分钟上手一个项目，哪家公司会不想要，除非雇不起。</p>
<p><em>在编程这一行，天赋跟经验都很重要。</em>比如从来没有人跟你说过泛型，也没有见过搭建框架来完成项目，那么在你写业务的时候，你可能自己封装了一个类，直接就上了。<br>但是如果你看过别人用了这个方式，你肯定会觉得自己写的不如人家，以后会学习别人。<br>这就是经验积累。这种积累无可替代，都是自己摸索。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-8280147a0f124c36.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>但是这种经验有时候也挺害人的，比如某个语言出来一个新的特性，因为没用过，奉行经验主义会让你避免使用这个新的更高效的功能。<br>因为你认为传统的东西更可靠，更安全，殊不知在正式推出新特性的时候，语言工程师无数的调试和修改，保证了稳定性才推出了正式的更新。<br>除开程序员，一些老爸老妈级的网民和政府机关现在还在用IE6，也是因为经验主义，觉得IE6一直用，很舒服，不喜欢换。<br>或者特定的软件必须用IE6，这款软件几万年没有更新了，除了IE6没有其他可兼容的浏览器能运行，也间接影响了各种机关办事效率。可能走办一个业务，走一个程序要等很久，很久。我是真心希望这些机构能更新一下软件和硬件，毕竟我们国家的税收不低。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-be2bfd27dd6fb391.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>经验是用来避免已经犯过的错误，不是用来逃避技术更新说辞。双刃剑靠自己把握</p>
<h3 id="0x02-关于科班和培训生"><a href="#0x02-关于科班和培训生" class="headerlink" title="0x02 关于科班和培训生"></a>0x02 关于科班和培训生</h3><p>我的观点是程序员不是按出生分的，有人这么分，是因为公司按这种分类给程序员不同的待遇，尤其是体制观念很深刻的公司。不得不说有的人潜意识里还是有《出生论》批判过的思维。</p>
<p>非要排个序的话，我是把能力排在第一的，而且我觉得程序员之间不要用科班生和培训生来分类，如果你觉得待遇不公平，上等的方式就是做的比他更好，然后跟老板要该有的待遇。<br>一个公司不能给有能力的员工符合能力的待遇，一般情况下员工会自己离开的。如果你不出众，却觉得：比你更差的人却比你待遇好，老板是不是傻，我要跳槽…… 之类的时候，很可能陷入一个恶性循环，自己能力一般，跳来跳去，最后既没有拿到自己想要的待遇，也没有提升自己的技术水平，这就尴尬了。</p>
<p>所以能力我是放在第一位的，能吸引老板的地方，必然是我会的比别人多，我学的比别人快……</p>
<p>当你觉得：我擦，凭什么大学好一点待遇就比我好那么多？或者：那个野鸡大学出来，进培训班出来的程序员凭啥对我吆五喝六的？的时候。我只能说：少年，你的思想很危险啊。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-3605aa94989716bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>只要公司里不是像宫斗戏一样勾心斗角，作为技术人员还是把技术放在第一位的比较好。</p>
<p>你问如果勾心斗角怎么办，呵呵，you can you up,no can you leave! 毕竟人家厚黑也是他的能力。</p>
<h3 id="0x04-关于非对口专业入行"><a href="#0x04-关于非对口专业入行" class="headerlink" title="0x04 关于非对口专业入行"></a>0x04 关于非对口专业入行</h3><p>如果你觉得自己上了假大学，找不到工作，想干程序员；或者，你觉得程序员看起来高大上，想干这一行；或者，你热爱编码……<br>如果你不是对口专业，还想入行的时候，培训机构是最佳选择，不过从零开始培训的培训机构看起来高大上，也要注意一定要上实践课，保证你找工作起码有2~3个熟透的中型工程<br>这样你找工作就轻而易举了，别还没上完就急着找工作，到时候工作发现技术不够用，痛苦的是你自己。</p>
<p>我是不鼓励语言基础在培训机构里学习的，那些个课程网上一搜一大堆，前面说的编程经验就是告诉你，要有做项目的能力<br>所以培训机构值钱的就是实战项目，这种实战项目越新，越有用，越老，越说明培训机构越out。<br>常见的已经OUT的实战项目如：学籍管理、进存销系统、电商购物车、坦克大战、贪吃蛇、2048……，因为这些东西老了，网上一搜一大堆。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-86c9960f296bd1f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>报名培训机构的小伙伴要注意，最好多试听几节课，3~4节，也要看清所谓的学后付款是不是贷款交学费，贷款交学费的话，无论你学没学好，都会强制还贷款的。<br>还要小心打着招聘的幌子，骗你培训交学费的机构。这种灰色的东西，光凭平社会的正义感是很难消灭的，还是自己小心。</p>
<p>至于培训机构，不是报名费越高，资格越老，就越好的。我个人的评判的标准还是看培训机构的实战项目你能不能从网上搜到、新技术有没有在培训的课程里更新。</p>
<h3 id="0x04-关于学习"><a href="#0x04-关于学习" class="headerlink" title="0x04 关于学习"></a>0x04 关于学习</h3><p>怎么说呢，道理大家都知道，但是懒惰谁都难逃魔掌，看谁懒的少一点，或者更会懒一点。<br>懒得少一点：就是你比别人付出更多时间来学习，尽量多打鸡血，笨鸟先飞，勤能补拙！<br>更会懒一点：就是你有不一样的学习方法，学习五分钟，装逼两小时。效率比一般人好n^n倍！</p>
<p>分享一个别人的学习方法<a href="http://mp.weixin.qq.com/s/apOiJZkOWivhSvN14tWziQ" target="_blank" rel="external">Xdite：永葆热情的上瘾式学习法</a><br><strong><em>忽略这篇文章的广告，还是有干货的：</em></strong></p>
<blockquote>
<p><strong>Orid 学习法</strong></p>
<ul>
<li>Objective 你对今天学的记得什么？</li>
<li>Reflective 一句话形容今天的情绪（今天的高峰、低峰）；</li>
<li>Interpretive 今天你学到了啥？重要的领悟是什么？</li>
<li>Decisional 一句话形容今天的工作，明天要继续哪些工作。</li>
</ul>
<p><strong>精力管理</strong><br>每个人的高效时间是不一样的。而不是用力过猛想在所有的时间全部拿来学习，或全部拿来做事。<br>而甚至在有了这个基础的概念之后，我还会安利其他人，当你觉得倒霉时，迷信的说法就是倒霉顶多是一天的事，发现自己倒霉，就赶快去睡觉，把霉运睡掉。<br>而这背后科学的道理实质上只是恢复旺盛的专注力。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-2c8e80832c8273c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>不一一举例了，自己看就好</p>
<h3 id="0x05-关于顿悟"><a href="#0x05-关于顿悟" class="headerlink" title="0x05 关于顿悟"></a>0x05 关于顿悟</h3><p>不知道顿悟这个标题合不合适，有时候看着新的技术，会突然一下感觉眼前一亮，原来能这样。或者看自己以前的代码，我擦那是什么shit，改着改着，自己技术就上来了。<br>有时候同事的东西或者github上的东西会让你觉得，好厉害的编码，我要用到自己的项目里<br><img src="http://upload-images.jianshu.io/upload_images/1112615-e83bbcfe101e6d0c.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>当遇到这种情况的时候，千万要抓住时机，重构自己的代码，或记下自己的领会，不然这种感觉失去了，可能你又要变得浑浑噩噩，可能以后再也找不回那种feel了。</p>
<p>嗯，这一条是写给我自己看的，因为我之前想到的，现在因为断线了，补不回来了，唉。</p>
<hr>
<p>欢迎转载，转载请注明出处<br>我的博客<a href="http://azing.xyz" target="_blank" rel="external">http://azing.xyz</a></p>
<h2 id="love-amp-peace"><a href="#love-amp-peace" class="headerlink" title="love&amp;peace"></a><em>love&amp;peace</em></h2><p>欢迎转载，转载请注明出处<a href=""></a></p>
<p><em>love&amp;peace</em></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这些年，互联网爆炸式的发展，促生了无数程序员。&lt;br&gt;也促生了达内，黑马，极客学院等大量 IT培训机构。&lt;br&gt;短短数年间，科班出生的程序员和培训机构出生的程序员呈指数增长。&lt;br&gt;程序员的职业也不再是金饭碗。写了这么多代码，有些感触，所以写下来。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-5900f98dba39a766.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;0x00关于语言&quot;&gt;&lt;a href=&quot;#0x00关于语言&quot; class=&quot;headerlink&quot; title=&quot;0x00关于语言&quot;&gt;&lt;/a&gt;0x00关于语言&lt;/h3&gt;&lt;p&gt;从汇编到C语言，再从VB到C++，后来Java 、js……,越来越多的语言被创造出来，渐渐的出现一个奇怪的现象，程序员语言鄙视链。其实所谓的鄙视链往往也就是因为各种语言的性能以及难易度造成的。&lt;br&gt;按照我现在的经验，往往越高级的语言，越容易阅读，可性能也比不过C语言这种中层语言。因为一系列的检查机制和代码编译造成了一些性能浪费。&lt;br&gt;
    
    </summary>
    
    
      <category term="日记" scheme="http://micorochio.github.io/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis使用笔记</title>
    <link href="http://micorochio.github.io/2017/02/06/my-batis-note/"/>
    <id>http://micorochio.github.io/2017/02/06/my-batis-note/</id>
    <published>2017-02-06T15:56:19.000Z</published>
    <updated>2017-02-06T08:08:26.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/1112615-9f3500165cc54a1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="1-编写配置文件"><a href="#1-编写配置文件" class="headerlink" title="1. 编写配置文件"></a>1. 编写配置文件</h2><a id="more"></a>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE configuration</span></div><div class="line">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</div><div class="line">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--使用JDBC的getGeneratedKeys获取自增Key数据库主键值--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useGeneratedKeys"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">        <span class="comment">&lt;!--使用别名替换列名字--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useColumnLabel"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">        <span class="comment">&lt;!--开启驼峰命名转换--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure>
<p>将连接数据库的库信息，写入Spring的xml文件中<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--配置MybatisSQLSession--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--注入连接池--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></div><div class="line">        <span class="comment">&lt;!--注入Mybatis全局配置--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:database/mybatis-config.xml"</span>/&gt;</span></div><div class="line">        <span class="comment">&lt;!--扫描entity包--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.zing.account.entity"</span>/&gt;</span></div><div class="line">        <span class="comment">&lt;!--扫描mapper文件--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:database/mapper/*.xml"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="2-获取SqlSessionFactory"><a href="#2-获取SqlSessionFactory" class="headerlink" title="2.获取SqlSessionFactory"></a>2.获取SqlSessionFactory</h2><p>Spring 管理下，用获取bean的方法就能获取SqlSessionFactory<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ApplicationContext acontext = <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string">"xxxx.xml"</span>);</div><div class="line">acontext.getBean(<span class="string">"sqlSessionFactory"</span>);</div></pre></td></tr></table></figure></p>
<p>还有其他方式获取Bean，不一一列举。</p>
<blockquote>
<p><em>不使用Spring管理SQLSession的话,可以按照官方文档，补全Mybatis-config.xml,再通过下面代码获得SqlSession</em></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String resource = <span class="string">"org/mybatis/example/mybatis-config.xml"</span>;</div><div class="line">InputStream inputStream = Resources.getResourceAsStream(resource);</div><div class="line">sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</div></pre></td></tr></table></figure>
<h2 id="3-编写SQL映射文件，添加到mybatis-config-xml"><a href="#3-编写SQL映射文件，添加到mybatis-config-xml" class="headerlink" title="3.编写SQL映射文件，添加到mybatis-config.xml"></a>3.编写SQL映射文件，添加到mybatis-config.xml</h2><p>创建<code>email.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE mapper</span></div><div class="line">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</div><div class="line">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zing.account.dao.LoginAndSignUpDAO"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"isEmailAlreadyExists"</span>&gt;</span></div><div class="line">        SELECT count(0)</div><div class="line">        FROM cmc_login_oauth</div><div class="line">        WHERE login_email=#&#123;email&#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>吧mapper文件添加到<code>mybatis-config.xml</code>的<code>&lt;configuration&gt;</code>内,注意路径要正确<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"classpash:/mapper/email.xml"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="4-SqlSession进行数据库访问"><a href="#4-SqlSession进行数据库访问" class="headerlink" title="4.SqlSession进行数据库访问"></a>4.SqlSession进行数据库访问</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SqlSession session = sqlSessionFactory.openSession();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">  <span class="comment">// 通过SqlSession，进行数据库访问,如查询</span></div><div class="line">  <span class="comment">//session.select("nameSpace.SqlID",param)</span></div><div class="line">  session.select(<span class="string">"com.zing.account.dao.LoginAndSignUpDAO.isEmailAlreadyExists"</span>,<span class="string">"1234@zing.com"</span>);</div><div class="line"></div><div class="line">&#125; <span class="keyword">finally</span> &#123;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><em>这里注意：参数只能传一个，如果需要传多个参数作为筛选条件，可使用一个实体类封装，或者使用List，Map封装，获取这些参数可以参考后面OGNL的介绍</em></p>
</blockquote>
<h2 id="5-查询结果映射实体类"><a href="#5-查询结果映射实体类" class="headerlink" title="5.查询结果映射实体类"></a>5.查询结果映射实体类</h2><p>可以将实体类，配置到Mapper里面，colum表示列名，jdbcType可以参考jdbc包下面的Type类，property表示实体类中的属性名字<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE mapper</span></div><div class="line">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</div><div class="line">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zing.account.dao.LoginAndSignUpDAO"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userEntity"</span> <span class="attr">type</span>=<span class="string">"com.zing.account.entity.UserEntity"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"userName"</span>/&gt;</span></div><div class="line">        ...</div><div class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"isEmailAlreadyExists"</span>&gt;</span></div><div class="line">        SELECT count(0)</div><div class="line">        FROM cmc_login_oauth</div><div class="line">        WHERE login_email=#&#123;email&#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="6-OGNL表达式"><a href="#6-OGNL表达式" class="headerlink" title="6.OGNL表达式"></a>6.OGNL表达式</h2><p>参考下面列表</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-93adf63d365a7038.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6-1"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1112615-839ad13f438bac6b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6-2"></p>
<h2 id="7-拼接SQL"><a href="#7-拼接SQL" class="headerlink" title="7.拼接SQL"></a>7.拼接SQL</h2><p>首先，注意&amp;&amp;和<code>&quot;</code>这类符号，要在XML转义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&amp;&amp; ：and</div><div class="line">|| ：or</div><div class="line">% ：mod</div><div class="line"></div><div class="line">&quot; ：&amp;quot;</div><div class="line">&lt; ：&amp;lt;</div></pre></td></tr></table></figure></p>
<p>符号转义可以参考：<a href="http://www.w3school.com.cn/xml/xml_cdata.asp" target="_blank" rel="external">http://www.w3school.com.cn/xml/xml_cdata.asp</a><br>更多的转义，可以百度<br>那么拼接SQL可以像下面一样<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"isEmailAlreadyExists"</span>&gt;</span></div><div class="line">    SELECT count(0)</div><div class="line">    FROM cmc_login_oauth</div><div class="line">    WHERE login_email=#&#123;email&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">text</span>=<span class="string">"userName!=null and "</span>"<span class="attr">.equals</span>(<span class="attr">userName.trim</span>())"&gt;</span>and user_name=#&#123;userName&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这样满足userName不为空的时候，就会拼接SQL预编译。</p>
<blockquote>
<p>注意注入漏洞</p>
</blockquote>
<h2 id="8-参考"><a href="#8-参考" class="headerlink" title="8.参考"></a>8.参考</h2><p>MyBatis官方文档：<a href="http://www.mybatis.org/mybatis-3/zh/getting-started.html" target="_blank" rel="external">http://www.mybatis.org/mybatis-3/zh/getting-started.html</a><br>慕课网：<a href="http://www.imooc.com" target="_blank" rel="external">http://www.imooc.com</a></p>
<blockquote>
<p><em>转载请务必注明出处：<a href="https://micorochio.github.io/2017/02/07/my-batis-note/">https://micorochio.github.io/2017/02/07/my-batis-note/</a></em></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1112615-9f3500165cc54a1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-编写配置文件&quot;&gt;&lt;a href=&quot;#1-编写配置文件&quot; class=&quot;headerlink&quot; title=&quot;1. 编写配置文件&quot;&gt;&lt;/a&gt;1. 编写配置文件&lt;/h2&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="Java Web" scheme="http://micorochio.github.io/tags/Java-Web/"/>
    
      <category term="MyBatis" scheme="http://micorochio.github.io/tags/MyBatis/"/>
    
  </entry>
  
  <entry>
    <title>函数式接口功能笔记</title>
    <link href="http://micorochio.github.io/2017/01/23/functional-interface-note/"/>
    <id>http://micorochio.github.io/2017/01/23/functional-interface-note/</id>
    <published>2017-01-23T14:29:36.000Z</published>
    <updated>2017-01-23T08:37:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-Consumer"><a href="#0x00-Consumer" class="headerlink" title="0x00 Consumer"></a>0x00 Consumer</h2><p>接受一个参数，不反回结果，所以是消费者<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  * Performs this operation on the given argument.</div><div class="line">  *</div><div class="line">  * <span class="doctag">@param</span> t the input argument</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</div></pre></td></tr></table></figure></p>
<p>内部还有一个默认方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  * 返回一个组合的Consumer，依次执行前面Consumer的`accept()`， 接着是&#123;<span class="doctag">@code</span> after&#125;后操作。</div><div class="line">  * 如果执行任一操作抛出异常，则将异常抛出给操作的调用方。</div><div class="line">  * 如果执行前面的`accept()`会引发异常，则不执行&#123;<span class="doctag">@code</span> after&#125;后的操作。</div><div class="line">  *</div><div class="line">  * <span class="doctag">@param</span> after the operation to perform after this operation</div><div class="line">  * <span class="doctag">@return</span> a composed &#123;<span class="doctag">@code</span> Consumer&#125; that performs in sequence this</div><div class="line">  * operation followed by the &#123;<span class="doctag">@code</span> after&#125; operation</div><div class="line">  * <span class="doctag">@throws</span> NullPointerException if &#123;<span class="doctag">@code</span> after&#125; is null</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">default</span> Consumer&lt;T&gt; <span class="title">andThen</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; after)</span> </span>&#123;</div><div class="line">     Objects.requireNonNull(after);</div><div class="line">     <span class="keyword">return</span> (T t) -&gt; &#123; accept(t); after.accept(t); &#125;;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h2 id="0x01-Function"><a href="#0x01-Function" class="headerlink" title="0x01 Function"></a>0x01 Function</h2><p>接受一个参数，返回一个参数，是处理一个对象，所以是功能<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * 请求执行，就是apply</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> t the function argument</div><div class="line">     * <span class="doctag">@return</span> the function result</div><div class="line">     */</div><div class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 返回一个组合Function，它首先执行&#123;<span class="doctag">@code</span> before&#125;内的方法，</div><div class="line">     * 将方法返回值作为下一个Function函数的输入参数，</div><div class="line">     * 如果两个函数的求值都抛出异常，它将被传递给组合函数的调用者。</div><div class="line">     */</div><div class="line">    <span class="keyword">default</span> &lt;V&gt; <span class="function">Function&lt;V, R&gt; <span class="title">compose</span><span class="params">(Function&lt;? <span class="keyword">super</span> V, ? extends T&gt; before)</span> </span>&#123;</div><div class="line">        Objects.requireNonNull(before);</div><div class="line">        <span class="keyword">return</span> (V v) -&gt; apply(before.apply(v));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 返回一个组合Function，首先执行super中的方法，</div><div class="line">     * 然后将&#123;<span class="doctag">@code</span> super&#125;函数的返回值作为after内方法是输入参数，再执行after内的方法。</div><div class="line">     * 如果两个函数的求值都抛出异常，它将被传递给组合函数的调用者。</div><div class="line">     */</div><div class="line">    <span class="keyword">default</span> &lt;V&gt; <span class="function">Function&lt;T, V&gt; <span class="title">andThen</span><span class="params">(Function&lt;? <span class="keyword">super</span> R, ? extends V&gt; after)</span> </span>&#123;</div><div class="line">        Objects.requireNonNull(after);</div><div class="line">        <span class="keyword">return</span> (T t) -&gt; after.apply(apply(t));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 返回这个Function自己</div><div class="line">     */</div><div class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">Function&lt;T, T&gt; <span class="title">identity</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> t -&gt; t;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>一般用来做行为传递，将行为交给编码者<br><br><strong>eg：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLambda</span><span class="params">()</span> </span>&#123;</div><div class="line">    doSomeXX(<span class="number">12</span>, num -&gt; num + num + num, c -&gt; c * c);</div><div class="line">&#125;</div><div class="line"></div><div class="line"> <span class="function"><span class="keyword">public</span> Function <span class="title">doSomeXX</span><span class="params">(<span class="keyword">int</span> num, Function&lt;Integer, Integer&gt; fistDo,Function&lt;Integer, Integer&gt; andThen)</span> </span>&#123;</div><div class="line">    fistDo.andThen(andThen).apply(num);</div><div class="line">    <span class="keyword">return</span> fistDo;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="0x02-Pradicate"><a href="#0x02-Pradicate" class="headerlink" title="0x02 Pradicate"></a>0x02 Pradicate</h2><p>输入一个值，判断是否符合要求，返回一个<code>boolean</code>值.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  * 测试参数t,是否符合要求</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T t)</span></span>;</div><div class="line"></div><div class="line"> <span class="comment">/**</span></div><div class="line">  * 创建一个组合Predicate，同时测试t是否符合另一标准，并且返回这两个结果的`&amp;&amp;`值。</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">default</span> Predicate&lt;T&gt; <span class="title">and</span><span class="params">(Predicate&lt;? <span class="keyword">super</span> T&gt; other)</span> </span>&#123;</div><div class="line">     Objects.requireNonNull(other);</div><div class="line">     <span class="keyword">return</span> (t) -&gt; test(t) &amp;&amp; other.test(t);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">/**</span></div><div class="line">  * 返回测试结果的非运算值`!`,即不符合标注。</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">default</span> Predicate&lt;T&gt; <span class="title">negate</span><span class="params">()</span> </span>&#123;</div><div class="line">     <span class="keyword">return</span> (t) -&gt; !test(t);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">/**</span></div><div class="line">  * 返回一个组合的Predicate，将两个Predicate的执行结果进行`||`运算。</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">default</span> Predicate&lt;T&gt; <span class="title">or</span><span class="params">(Predicate&lt;? <span class="keyword">super</span> T&gt; other)</span> </span>&#123;</div><div class="line">     Objects.requireNonNull(other);</div><div class="line">     <span class="keyword">return</span> (t) -&gt; test(t) || other.test(t);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">/**</span></div><div class="line">  * 差不多是equals的意思</div><div class="line">  */</div><div class="line"> <span class="keyword">static</span> &lt;T&gt; <span class="function">Predicate&lt;T&gt; <span class="title">isEqual</span><span class="params">(Object targetRef)</span> </span>&#123;</div><div class="line">     <span class="keyword">return</span> (<span class="keyword">null</span> == targetRef)</div><div class="line">             ? Objects::isNull</div><div class="line">             : object -&gt; targetRef.equals(object);</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>下面这个例子包含了stream，可以只看看思想.从组数据中筛选出质数的集合</p>
<p>代码丑了点，别介意😜<br><strong>eg：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; natureNum = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>);</div><div class="line">List&lt;Integer&gt; primeNum = natureNum.stream()</div><div class="line">        .filter(n -&gt; &#123;</div><div class="line">            <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> a = <span class="number">2</span>; a &lt;= Math.ceil(n / <span class="number">2</span>); a++) &#123;</div><div class="line">                <span class="keyword">if</span> (n % a == <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;).collect(Collectors.toList());</div><div class="line">primeNum.forEach(System.out::println);</div></pre></td></tr></table></figure></p>
<h2 id="0x03-Supplier"><a href="#0x03-Supplier" class="headerlink" title="0x03 Supplier"></a>0x03 Supplier</h2><p>不用接受任何输入参数，获得一个固定的结果，所以他是提供者<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Supplier</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得一个结果</div><div class="line">     */</div><div class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>一般在单例模式里面可以用这个，但是没想不出来模拟使用场景，所以没有例子。</p>
<blockquote>
<p>注意，无输入参数！</p>
</blockquote>
<h2 id="0x04-UnaryOperator"><a href="#0x04-UnaryOperator" class="headerlink" title="0x04 UnaryOperator"></a>0x04 UnaryOperator</h2><p>这个，还没看出怎么用，他继承了<code>Function</code>接口，所以功能跟<code>Function</code>接口类似<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UnaryOperator</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">T</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 返回自己</div><div class="line">     */</div><div class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">UnaryOperator&lt;T&gt; <span class="title">identity</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> t -&gt; t;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="0x05-BiFunction"><a href="#0x05-BiFunction" class="headerlink" title="0x05 BiFunction"></a>0x05 BiFunction</h2><p>接受两个参数，处理之后返回一个值<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  * Applies this function to the given arguments.</div><div class="line">  *</div><div class="line">  * <span class="doctag">@param</span> t the first function argument</div><div class="line">  * <span class="doctag">@param</span> u the second function argument</div><div class="line">  * <span class="doctag">@return</span> the function result</div><div class="line">  */</div><div class="line"> <span class="function">R <span class="title">apply</span><span class="params">(T t, U u)</span></span>;</div><div class="line"></div><div class="line"> <span class="comment">/**</span></div><div class="line">  * 参考Function接口的andThen </div><div class="line">  */</div><div class="line"> <span class="keyword">default</span> &lt;V&gt; <span class="function">BiFunction&lt;T, U, V&gt; <span class="title">andThen</span><span class="params">(Function&lt;? <span class="keyword">super</span> R, ? extends V&gt; after)</span> </span>&#123;</div><div class="line">     Objects.requireNonNull(after);</div><div class="line">     <span class="keyword">return</span> (T t, U u) -&gt; after.apply(apply(t, u));</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>BiFunction没有compose方法，因为BiFunction无法返回两个值，所以组合的时候会少一个参数，干脆就没有组合方法了<br><strong>eg：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">BiFunction&lt;Integer ,List&lt;Person&gt;,List&lt;Person&gt;&gt; b = (age,allPerson)-&gt;&#123;</div><div class="line">    <span class="keyword">for</span>(Person person:allPerson) &#123;</div><div class="line">        <span class="keyword">if</span>(person.getAge() &gt; age )&#123;</div><div class="line">            allPerson.remove(person);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> allPerson;</div><div class="line">&#125;;</div><div class="line">List&lt;Person&gt; young =  b.apply(<span class="number">30</span>, persons);</div></pre></td></tr></table></figure></p>
<h2 id="0x06-BinaryOperator"><a href="#0x06-BinaryOperator" class="headerlink" title="0x06 BinaryOperator"></a>0x06 BinaryOperator</h2><p>继承BiFunction，接受两个类型相同的参数，返回一个类型跟参数一样的结果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BinaryOperator</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">BiFunction</span>&lt;<span class="title">T</span>,<span class="title">T</span>,<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 创建一个BinaryOperator，这个BinaryOperator可以根据comparator，返回输入参数中较小的值</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">BinaryOperator&lt;T&gt; <span class="title">minBy</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> T&gt; comparator)</span> </span>&#123;</div><div class="line">        Objects.requireNonNull(comparator);</div><div class="line">        <span class="keyword">return</span> (a, b) -&gt; comparator.compare(a, b) &lt;= <span class="number">0</span> ? a : b;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * * 创建一个BinaryOperator，这个BinaryOperator可以根据comparator，返回输入参数中较大的值</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">BinaryOperator&lt;T&gt; <span class="title">maxBy</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> T&gt; comparator)</span> </span>&#123;</div><div class="line">        Objects.requireNonNull(comparator);</div><div class="line">        <span class="keyword">return</span> (a, b) -&gt; comparator.compare(a, b) &gt;= <span class="number">0</span> ? a : b;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>eg：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getBigString</span><span class="params">()</span></span>&#123;</div><div class="line">    String a =<span class="string">"Hello"</span>, b = <span class="string">"world"</span>;</div><div class="line">    BinaryOperator&lt;String&gt; m = BinaryOperator.maxBy((x,y)-&gt;x.length()-y.length());</div><div class="line">    <span class="comment">/* System.out.println(m.apply(a,b)); */</span></div><div class="line">    <span class="keyword">return</span> m.apply(a,b)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-Consumer&quot;&gt;&lt;a href=&quot;#0x00-Consumer&quot; class=&quot;headerlink&quot; title=&quot;0x00 Consumer&quot;&gt;&lt;/a&gt;0x00 Consumer&lt;/h2&gt;&lt;p&gt;接受一个参数，不反回结果，所以是消费者&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  * Performs this operation on the given argument.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  *&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; t the input argument&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(T t)&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;内部还有一个默认方法&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  * 返回一个组合的Consumer，依次执行前面Consumer的`accept()`， 接着是&amp;#123;&lt;span class=&quot;doctag&quot;&gt;@code&lt;/span&gt; after&amp;#125;后操作。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  * 如果执行任一操作抛出异常，则将异常抛出给操作的调用方。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  * 如果执行前面的`accept()`会引发异常，则不执行&amp;#123;&lt;span class=&quot;doctag&quot;&gt;@code&lt;/span&gt; after&amp;#125;后的操作。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  *&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; after the operation to perform after this operation&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; a composed &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@code&lt;/span&gt; Consumer&amp;#125; that performs in sequence this&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  * operation followed by the &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@code&lt;/span&gt; after&amp;#125; operation&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  * &lt;span class=&quot;doctag&quot;&gt;@throws&lt;/span&gt; NullPointerException if &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@code&lt;/span&gt; after&amp;#125; is null&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; Consumer&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;andThen&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Consumer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; after)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     Objects.requireNonNull(after);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (T t) -&amp;gt; &amp;#123; accept(t); after.accept(t); &amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="Lambda" scheme="http://micorochio.github.io/tags/Lambda/"/>
    
      <category term="函数式编程" scheme="http://micorochio.github.io/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    
      <category term="函数式接口" scheme="http://micorochio.github.io/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/"/>
    
  </entry>
  
  <entry>
    <title>CentOS7 搭建Java Web服务器笔记</title>
    <link href="http://micorochio.github.io/2017/01/20/mark-CentOS-7-Java-Web-Server-building/"/>
    <id>http://micorochio.github.io/2017/01/20/mark-CentOS-7-Java-Web-Server-building/</id>
    <published>2017-01-19T17:53:01.000Z</published>
    <updated>2017-01-23T08:38:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>搭建Java服务器就是把JavaEE的Web部署环境和软件都安装好，这是我自己用旧的PC搭建的，所以只是单个服务器，不涉及分布式。这些安装步骤都可以单独找教程</p>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><blockquote>
<ul>
<li>gcc gcc-c++</li>
<li>JDK</li>
<li>Redis</li>
<li>Nginx</li>
<li>MySQL</li>
<li>NodeJS</li>
<li>Jenkins</li>
</ul>
</blockquote>
<p>可能需要的附加软件</p>
<ul>
<li>git</li>
<li>Python</li>
<li><p>Python pip<br>…</p>
<a id="more"></a>
<h2 id="0x01-JDK安装和配置"><a href="#0x01-JDK安装和配置" class="headerlink" title="0x01 JDK安装和配置"></a>0x01 JDK安装和配置</h2><p>其实CentOS 7 自带Java7 为了适应lambda ，更新到Java8</p>
</li>
<li><p>卸载之前的版本</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]#  rpm -qa | grep java</div><div class="line">javapackages-tools-3.4.1-6.el7_0.noarch</div><div class="line">tzdata-java-2014i-1.el7.noarch</div><div class="line">java-1.7.0-openjdk-headless-1.7.0.71-2.5.3.1.el7_0.x86_64</div><div class="line">java-1.7.0-openjdk-1.7.0.71-2.5.3.1.el7_0.x86_64</div><div class="line">python-javapackages-3.4.1-6.el7_0.noarch</div></pre></td></tr></table></figure>
<p>根据列表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# rpm -e --nodeps tzdata-java-2014i-1.el7.noarch</div><div class="line">[root@localhost ~]# rpm -e --nodeps java-1.7.0-openjdk-headless-1.7.0.71-2.5.3.1.el7_0.x86_64</div><div class="line">[root@localhost ~]# rpm -e --nodeps java-1.7.0-openjdk-1.7.0.71-2.5.3.1.el7_0.x86_64</div></pre></td></tr></table></figure></p>
<ul>
<li>下载JDK包</li>
</ul>
<p><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">下载地址：http://www.oracle.com/technetwork/java/javase/downloads/index.html</a></p>
<p>因为Oracle搞了cookie验证，所以下载完使用ftp上传到CentOS上也可以，或者，wget带上Cookie<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget --no-cookies --no-check-certificate --header &quot;Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie&quot; &quot;http://download.oracle.com/otn-pub/java/jdk/8u102-b14/jdk-8u102-linux-i586.rpm&quot;</div></pre></td></tr></table></figure></p>
<ul>
<li>安装rpm</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -ivh jdk-8u102-linux-i586.rpm</div></pre></td></tr></table></figure>
<ul>
<li>配置JAVA_HOME</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vi /etc/profile</div><div class="line"># 最末尾添加</div><div class="line">JAVA_HOME=/usr/local/jdk/jdk1.8.0_91</div><div class="line">JRE_HOME=$JAVA_HOME/jre</div><div class="line">PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</div><div class="line">CLASSPATH=:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib/dt.jar</div><div class="line">export JAVA_HOME JRE_HOME PATH CLASSPATH</div></pre></td></tr></table></figure>
<p>保存 退出vi<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> 使环境变量生效</span></div><div class="line">source /etc/profile</div></pre></td></tr></table></figure></p>
<ul>
<li>验证安装成功</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# java -version</div><div class="line">java version &quot;1.8.0_92&quot;</div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_92-b14)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.92-b14, mixed mode)</div></pre></td></tr></table></figure>
<h2 id="0x02-安装Redis"><a href="#0x02-安装Redis" class="headerlink" title="0x02 安装Redis"></a>0x02 安装Redis</h2><p>因为Redis不大，可以使用yum工具安装</p>
<ul>
<li>yum 安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 系统应该安装了EPEL</div><div class="line">sudo yum -y install redis</div></pre></td></tr></table></figure>
<p>如果不行</p>
<ul>
<li>编译安装</li>
</ul>
<p><a href="https://linux.cn/article-6719-1.html" target="_blank" rel="external">参考这篇文章：https://linux.cn/article-6719-1.html</a></p>
<ul>
<li>Redis 相关操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> # 启动服务：</div><div class="line"> systemctl start redis.service</div><div class="line"> # 停止服务：</div><div class="line">systemctl stop redis.service</div><div class="line"> # 重启服务：</div><div class="line">systemctl restart redis.service</div></pre></td></tr></table></figure>
<ul>
<li><a href="https://redis.io/" target="_blank" rel="external">Redis官网：https://redis.io/</a></li>
</ul>
<h2 id="0x03-安装Nginx"><a href="#0x03-安装Nginx" class="headerlink" title="0x03 安装Nginx"></a>0x03 安装Nginx</h2><ul>
<li>yum 安装</li>
</ul>
<p>如果不是网络被限制的话，建议用这个方法安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install nginx</div></pre></td></tr></table></figure></p>
<ul>
<li><p>编译安装<br></p>
</li>
<li><p>检查依赖<br></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">rpm -q gcc</div><div class="line">rpm -q openssl</div><div class="line">rpm -q zlib</div><div class="line">rpm -q pcre</div></pre></td></tr></table></figure>
<p><code>package pcre is not installed</code>表示pcre未被安装，否则表示该项依赖已被安装<br></p>
<ul>
<li>安装依赖<br><br>选择没有安装的依赖，yum安装<br></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> # 建议使用root用户</div><div class="line">yum install -y gcc gcc-c++</div><div class="line">yum -y install openssl</div><div class="line">yum -y install zlib</div><div class="line">yum -y install pcre</div></pre></td></tr></table></figure>
<ul>
<li>创建目录，安装Nginx<br></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># 请使用root或管理员用户</div><div class="line"># 创建安装目录</div><div class="line">cd /</div><div class="line">mkdir appHome</div><div class="line">cd appHome</div><div class="line"># 下载Nginx，解压</div><div class="line">wget http://nginx.org/download/nginx-1.11.8.tar.gz</div><div class="line">tar zxvf nginx-1.9.15.tar.gz</div><div class="line">cd nginx-1.9.15</div><div class="line"># 编译安装</div><div class="line">./configure</div><div class="line">make </div><div class="line">make install</div></pre></td></tr></table></figure>
<ul>
<li>启动Ngixn<br><br>如果是yum安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl start nginx</div></pre></td></tr></table></figure>
<p>如果是编译安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/nginx/bin</div><div class="line">sudo  ./nginx</div></pre></td></tr></table></figure>
<p>记得打开端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> # 查看端口是否开放</div><div class="line">firewall-cmd --list-all</div></pre></td></tr></table></figure>
<p>建议开放非80端口，修改一下Nginx配置，开80端口可能被查水表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 打开80端口</div><div class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</div><div class="line">firewall-cmd --zone=public --add-service=http --permanent</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure></p>
<h2 id="0x04-安装MySQL"><a href="#0x04-安装MySQL" class="headerlink" title="0x04 安装MySQL"></a>0x04 安装MySQL</h2><p>这个老折腾了，CentOS 7 用MariaDB代替了MySQL，yum源里也没有MySQL，只能去Mysql官网去找源，这次用的是rpm安装，不过由于服务器在国外，我的小水管4kb/s 安装了10个小时，所以我弄了个新笔记<br><a href="http://www.jianshu.com/p/e54ff5283f18" target="_blank" rel="external">CentOS 7 安装与卸载MySQL 5.7跳坑：http://www.jianshu.com/p/e54ff5283f18</a></p>
<h2 id="0x05-安装NodeJS"><a href="#0x05-安装NodeJS" class="headerlink" title="0x05 安装NodeJS"></a>0x05 安装NodeJS</h2><p>下载安装并配置</p>
<ul>
<li><p>下载解压</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /appHome/</div><div class="line">wget https://nodejs.org/dist/v6.9.4/node-v6.9.4-linux-x64.tar.xz</div><div class="line">tar -zxvf node-v6.9.4-linux-x64.tar.xz</div></pre></td></tr></table></figure>
</li>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd node-v6.9.4-linux-x64</div><div class="line">./configure </div><div class="line">make </div><div class="line">make install</div></pre></td></tr></table></figure>
</li>
<li><p>添加配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/profile</div></pre></td></tr></table></figure>
</li>
</ul>
<p>末尾添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># NODE_HOME</div><div class="line">NODE_HOME =/appHome/node-v6.9.4-linux-x64</div><div class="line"> PATH=$PATH:$NODE_HOME/bin</div><div class="line">export PATH NODE_HOME</div></pre></td></tr></table></figure></p>
<p>保存，编译<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source /etc/profile</div></pre></td></tr></table></figure></p>
<h2 id="0x06-安装Jenkins"><a href="#0x06-安装Jenkins" class="headerlink" title="0x06 安装Jenkins"></a>0x06 安装Jenkins</h2><p>超级简单<br><a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+Red+Hat+distributions" target="_blank" rel="external">https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+Red+Hat+distributions</a></p>
<p>我贴一下脚本</p>
<ul>
<li>安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo</div><div class="line">sudo rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key</div><div class="line">sudo yum install jenkins</div></pre></td></tr></table></figure>
<ul>
<li>操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 启动</div><div class="line">sudo service jenkins start</div><div class="line"># 停止</div><div class="line">sudo service jenkins stop</div><div class="line"># 重启</div><div class="line">sudo service jenkins restart</div><div class="line">sudo chkconfig jenkins on</div></pre></td></tr></table></figure>
<ul>
<li>开启端口访问</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># 可访问端口列表</div><div class="line">firewall-cmd --list-all</div><div class="line"># 开启8080端口外网访问</div><div class="line">firewall-cmd --zone=public --add-port=8080/tcp --permanent</div><div class="line">firewall-cmd --zone=public --add-service=http --permanent</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure>
<hr>
<p>love&amp;peace</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;搭建Java服务器就是把JavaEE的Web部署环境和软件都安装好，这是我自己用旧的PC搭建的，所以只是单个服务器，不涉及分布式。这些安装步骤都可以单独找教程&lt;/p&gt;
&lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;gcc gcc-c++&lt;/li&gt;
&lt;li&gt;JDK&lt;/li&gt;
&lt;li&gt;Redis&lt;/li&gt;
&lt;li&gt;Nginx&lt;/li&gt;
&lt;li&gt;MySQL&lt;/li&gt;
&lt;li&gt;NodeJS&lt;/li&gt;
&lt;li&gt;Jenkins&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;可能需要的附加软件&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;git&lt;/li&gt;
&lt;li&gt;Python&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Python pip&lt;br&gt;…&lt;/p&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://micorochio.github.io/tags/Java/"/>
    
      <category term="Linux" scheme="http://micorochio.github.io/tags/Linux/"/>
    
      <category term="CentOS" scheme="http://micorochio.github.io/tags/CentOS/"/>
    
      <category term="服务器" scheme="http://micorochio.github.io/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
      <category term="Java Web" scheme="http://micorochio.github.io/tags/Java-Web/"/>
    
      <category term="nginx" scheme="http://micorochio.github.io/tags/nginx/"/>
    
      <category term="redis" scheme="http://micorochio.github.io/tags/redis/"/>
    
      <category term="jenkins" scheme="http://micorochio.github.io/tags/jenkins/"/>
    
      <category term="NodeJS" scheme="http://micorochio.github.io/tags/NodeJS/"/>
    
  </entry>
  
</feed>
